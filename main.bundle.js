(()=>{"use strict";var e={7210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PageEnv=void 0,t.PageEnv={Version:"506930730",Debug:JSON.parse("false")}},5917:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.main=t.actions=void 0;var o,i=n(655),r=n(6314),a=n(6085),s=n(6540),c=n(1639),u=i.__importDefault(n(2181)),d=i.__importDefault(n(6071)),l=n(1307),f=n(7486),p=n(7210),g=n(6886),m=n(8456),h=n(5597),v=n(7270),y=n(2265),x=n(9986),P=n(9632),b=n(2281),w=n(9673),k=n(7587),_=n(4257);t.actions=i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign({},m.animationActions),h.modeActions),v.modalActions),y.pageActions),x.setterActions),P.utilsActions),b.mementoActions),g.fieldEditorActions),w.commentActions),k.convertActions),t.main=(void 0===(o=p.PageEnv.Debug)&&(o=!1),o?c.withLogger(s.app)(r.initState,t.actions,a.view,document.body):s.app(r.initState,t.actions,a.view,document.body)),u.default.use(d.default).init({fallbackLng:"en",resources:{en:{translation:f.resources},ja:{translation:l.resources}}},(function(e){e?console.error("Failed to load i18n"):t.main.refresh()})),window.onresize=function(){t.main.resize({width:window.document.body.clientWidth,height:window.document.body.clientHeight})},window.addEventListener("load",(function(){var e="";if(""!==location.search)e=location.search.substr(1);else{var n=location.hash,o=n.indexOf("?");-1!==o&&(e=n.substr(o+1))}var i=decodeURIComponent(e).split("&"),r=new d.default(null,{order:["myQueryDetector","querystring","navigator","path","subdomain"],cookieMinutes:0});r.addDetector({name:"myQueryDetector",lookup:function(){var e=i.find((function(e){return e.startsWith("lng=")}));return void 0!==e?e.substr(4):void 0},cacheUserLanguage:function(){}}),u.default.use(r).init({fallbackLng:"en",resources:{en:{translation:f.resources},ja:{translation:l.resources}}},(function(e){e?console.error("Failed to load i18n"):t.main.refresh()}));var a=i.find((function(e){return e.startsWith("d=")}));if(void 0!==a)return t.main.loadFumen({fumen:a.substr(2)});var s=localStorage.getItem("data@1");return s?(M.toast({html:_.i18n.Top.RestoreFromStorage(),classes:"top-toast",displayLength:1500}),t.main.loadFumen({fumen:s})):t.main.loadNewFumen()})),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./sw.js").then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.error("SW registration failed: ",e)}))}))},8456:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.animationActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(9774);t.animationActions={startAnimation:function(){return function(e){return i.sequence(e,[t.animationActions.pauseAnimation(),function(){return{play:o.__assign(o.__assign({},e.play),{status:a.AnimationState.Play}),handlers:{animation:setInterval((function(){r.main.nextLoopPage()}),e.play.intervalTime)}}}])}},pauseAnimation:function(){return function(e){if(void 0!==e.handlers.animation)return clearInterval(e.handlers.animation),{play:o.__assign(o.__assign({},e.play),{status:a.AnimationState.Pause}),handlers:{animation:void 0}}}}}},9673:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commentActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(2995),s=n(6314),c=n(1983),u=n(4826);t.commentActions={updateCommentText:function(e){var t=e.text,n=e.pageIndex;return function(e){if(e.fumen.currentIndex!==n)return s.resources.comment=void 0,i.sequence(e,[d(n,void 0!==t?t:""),r.actions.reopenCurrentPage()]);e.comment.text===t?s.resources.comment=void 0:s.resources.comment={pageIndex:n,text:void 0!==t?t:""}}},commitCommentText:function(){return function(e){var t=s.resources.comment;if(void 0!==t){var n=t.pageIndex;if(e.fumen.currentIndex===n)return s.resources.comment=void 0,i.sequence(e,[d(n,t.text),r.actions.reopenCurrentPage()])}}}};var d=function(e,t){return function(n){var s=n.fumen.pages,d=s[e];if(void 0!==d){var l=s[e-1],f=new c.Pages(s),p=void 0!==l?f.getComment(e-1):void 0,g=[];if(d.comment.text!==t){if(u.Quiz.isQuizComment(t))if(void 0!==p&&c.isQuizCommentResult(p)&&p.quizAfterOperation.format().toString()===t){if(void 0!==d.comment.text){var m=d.comment.text;f.unfreezeComment(e),g.push(a.toUnfreezeCommentTask(e,m))}s=f.pages}else{void 0===d.comment.text&&(f.freezeComment(e),g.push(a.toFreezeCommentTask(e))),d.flags.quiz||(f.setQuizFlag(e),g.push(a.toSetQuizFlagTask(e)));var h=(s=f.pages)[e],v=a.toPrimitivePage(h);h.comment={text:t},g.push(a.toSinglePageTask(e,v,h))}else void 0!==p&&c.isTextCommentResult(p)&&p.text===t?(void 0!==d.comment.text&&(m=d.comment.text,f.unfreezeComment(e),g.push(a.toUnfreezeCommentTask(e,m))),s=f.pages):(void 0===d.comment.text&&(f.freezeComment(e),g.push(a.toFreezeCommentTask(e))),d.flags.quiz&&(f.unsetQuizFlag(e),g.push(a.toUnsetQuizFlagTask(e))),h=(s=f.pages)[e],v=a.toPrimitivePage(h),h.comment={text:t},g.push(a.toSinglePageTask(e,v,h)));return i.sequence(n,[function(){return{fumen:o.__assign(o.__assign({},n.fumen),{pages:s})}},r.actions.registerHistoryTask({task:a.toPageTaskStack(g,e)})])}}}}},9609:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sequence=void 0;var o=n(655);t.sequence=function(e,t){for(var n=e,i={},r=0,a=t;r<a.length;r++){var s=a[r];if(void 0!==s){var c=s(n);i=o.__assign(o.__assign({},i),c),n=o.__assign(o.__assign({},e),i)}}return i}},7587:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(2995),s=n(1983),c=n(9774),u=n(8711),d=n(9782);t.convertActions={shiftToLeft:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,c=new s.Pages(n),d=n[t],l=a.toPrimitivePage(d),f=c.getField(t,s.PageFieldOperation.Command),p=f.copy();f.shiftToLeft();var g=d.piece;if(void 0!==g||!p.equals(f)){var m=c.getField(t,s.PageFieldOperation.None);if(d.commands=s.parseToCommands(m,f),void 0!==g){var h=u.getBlockPositions(g.type,g.rotation,g.coordinate.x,g.coordinate.y);Math.min.apply(Math,h.map((function(e){return e[0]})))<1?d.piece=void 0:g.coordinate.x-=1}return i.sequence(e,[r.actions.registerHistoryTask({task:a.toSinglePageTask(t,l,d)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},shiftToRight:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,c=new s.Pages(n),d=n[t],l=a.toPrimitivePage(d),f=c.getField(t,s.PageFieldOperation.Command),p=f.copy();f.shiftToRight();var g=d.piece;if(void 0!==g||!p.equals(f)){var m=c.getField(t,s.PageFieldOperation.None);if(d.commands=s.parseToCommands(m,f),void 0!==g){var h=u.getBlockPositions(g.type,g.rotation,g.coordinate.x,g.coordinate.y);8<Math.max.apply(Math,h.map((function(e){return e[0]})))?d.piece=void 0:g.coordinate.x+=1}return i.sequence(e,[r.actions.registerHistoryTask({task:a.toSinglePageTask(t,l,d)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},shiftToUp:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,d=new s.Pages(n),l=n[t],f=a.toPrimitivePage(l),p=d.getField(t,s.PageFieldOperation.Command),g=p.copy();p.shiftToUp();var m=l.piece;if(void 0!==m||!g.equals(p)){var h=d.getField(t,s.PageFieldOperation.None);if(l.commands=s.parseToCommands(h,p),void 0!==m){var v=u.getBlockPositions(m.type,m.rotation,m.coordinate.x,m.coordinate.y),y=Math.max.apply(Math,v.map((function(e){return e[1]})));c.FieldConstants.Height-2<y?l.piece=void 0:m.coordinate.y+=1}return i.sequence(e,[r.actions.registerHistoryTask({task:a.toSinglePageTask(t,f,l)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},shiftToBottom:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,c=new s.Pages(n),d=n[t],l=a.toPrimitivePage(d),f=c.getField(t,s.PageFieldOperation.Command),p=f.copy();f.shiftToBottom();var g=d.piece;if(void 0!==g||!p.equals(f)){var m=c.getField(t,s.PageFieldOperation.None);if(d.commands=s.parseToCommands(m,f),void 0!==g){var h=u.getBlockPositions(g.type,g.rotation,g.coordinate.x,g.coordinate.y);Math.min.apply(Math,h.map((function(e){return e[1]})))<1?d.piece=void 0:g.coordinate.y-=1}return i.sequence(e,[r.actions.registerHistoryTask({task:a.toSinglePageTask(t,l,d)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},convertToGray:function(){return function(e){return i.sequence(e,[r.actions.removeUnsettledItems(),l((function(e){var t=e.copy();return t.convertToGray(),t}))])}},clearField:function(){return function(e){return i.sequence(e,[r.actions.removeUnsettledItems(),l((function(e){return new d.Field({})}))])}},convertToMirror:function(){return function(e){return i.sequence(e,[r.actions.removeUnsettledItems(),h()])}}};var l=function(e){return function(t){var n=t.fumen.currentIndex,c=t.fumen.pages,u=new s.Pages(c),d=[],l=c[n];void 0===l.field.obj&&(u.toKeyPage(n),d.push(a.toKeyPageTask(n))),void 0!==l.comment.ref&&(u.freezeComment(n),d.push(a.toFreezeCommentTask(n)));var f=a.toPrimitivePage(l),p=u.getField(n,s.PageFieldOperation.Command),g=e(p);if(0!==d.length||!p.equals(g)){var m=u.getField(n,s.PageFieldOperation.None);return l.commands=s.parseToCommands(m,g),d.push(a.toSinglePageTask(n,f,l)),i.sequence(t,[r.actions.registerHistoryTask({task:a.toPageTaskStack(d,n)}),function(){return{fumen:o.__assign(o.__assign({},t.fumen),{pages:c})}},r.actions.reopenCurrentPage()])}}},f=function(e){switch(e){case c.Piece.J:return c.Piece.L;case c.Piece.L:return c.Piece.J;case c.Piece.S:return c.Piece.Z;case c.Piece.Z:return c.Piece.S}return e},p=function(e,t,n,o){return{type:e,rotation:t,coordinate:{x:n,y:o}}},g=function(e){var t=e.type,n=e.rotation,o=e.coordinate,i=o.x,r=o.y,a=9-i,s=8-(i-1)+1,u=8-i;switch(t){case c.Piece.I:switch(n){case c.Rotation.Spawn:return p(t,c.Rotation.Reverse,a,r);case c.Rotation.Reverse:return p(t,c.Rotation.Spawn,a,r);case c.Rotation.Left:return p(t,c.Rotation.Right,a,r+1);case c.Rotation.Right:return p(t,c.Rotation.Left,a,r-1)}case c.Piece.T:switch(n){case c.Rotation.Spawn:return p(t,c.Rotation.Spawn,a,r);case c.Rotation.Reverse:return p(t,c.Rotation.Reverse,a,r);case c.Rotation.Left:return p(t,c.Rotation.Right,a,r);case c.Rotation.Right:return p(t,c.Rotation.Left,a,r)}case c.Piece.O:switch(n){case c.Rotation.Spawn:return p(t,c.Rotation.Spawn,u,r);case c.Rotation.Reverse:return p(t,c.Rotation.Reverse,s,r);case c.Rotation.Left:return p(t,c.Rotation.Left,s,r);case c.Rotation.Right:return p(t,c.Rotation.Right,u,r)}case c.Piece.S:switch(n){case c.Rotation.Spawn:return p(c.Piece.Z,c.Rotation.Spawn,a,r);case c.Rotation.Reverse:return p(c.Piece.Z,c.Rotation.Reverse,a,r);case c.Rotation.Left:return p(c.Piece.Z,c.Rotation.Right,a,r);case c.Rotation.Right:return p(c.Piece.Z,c.Rotation.Left,a,r)}case c.Piece.Z:switch(n){case c.Rotation.Spawn:return p(c.Piece.S,c.Rotation.Spawn,a,r);case c.Rotation.Reverse:return p(c.Piece.S,c.Rotation.Reverse,a,r);case c.Rotation.Left:return p(c.Piece.S,c.Rotation.Right,a,r);case c.Rotation.Right:return p(c.Piece.S,c.Rotation.Left,a,r)}case c.Piece.L:switch(n){case c.Rotation.Spawn:return p(c.Piece.J,c.Rotation.Spawn,a,r);case c.Rotation.Reverse:return p(c.Piece.J,c.Rotation.Reverse,a,r);case c.Rotation.Left:return p(c.Piece.J,c.Rotation.Right,a,r);case c.Rotation.Right:return p(c.Piece.J,c.Rotation.Left,a,r)}case c.Piece.J:switch(n){case c.Rotation.Spawn:return p(c.Piece.L,c.Rotation.Spawn,a,r);case c.Rotation.Reverse:return p(c.Piece.L,c.Rotation.Reverse,a,r);case c.Rotation.Left:return p(c.Piece.L,c.Rotation.Right,a,r);case c.Rotation.Right:return p(c.Piece.L,c.Rotation.Left,a,r)}}return e},m=function(e){for(var t="",n=0;n<e.length;n+=1)switch(e[n]){case"L":t+="J";break;case"J":t+="L";break;case"S":t+="Z";break;case"Z":t+="S";break;default:t+=e[n]}return t},h=function(){return function(e){for(var t=e.fumen.currentIndex,n=e.fumen.pages,c=new s.Pages(n),u=[],l=n.length,p=t+1;p<n.length;p+=1)if(void 0!==n[p].field.obj){l=p;break}void 0===(T=n[t]).field.obj&&(c.toKeyPage(t),u.push(a.toKeyPageTask(t))),void 0!==T.comment.ref&&(c.freezeComment(t),u.push(a.toFreezeCommentTask(t)));for(var h=a.toPrimitivePage(T),v=c.getField(t,s.PageFieldOperation.Command),y=new d.Field({}),x=-1;x<23;x+=1)for(var P=0;P<10;P+=1){var b=v.get(9-P,x);y.add(P,x,f(b))}void 0!==T.piece&&(T.piece=g(T.piece));var w=c.getComment(t);if(s.isQuizCommentResult(w)){var k=m(w.quiz);c.setComment(t,k)}var _=c.getField(t,s.PageFieldOperation.None);for(T.commands=s.parseToCommands(_,y),u.push(a.toSinglePageTask(t,h,T)),p=t+1;p<l;p+=1){var T=n[p];h=a.toPrimitivePage(T),void 0!==T.piece&&(T.piece=g(T.piece)),w=c.getComment(t),void 0!==T.comment.text&&s.isQuizCommentResult(w)&&(k=m(w.quiz),c.setComment(t,k)),u.push(a.toSinglePageTask(p,h,T))}return i.sequence(e,[r.actions.registerHistoryTask({task:a.toPageTaskStack(u,t)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},381:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBlockActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),s=n(2995),c=n(6886),u=n(3876),d=n(2742);t.drawBlockActions={fixInferencePiece:function(){return function(e){var t=e.events.inferences;if(!(t.length<4)){var n=u.inferPiece(t);if(n){var o=n.piece,i=e.fumen.currentIndex,d=e.fumen.pages[i],l=s.toPrimitivePage(d);d.commands||(d.commands={pre:{}});for(var f=0,p=t;f<p.length;f++){var g=p[f],m=g%10,h=Math.floor(g/10),v="block-"+g;e.cache.currentInitField.getAtIndex(g,!0)!==o?d.commands.pre[v]={x:m,y:h,piece:o,type:"block"}:delete d.commands.pre[v]}return a.sequence(e,[c.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:s.toSinglePageTask(i,l,d)})])}}}},clearInferencePiece:function(){return function(e){return a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:[]})}}])}},resetInferencePiece:function(){return function(e){return a.sequence(e,[c.fieldEditorActions.clearInferencePiece(),r.actions.openPage({index:e.fumen.currentIndex})])}},ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece){if(void 0!==e.mode.piece)return a.sequence(e,[r.actions.fixInferencePiece(),function(e){return l(e,t,!0)},r.actions.ontouchMoveField({index:t})]);var n=e.events.inferences;return a.sequence(e,[void 0===n.find((function(e){return e===t}))?r.actions.fixInferencePiece():void 0,function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0===e.events.inferences.find((function(e){return e===t}))?i.Piece.Gray:i.Piece.Empty,updated:!1})}},r.actions.ontouchMoveField({index:t})])}}},ontouchMoveField:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece){if(void 0!==e.mode.piece)return f(e,t,!0);var n=e.events.piece;if(void 0!==n){var s=e.events.inferences;if(n!==i.Piece.Empty){if(4<=s.length)return;if(e.field[t].piece!==i.Piece.Empty&&e.field[t].highlight!==d.HighlightType.Lighter)return;if(void 0===s.find((function(e){return e===t}))){var c=e.events.inferences.concat([t]);return a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:c,updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})])}}return n===i.Piece.Empty?a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:e.events.inferences.filter((function(e){return e!==t})),updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})]):void 0}}}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=e.fumen.currentIndex,n=e.fumen.pages[t],o=e.events.updated;return a.sequence(e,[o&&void 0!==e.events.prevPage?r.actions.registerHistoryTask({task:s.toSinglePageTask(t,e.events.prevPage,n)}):void 0,p])}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){if(void 0===e.events.piece)return void 0!==e.mode.piece?a.sequence(e,[function(){return l(e,t,!1)},r.actions.ontouchMoveSentLine({index:t})]):void 0}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece)return void 0!==e.mode.piece?f(e,t,!1):void 0}}};var l=function(e,t,n){var c=e.fumen.currentIndex,u=(n?e.field[t]:e.sentLine[t]).piece!==e.mode.piece?e.mode.piece:i.Piece.Empty;if(void 0!==u)return a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{piece:u,prevPage:s.toPrimitivePage(e.fumen.pages[e.fumen.currentIndex]),updated:!1})}},r.actions.openPage({index:c})])},f=function(e,t,n){var i=e.fumen.pages,s=e.fumen.currentIndex,c=e.events.piece;if(void 0!==c&&(n?e.field[t]:e.sentLine[t]).piece!==c){var u=i[s];u.commands||(u.commands={pre:{}});var d=t%10,l=Math.floor(t/10),f=n?"block":"sentBlock",p=f+"-"+t;return e.cache.currentInitField.getAtIndex(t,n)!==c?u.commands.pre[p]={x:d,y:l,piece:c,type:f}:delete u.commands.pre[p],a.sequence(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:i}),events:o.__assign(o.__assign({},e.events),{updated:!0})}},r.actions.openPage({index:s})])}},p=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1})}}},6886:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fieldEditorActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),s=n(6312),c=n(381),u=n(1542),d=n(2995),l=n(2579),f=n(1983),p=n(7989),g=n(479),m=n(8286),h=n(8711);t.fieldEditorActions={fixInferencePiece:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.fixInferencePiece()(e);case i.TouchTypes.Piece:return s.putPieceActions.fixInferencePiece()(e)}}},clearInferencePiece:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.clearInferencePiece()(e);case i.TouchTypes.Piece:return s.putPieceActions.clearInferencePiece()(e)}}},resetInferencePiece:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.resetInferencePiece()(e);case i.TouchTypes.Piece:return s.putPieceActions.resetInferencePiece()(e)}}},removeUnsettledItemsInField:function(){return function(e){return a.sequence(e,[t.fieldEditorActions.fixInferencePiece(),t.fieldEditorActions.resetInferencePiece()])}},ontouchStartField:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.ontouchStartField({index:t})(e);case i.TouchTypes.Piece:return s.putPieceActions.ontouchStartField({index:t})(e);case i.TouchTypes.MovePiece:return l.movePieceActions.ontouchStartField({index:t})(e);case i.TouchTypes.FillRow:return g.fillRowActions.ontouchStartField({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchStartField({index:t})(e)}}},ontouchMoveField:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.ontouchMoveField({index:t})(e);case i.TouchTypes.Piece:return s.putPieceActions.ontouchMoveField({index:t})(e);case i.TouchTypes.MovePiece:return l.movePieceActions.ontouchMoveField({index:t})(e);case i.TouchTypes.FillRow:return g.fillRowActions.ontouchMoveField({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchMoveField({index:t})(e)}}},ontouchEnd:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.ontouchEnd()(e);case i.TouchTypes.Piece:return s.putPieceActions.ontouchEnd()(e);case i.TouchTypes.MovePiece:return l.movePieceActions.ontouchEnd()(e);case i.TouchTypes.FillRow:return g.fillRowActions.ontouchEnd()(e);case i.TouchTypes.Fill:return u.fillActions.ontouchEnd()(e)}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.ontouchStartSentLine({index:t})(e);case i.TouchTypes.FillRow:return g.fillRowActions.ontouchStartSentLine({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchStartSentLine({index:t})(e)}}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return c.drawBlockActions.ontouchMoveSentLine({index:t})(e);case i.TouchTypes.FillRow:return g.fillRowActions.ontouchMoveSentLine({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchMoveSentLine({index:t})(e)}}},selectPieceColor:function(e){var t=e.piece;return function(e){return a.sequence(e,[r.actions.removeUnsettledItems(),function(e){return{mode:o.__assign(o.__assign({},e.mode),{piece:t})}}])}},selectInferencePieceColor:function(){return function(e){return a.sequence(e,[r.actions.removeUnsettledItems(),function(e){return{mode:o.__assign(o.__assign({},e.mode),{piece:void 0})}}])}},spawnPiece:function(e){var n=e.piece,o=e.guideline;return function(e){if(n===i.Piece.Gray||n===i.Piece.Empty)throw new m.ViewError("Unsupported piece: "+n);var s=e.fumen.pages,c=e.fumen.currentIndex,u=s[c];if(void 0!==u){var l;l=o?{type:n,rotation:i.Rotation.Spawn,coordinate:{x:4,y:20}}:n===i.Piece.I?{type:n,rotation:i.Rotation.Reverse,coordinate:{x:5,y:20}}:n===i.Piece.O?{type:n,rotation:i.Rotation.Reverse,coordinate:{x:5,y:21}}:{type:n,rotation:i.Rotation.Reverse,coordinate:{x:4,y:21}};var f=u.piece;if(void 0!==f&&f.type===l.type&&f.rotation===l.rotation&&f.coordinate.x===l.coordinate.x&&f.coordinate.y===l.coordinate.y)return a.sequence(e,[t.fieldEditorActions.resetInferencePiece()]);var p=d.toPrimitivePage(u);return u.piece=l,a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(c,p,u)}),r.actions.reopenCurrentPage()])}}},clearPiece:function(){return function(e){var n=e.fumen.pages,o=e.fumen.currentIndex,i=n[o];if(void 0!==i){if(void 0===i.piece)return t.fieldEditorActions.resetInferencePiece()(e);var s=d.toPrimitivePage(i);return i.piece=void 0,a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(o,s,i)}),r.actions.reopenCurrentPage()])}}},rotateToLeft:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=p.testLeftRotation(c.type,c.rotation),g=l.rotation,m=v(u,c.type,g),h=c.coordinate,y=l.test.map((function(e){return e[0]+=h.x,e[1]+=h.y,e})).find((function(e){return m(e[0],e[1])}));if(void 0!==y){var x=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{rotation:g,coordinate:{x:y[0],y:y[1]}}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,x,s)}),r.actions.reopenCurrentPage()])}}}}},rotateToRight:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=p.testRightRotation(c.type,c.rotation),g=l.rotation,m=v(u,c.type,g),h=c.coordinate,y=l.test.map((function(e){return e[0]+=h.x,e[1]+=h.y,e})).find((function(e){return m(e[0],e[1])}));if(void 0!==y){var x=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{rotation:g,coordinate:{x:y[0],y:y[1]}}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,x,s)}),r.actions.reopenCurrentPage()])}}}}},moveToLeft:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,c.type,c.rotation),p=c.coordinate;if(l(p.x-1,p.y)){var g=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{coordinate:{x:p.x-1,y:p.y}}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,g,s)}),r.actions.reopenCurrentPage()])}}}}},moveToLeftEnd:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){for(var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,c.type,c.rotation),p=c.coordinate,g=p.x;l(g-1,p.y);)g-=1;if(g!==p.x){var m=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{coordinate:{x:g,y:p.y}}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,m,s)}),r.actions.reopenCurrentPage()])}}}}},moveToRight:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,c.type,c.rotation),p=c.coordinate;if(l(p.x+1,p.y)){var g=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{coordinate:{x:p.x+1,y:p.y}}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,g,s)}),r.actions.reopenCurrentPage()])}}}}},moveToRightEnd:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){for(var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,c.type,c.rotation),p=c.coordinate,g=p.x;l(g+1,p.y);)g+=1;if(g!==p.x){var m=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{coordinate:{x:g,y:p.y}}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,m,s)}),r.actions.reopenCurrentPage()])}}}}},harddrop:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,s=n[i];if(void 0!==s){var c=s.piece;if(void 0!==c){for(var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,c.type,c.rotation),p=c.coordinate.y,g=c.coordinate.y-1;0<=g&&l(c.coordinate.x,g);g-=1)p=g;if(p!==c.coordinate.y){var m=d.toPrimitivePage(s);return s.piece=o.__assign(o.__assign({},c),{coordinate:o.__assign(o.__assign({},c.coordinate),{y:p})}),a.sequence(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:d.toSinglePageTask(i,m,s)}),r.actions.reopenCurrentPage()])}}}}}};var v=function(e,t,n){return function(o,r){var a=h.getBlockPositions(t,n,o,r);return!a.some((function(e){return e[0]<0||10<=e[0]||e[1]<0||24<=e[1]}))&&!a.map(i.toPositionIndex).some((function(t){return e.getAtIndex(t,!0)!==i.Piece.Empty}))}}},1542:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(2995);t.fillActions={ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece&&void 0!==e.mode.piece)return r.sequence(e,[function(e){return s(e)},i.actions.ontouchMoveField({index:t})])}},ontouchMoveField:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece&&void 0!==e.mode.piece)return r.sequence(e,[function(e){return c(e,t,!0)}])}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=e.fumen.currentIndex,n=e.fumen.pages[t],o=e.events.updated;return r.sequence(e,[o&&void 0!==e.events.prevPage?i.actions.registerHistoryTask({task:a.toSinglePageTask(t,e.events.prevPage,n)}):void 0,u])}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){if(void 0===e.events.piece&&void 0!==e.mode.piece)return r.sequence(e,[function(){return s(e)},i.actions.ontouchMoveSentLine({index:t})])}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece&&void 0!==e.mode.piece)return c(e,t,!1)}}};var s=function(e){var t=e.fumen.currentIndex,n=e.mode.piece;if(void 0!==n)return r.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{piece:n,prevPage:a.toPrimitivePage(e.fumen.pages[e.fumen.currentIndex]),updated:!1})}},i.actions.openPage({index:t})])},c=function(e,t,n){var a=e.fumen.pages,s=e.fumen.currentIndex,c=e.events.piece;if(void 0!==c){var u=(n?e.field[t]:e.sentLine[t]).piece;if(u!==c){var d=a[s];d.commands||(d.commands={pre:{}});var l=d.commands,f=n?e.field.concat():e.sentLine.concat(),p=Math.floor(f.length/10),g=function(t){if(f[t]&&f[t].piece===u){delete f[t];var o=t%10,i=Math.floor(t/10),r=n?"block":"sentBlock",a=r+"-"+t;e.cache.currentInitField.getAtIndex(t,n)!==c?l.pre[a]={x:o,y:i,piece:c,type:r}:delete l.pre[a],0<o&&g(t-1),o<9&&g(t+1),0<i&&g(t-10),i<p-1&&g(t+10)}};return g(t),r.sequence(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a}),events:o.__assign(o.__assign({},e.events),{updated:!0})}},i.actions.openPage({index:s})])}}},u=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1})}}},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillRowActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),s=n(2995);t.fillRowActions={ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece)return a.sequence(e,[function(e){return c(e)},r.actions.ontouchMoveField({index:t})])}},ontouchMoveField:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece)return a.sequence(e,[function(e){return u(e,t,!0)},r.actions.reopenCurrentPage()])}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=e.fumen.pages,n=e.fumen.currentIndex,o=t[n],i=e.events.prevPage;return a.sequence(e,[d,void 0!==i?r.actions.registerHistoryTask({task:s.toSinglePageTask(n,i,o)}):void 0])}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){if(void 0===e.events.piece)return a.sequence(e,[function(e){return c(e)},r.actions.ontouchMoveSentLine({index:t})])}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece)return a.sequence(e,[function(e){return u(e,t,!1)},r.actions.reopenCurrentPage()])}}};var c=function(e){var t=e.fumen.pages,n=e.fumen.currentIndex;return{events:o.__assign(o.__assign({},e.events),{piece:e.mode.piece?e.mode.piece:i.Piece.Empty,updated:!1,prevPage:s.toPrimitivePage(t[n])})}},u=function(e,t,n){var s=e.events.piece;if(void 0!==s){var c=e.fumen.currentIndex,u=e.fumen.pages,d=u[c];if(void 0!==d){d.commands||(d.commands={pre:{}});for(var l=t%10,f=Math.floor(t/10),p=0;p<10;p+=1){var g=p+10*f,m=n?"block":"sentBlock",h=m+"-"+g,v=e.cache.currentInitField.getAtIndex(g,!0);l!==p&&v!==s?d.commands.pre[h]={x:p,piece:s,type:m,y:f}:l===p&&v!==i.Piece.Empty?d.commands.pre[h]={x:p,type:m,piece:i.Piece.Empty,y:f}:delete d.commands.pre[h]}return a.sequence(e,[function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:u})}},r.actions.reopenCurrentPage()])}}},d=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1})}}},2281:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mementoActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(6266);t.mementoActions={registerHistoryTask:function(e){var n=e.task,o=e.mergeKey;return function(e){var r=a.memento.register(n,o);return i.sequence(e,[t.mementoActions.setHistoryCount({undoCount:r,redoCount:0}),s])}},undo:function(){return function(e){return 0<e.events.inferences.length?i.sequence(e,[r.actions.clearInferencePiece(),r.actions.openPage({index:e.fumen.currentIndex})]):e.history.undoCount<=0?void 0:i.sequence(e,[function(e){o.__awaiter(void 0,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return[4,a.memento.undo(e.fumen.pages)];case 1:return void 0!==(t=n.sent())&&r.main.loadPagesViaHistory(t),[2]}}))}))}])}},redo:function(){return function(e){if(!(e.history.redoCount<=0))return i.sequence(e,[r.actions.fixInferencePiece(),r.actions.clearInferencePiece(),function(e){o.__awaiter(void 0,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return[4,a.memento.redo(e.fumen.pages)];case 1:return void 0!==(t=n.sent())&&r.main.loadPagesViaHistory(t),[2]}}))}))}])}},loadPagesViaHistory:function(e){var t=e.pages,n=e.index,o=e.undoCount,a=e.redoCount;return function(e){return i.sequence(e,[r.actions.setPages({pages:t,open:!1}),r.actions.openPage({index:n}),r.actions.setHistoryCount({undoCount:o,redoCount:a}),s])}},setHistoryCount:function(e){var t=e.undoCount,n=e.redoCount;return function(){return{history:{undoCount:t,redoCount:n}}}}};var s=function(e){a.memento.save(e.fumen.pages)}},7270:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modalActions=void 0;var o=n(655),i=n(9609);t.modalActions={showOpenErrorMessage:function(e){var t=e.message;return function(e){return i.sequence(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{errorMessage:t})}}])}},openFumenModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{fumen:!0})}}},openMenuModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{menu:!0})}}},openAppendModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{append:!0})}}},openClipboardModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{clipboard:!0})}}},closeFumenModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{fumen:!1})}}},closeMenuModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{menu:!1})}}},closeAppendModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{append:!1})}}},closeClipboardModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{clipboard:!1})}}},closeAllModals:function(){return function(){return{modal:{append:!1,fumen:!1,menu:!1,clipboard:!1}}}}}},2579:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.movePieceActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(9774),s=n(2995),c=n(1983),u=n(8711);t.movePieceActions={ontouchStartField:function(e){var n=e.index;return function(e){if(!e.events.drawing)return r.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{drawing:!0,prevPage:s.toPrimitivePage(e.fumen.pages[e.fumen.currentIndex]),updated:!1})}},t.movePieceActions.ontouchMoveField({index:n})])}},ontouchMoveField:function(e){var t=e.index;return function(e){if(e.events.drawing){var n=e.fumen.pages,s=e.fumen.currentIndex,d=n[s];if(void 0!==d){var l=d.piece;if(void 0!==l&&a.isMinoPiece(l.type)){var f=t%10,p=Math.floor(t/10),g=u.getBlockPositions(l.type,l.rotation,f,p);if(!g.some((function(e){return e[0]<0||10<=e[0]||e[1]<0||24<=e[1]}))){var m=new c.Pages(n).getField(s,c.PageFieldOperation.Command);if(!g.map(a.toPositionIndex).some((function(e){return m.getAtIndex(e,!0)!==a.Piece.Empty})))return d.piece=o.__assign(o.__assign({},l),{coordinate:{x:f,y:p}}),r.sequence(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n}),events:o.__assign(o.__assign({},e.events),{updated:!0})}},i.actions.reopenCurrentPage()])}}}}}},ontouchEnd:function(){return function(e){if(e.events.drawing){var t=e.fumen.currentIndex,n=e.fumen.pages[t],a=e.events.updated;return r.sequence(e,[a&&void 0!==e.events.prevPage?i.actions.registerHistoryTask({task:s.toSinglePageTask(t,e.events.prevPage,n)}):void 0,function(){return{events:o.__assign(o.__assign({},e.events),{prevPage:void 0,updated:!1,drawing:!1})}}])}}}}},2265:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseToBlocks=t.pageActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(9774),s=n(1983),c=n(2995),u=n(8286),d=n(9782);t.pageActions={reopenCurrentPage:function(){return function(e){return t.pageActions.openPage({index:e.fumen.currentIndex})(e)}},openPage:function(e){var n=e.index;return function(e){var c,u,d,l=new s.Pages(e.fumen.pages),f=l.getComment(n);!function(e){return void 0!==e.quiz}(f)?(c=f.text,u=f.next,d=void 0):(c=f.quiz,""!==f.quiz&&(u=f.quizAfterOperation.getNextPieces(5).filter((function(e){return e!==a.Piece.Empty})),d=f.quizAfterOperation.getHoldPiece()));var p=l.getField(n,s.PageFieldOperation.None),g=e.fumen.pages[n],m=t.parseToBlocks(p,g.piece,g.commands),h=void 0===e.fumen.pages[0]||e.fumen.pages[0].flags.colorize;return r.sequence(e,[e.play.status===a.AnimationState.Play?i.actions.startAnimation():void 0,e.fumen.currentIndex!==n?i.actions.fixInferencePiece():void 0,e.fumen.currentIndex!==n?i.actions.clearInferencePiece():void 0,e.fumen.currentIndex!==n?i.actions.commitCommentText():void 0,i.actions.setComment({comment:c}),i.actions.setField({field:m.playField,move:g.piece,filledHighlight:g.flags.lock,inferences:e.events.inferences,ghost:e.mode.ghostVisible,allowSplit:e.mode.touch===a.TouchTypes.Drawing}),i.actions.setFieldColor({guideLineColor:h}),i.actions.setSentLine({sentLine:m.sentLine}),i.actions.setHold({hold:d}),i.actions.setNext({next:u}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{currentIndex:n}),cache:o.__assign(o.__assign({},e.cache),{currentInitField:p})}}])}},openPageWhenChange:function(e){var n=e.index;return function(e){if(e.fumen.currentIndex!==n)return t.pageActions.openPage({index:n})(e)}},insertPage:function(e){var n=e.index;return function(e){var o=e.fumen.pages[n-1];return(void 0!==o&&void 0===o.field.obj?t.pageActions.insertRefPage:t.pageActions.insertKeyPage)({index:n})(e)}},insertRefPage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return r.sequence(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),l({index:t}),i.actions.reopenCurrentPage()])}},insertKeyPage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return r.sequence(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),f({index:t}),i.actions.reopenCurrentPage()])}},insertNewPage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return r.sequence(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),p({index:t}),i.actions.reopenCurrentPage()])}},duplicatePage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return r.sequence(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),g({index:t}),i.actions.reopenCurrentPage()])}},removePage:function(e){var t=e.index;return function(e){return r.sequence(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),m({index:t}),i.actions.reopenCurrentPage()])}},removeUnsettledItems:function(){return function(e){return i.actions.removeUnsettledItemsInField()(e)}},backLoopPage:function(){return function(e){var n=(e.fumen.currentIndex-1+e.fumen.maxPage)%e.fumen.maxPage;return t.pageActions.openPage({index:n})(e)}},nextLoopPage:function(){return function(e){var n=(e.fumen.currentIndex+1)%e.fumen.maxPage;return t.pageActions.openPage({index:n})(e)}},backPage:function(){return function(e){var n=e.fumen.currentIndex-1;if(!(n<0))return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),t.pageActions.openPage({index:n})])}},nextPage:function(){return function(e){var n=e.fumen,o=n.currentIndex+1;if(!(n.maxPage<=o))return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),t.pageActions.openPage({index:o})])}},nextPageOrNewPage:function(){return function(e){var n=e.fumen,o=n.currentIndex+1;return n.maxPage<=o?r.sequence(e,[t.pageActions.insertPage({index:o}),t.pageActions.openPage({index:o})]):r.sequence(e,[i.actions.nextPage()])}},firstPage:function(){return function(e){return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),t.pageActions.openPage({index:0})])}},lastPage:function(){return function(e){return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),t.pageActions.openPage({index:e.fumen.pages.length-1})])}},changeToRef:function(e){var n=e.index;return function(e){if(!(n<=0)){var a=c.toRefPageTask(n);return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.registerHistoryTask({task:a}),function(e){var t=new s.Pages(e.fumen.pages);return t.toRefPage(n),{fumen:o.__assign(o.__assign({},e.fumen),{pages:t.pages})}},function(e){return t.pageActions.openPage({index:e.fumen.currentIndex})(e)}])}}},changeToKey:function(e){var n=e.index;return function(e){if(!(n<=0)){var a=c.toKeyPageTask(n);return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.registerHistoryTask({task:a}),function(e){var t=new s.Pages(e.fumen.pages);return t.toKeyPage(n),{fumen:o.__assign(o.__assign({},e.fumen),{pages:t.pages})}},function(e){return t.pageActions.openPage({index:e.fumen.currentIndex})(e)}])}}},changeLockFlag:function(e){var t=e.index,n=e.enable;return function(e){var a=e.fumen.pages;if(!(t<0||a.length<=t)){var s=a[t],u=c.toPrimitivePage(s);s.flags.lock=n;var d=c.toSinglePageTask(t,u,s);return r.sequence(e,[i.actions.registerHistoryTask({task:d}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a})}},i.actions.reopenCurrentPage()])}}},changeRiseFlag:function(e){var t=e.index,n=e.enable;return function(e){var a=e.fumen.pages;if(!(t<0||a.length<=t)){var s=a[t],u=c.toPrimitivePage(s);s.flags.rise=n;var d=c.toSinglePageTask(t,u,s);return r.sequence(e,[i.actions.registerHistoryTask({task:d}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a})}}])}}},changeMirrorFlag:function(e){var t=e.index,n=e.enable;return function(e){var a=e.fumen.pages;if(!(t<0||a.length<=t)){var s=a[t],u=c.toPrimitivePage(s);s.flags.mirror=n;var d=c.toSinglePageTask(t,u,s);return r.sequence(e,[i.actions.registerHistoryTask({task:d}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a})}}])}}},clearToEnd:function(){return function(e){return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),h({pageIndex:e.fumen.currentIndex}),i.actions.reopenCurrentPage()])}},clearPast:function(){return function(e){return r.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),v({pageIndex:e.fumen.currentIndex}),i.actions.reopenCurrentPage()])}}},t.parseToBlocks=function(e,t,n){var o=function(e){return{piece:e}},i=e.toPlayFieldPieces().map(o),r=e.toSentLintPieces().map(o);return void 0!==n&&Object.keys(n.pre).map((function(e){return n.pre[e]})).forEach((function(e){switch(e.type){case"block":var t=e.x,n=e.y,o=e.piece;return void(i[t+10*n]={piece:o});case"sentBlock":return t=e.x,n=e.y,o=e.piece,void(r[t+10*n]={piece:o})}})),{playField:i,sentLine:r}};var l=function(e){var t=e.index;return function(e){var n=new s.Pages(e.fumen.pages);n.insertRefPage(t);var a=n.pages,u=c.toInsertPageTask(t,[c.toPrimitivePage(a[t])],e.fumen.currentIndex);return r.sequence(e,[i.actions.registerHistoryTask({task:u}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a,maxPage:a.length})}}])}},f=function(e){var t=e.index;return function(e){var n=new s.Pages(e.fumen.pages);n.insertKeyPage(t);var a=n.pages,u=c.toInsertPageTask(t,[c.toPrimitivePage(a[t])],e.fumen.currentIndex);return r.sequence(e,[i.actions.registerHistoryTask({task:u}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a,maxPage:a.length})}}])}},p=function(e){var t=e.index;return function(e){var n=e.fumen.pages,a=[],u=n[t];if(void 0!==u&&void 0!==u.field.ref){(f=new s.Pages(n)).toKeyPage(t),n=f.pages;var l=c.toKeyPageTask(t);a.push(l)}void 0!==u&&void 0!==u.comment.ref&&((f=new s.Pages(n)).freezeComment(t),n=f.pages,l=c.toFreezeCommentTask(t),a.push(l)),(f=new s.Pages(n)).insertKeyPage(t),n=f.pages,l=c.toInsertPageTask(t,[c.toPrimitivePage(n[t])],e.fumen.currentIndex),a.push(l);var f,p=n[t];void 0!==p&&void 0===p.comment.text&&((f=new s.Pages(n)).freezeComment(t),n=f.pages,l=c.toFreezeCommentTask(t),a.push(l));var g=c.toPrimitivePage(p);return void 0!==p.field.obj&&(p.field.obj=new d.Field({})),void 0!==p.comment.text&&(p.comment.text=""),l=c.toSinglePageTask(t,g,p),a.push(l),r.sequence(e,[i.actions.registerHistoryTask({task:c.toPageTaskStack(a,e.fumen.currentIndex)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n,maxPage:n.length,currentIndex:t})}}])}},g=function(e){var t=e.index;return function(e){var n=new s.Pages(e.fumen.pages);n.duplicatePage(t);var a=n.pages,u=c.toInsertPageTask(t,[c.toPrimitivePage(a[t])],e.fumen.currentIndex);return r.sequence(e,[i.actions.registerHistoryTask({task:u}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a,maxPage:a.length})}}])}},m=function(e){var t=e.index;return function(e){var n=e.fumen.pages;if(t<0)throw new u.FumenError("Illegal index: "+t);if(!(n.length<=1)){var a=n[t],d=t+1,l=n[d],f=new s.Pages(n),p=[];if(void 0!==l&&(void 0===l.field.obj&&(f.toKeyPage(d),p.push(c.toKeyPageTask(d))),void 0!==l.comment.ref&&(f.freezeComment(d),p.push(c.toFreezeCommentTask(d))),0===t&&a.flags.colorize!==l.flags.colorize)){var g=c.toPrimitivePage(l);l.flags.colorize=a.flags.colorize,p.push(c.toSinglePageTask(d,g,l))}var m=c.toPrimitivePage(a);f.deletePage(t,t+1),p.push(c.toRemovePageTask(t,t+1,[m],t));var h=f.pages,v=t<h.length?t:h.length-1;return r.sequence(e,[i.actions.registerHistoryTask({task:c.toPageTaskStack(p,t)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:h,maxPage:h.length,currentIndex:v})}}])}}},h=function(e){var t=e.pageIndex;return function(e){var n=e.fumen.pages;if(t<0)throw new u.FumenError("Illegal index: "+t);var a=t+1;if(!(n.length<=1||n.length<=a)){var d=new s.Pages(n),l=n.slice(a).map(c.toPrimitivePage);d.deletePage(a,n.length);var f=c.toRemovePageTask(a,n.length,l,t),p=d.pages,g=t<p.length?t:p.length-1;return r.sequence(e,[i.actions.registerHistoryTask({task:f}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:p,maxPage:p.length,currentIndex:g})}}])}}},v=function(e){var t=e.pageIndex;return function(e){var n=e.fumen.pages;if(t<0)throw new u.FumenError("Illegal index: "+t);if(!(n.length<=1||0===t)){var a=n[0];if(void 0!==a){var d=n[t],l=new s.Pages(n),f=[];if(void 0!==d&&(void 0===d.field.obj&&(l.toKeyPage(t),f.push(c.toKeyPageTask(t))),void 0!==d.comment.ref&&(l.freezeComment(t),f.push(c.toFreezeCommentTask(t))),a.flags.colorize!==d.flags.colorize)){var p=c.toPrimitivePage(d);d.flags.colorize=a.flags.colorize,f.push(c.toSinglePageTask(t,p,d))}var g=n.slice(0,t).map(c.toPrimitivePage);l.deletePage(0,t),f.push(c.toRemovePageTask(0,t,g,0));var m=l.pages;return r.sequence(e,[i.actions.registerHistoryTask({task:c.toPageTaskStack(f,t)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:m,maxPage:m.length,currentIndex:0})}},i.actions.reopenCurrentPage()])}}}}},6312:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.putPieceActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),s=n(2995),c=n(6886),u=n(3876),d=n(6266),l=n(2742),f=n(8711);t.putPieceActions={fixInferencePiece:function(){return function(e){var t=g(e);if(void 0!==t){var n=t.task;return p(t.pages,n)(e)}}},clearInferencePiece:function(){return function(e){return a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:[]}),cache:o.__assign(o.__assign({},e.cache),{taskKey:void 0})}}])}},resetInferencePiece:function(){return function(e){return a.sequence(e,[c.fieldEditorActions.clearInferencePiece(),r.actions.openPage({index:e.fumen.currentIndex})])}},ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece){var n=m(e,t);if(void 0!==n)return a.sequence(e,[function(){return n},r.actions.ontouchMoveField({index:t})]);var i=e.fumen.currentIndex+1;return a.sequence(e,[r.actions.insertPage({index:i}),r.actions.openPage({index:i}),function(e){return{cache:o.__assign(o.__assign({},e.cache),{taskKey:d.memento.lastKey()})}},function(e){return m(e,t)},r.actions.ontouchMoveField({index:t})])}}},ontouchMoveField:function(e){var t=e.index;return function(e){var n=e.events.piece;if(void 0!==n){var s=e.fumen.pages[e.fumen.currentIndex];if(void 0!==s&&void 0===s.piece){var c=e.events.inferences;if(n!==i.Piece.Empty){if(4<=c.length)return;if(e.field[t].piece!==i.Piece.Empty&&e.field[t].highlight!==l.HighlightType.Lighter)return;if(void 0===c.find((function(e){return e===t}))){var u=e.events.inferences.concat([t]);return a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:u,updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})])}}return n===i.Piece.Empty?a.sequence(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:e.events.inferences.filter((function(e){return e!==t})),updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})]):void 0}}}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=g(e);return a.sequence(e,[void 0!==t?p(t.pages,t.task,e.cache.taskKey):void 0,h])}}}};var p=function(e,t,n){return function(i){return a.sequence(i,[function(t){return{fumen:o.__assign(o.__assign({},t.fumen),{pages:e}),cache:o.__assign(o.__assign({},t.cache),{taskKey:void 0})}},c.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:t,mergeKey:n})])}},g=function(e){var t=e.events.inferences;if(!(t.length<4)){var n=u.inferPiece(t);if(n&&n.coordinate){var o=e.fumen.currentIndex,i=e.fumen.pages,r=i[o],a=s.toPrimitivePage(r);return r.piece={type:n.piece,rotation:n.rotate,coordinate:n.coordinate},{pages:i,task:s.toSinglePageTask(o,a,r)}}}},m=function(e,t){var n,r=e.fumen.pages,a=r[e.fumen.currentIndex],s=a.piece,c=void 0!==(n=void 0===s?e.events.inferences:f.getBlockPositions(s.type,s.rotation,s.coordinate.x,s.coordinate.y).map(i.toPositionIndex)).find((function(e){return e===t}));if(void 0===s||c)return a.piece=void 0,{fumen:o.__assign(o.__assign({},e.fumen),{pages:r}),events:o.__assign(o.__assign({},e.events),{inferences:n,piece:c?i.Piece.Empty:i.Piece.Gray,updated:!1})}},h=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1}),cache:o.__assign({},e.cache)}}},5597:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modeActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(9774),s=n(6314),c=n(8456);t.modeActions={changeToReaderScreen:function(){return function(e){return s.resources.konva.stage.reload((function(e){r.main.changeScreen({screen:a.Screens.Reader}),e()})),i.sequence(e,[r.actions.fixInferencePiece(),r.actions.resetInferencePiece()])}},changeToDrawerScreen:function(e){var t=e.refresh;return function(e){return s.resources.konva.stage.reload((function(e){r.main.changeScreen({screen:a.Screens.Editor}),e()})),i.sequence(e,[c.animationActions.pauseAnimation(),t?r.actions.changeToDrawingToolMode():void 0])}},changeToDrawingMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.Drawing}),d({type:a.ModeTypes.Drawing})])}},changeToDrawingToolMode:function(){return function(e){return i.sequence(e,[d({type:a.ModeTypes.DrawingTool})])}},changeToFlagsMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.Drawing}),d({type:a.ModeTypes.Flags})])}},changeToUtilsMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.Drawing}),d({type:a.ModeTypes.Utils})])}},changeToShiftMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.Drawing,clear:!0}),d({type:a.ModeTypes.Slide})])}},changeToFillRowMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.FillRow}),d({type:a.ModeTypes.FillRow}),function(e){return{mode:o.__assign(o.__assign({},e.mode),{piece:void 0!==e.mode.piece?e.mode.piece:a.Piece.Gray})}}])}},changeToPieceMode:function(){return function(e){return i.sequence(e,[d({type:a.ModeTypes.Piece})])}},changeToFillMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.Fill}),d({type:a.ModeTypes.Fill})])}},changeToDrawPieceMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.Piece}),d({type:a.ModeTypes.Piece})])}},changeToMovePieceMode:function(){return function(e){return i.sequence(e,[u({type:a.TouchTypes.MovePiece}),d({type:a.ModeTypes.Piece})])}},changeToSelectPieceMode:function(){return function(e){return i.sequence(e,[d({type:a.ModeTypes.SelectPiece})])}},changeScreen:function(e){var t=e.screen;return function(e){return{mode:o.__assign(o.__assign({},e.mode),{screen:t})}}},changeCommentMode:function(e){var t=e.type;return function(e){return{mode:o.__assign(o.__assign({},e.mode),{comment:t})}}},changeGhostVisible:function(e){var t=e.visible;return function(e){return{mode:o.__assign(o.__assign({},e.mode),{ghostVisible:t})}}}};var u=function(e){var t=e.type,n=e.clear,a=void 0!==n&&n;return function(e){return e.mode.touch===t?a?r.actions.removeUnsettledItems()(e):void 0:i.sequence(e,[r.actions.removeUnsettledItems(),function(){return{mode:o.__assign(o.__assign({},e.mode),{touch:t})}}])}},d=function(e){var t=e.type;return function(e){if(e.mode.type!==t)return{mode:o.__assign(o.__assign({},e.mode),{type:t})}}}},9986:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setterActions=void 0;var o=n(655),i=n(5917),r=n(9774),a=n(2742),s=n(3876),c=n(5187),u=n(8711);t.setterActions={setPages:function(e){var t=e.pages,n=e.open,r=void 0===n||n;return function(e){if(!(t.length<1))return r&&setTimeout((function(){i.main.openPage({index:0})}),0),{fumen:o.__assign(o.__assign({},e.fumen),{pages:t,maxPage:t.length})}}},inputFumenData:function(e){var t=e.value;return function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{value:t,errorMessage:void 0})}}},clearFumenData:function(){return function(e){return t.setterActions.inputFumenData({value:void 0})(e)}},setComment:function(e){var t=e.comment;return function(e){return{comment:{isChanged:void 0!==t&&t!==e.comment.text,text:void 0!==t?t:e.comment.text,changeKey:c.generateKey()}}}},setField:function(e){var t=e.field,n=e.move,i=e.filledHighlight,c=e.inferences,d=e.ghost,l=e.allowSplit;return function(){var e=t.concat(),f=void 0;if(void 0!==n&&d)for(var p=n.type,g=n.coordinate.y-1;0<=g&&u.getBlockPositions(p,n.rotation,n.coordinate.x,g).every((function(t){var n=t[0],o=t[1];return r.isInPlayField(n,o)&&e[n+10*o].piece===r.Piece.Empty}));g-=1)f=g;if(void 0!==n)for(var m=n.type,h=0,v=u.getBlockPositions(m,n.rotation,n.coordinate.x,n.coordinate.y);h<v.length;h++){var y=v[h],x=y[0],P=y[1];r.isInPlayField(x,P)&&(e[x+10*P]={piece:m,highlight:a.HighlightType.Highlight2})}if(i)for(P=0;P<r.FieldConstants.Height+r.FieldConstants.SentLine;P+=1){var b=[P*r.FieldConstants.Width,(P+1)*r.FieldConstants.Width],w=b[0],k=b[1];if(e.slice(w,k).every((function(e){return e.piece!==r.Piece.Empty})))for(var _=w;_<k;_+=1)if(void 0!==(M=e[_])){var T=M.highlight;e[_].highlight=void 0!==T&&a.HighlightType.Highlight1<T?T:a.HighlightType.Highlight1}else e[_]=o.__assign({},t[_])}if(void 0!==n&&void 0!==f)for(var C=n.type,S=0,z=u.getBlockPositions(C,n.rotation,n.coordinate.x,f);S<z.length;S++){var M,F=z[S];x=F[0],P=F[1],void 0!==(M=e[x+10*P])&&M.piece!==r.Piece.Empty||(e[x+10*P]={piece:C,highlight:a.HighlightType.Lighter})}var R=void 0,I=s.inferPiece(c);if(I&&(I.coordinate||!I.coordinate&&l)&&(R=I.piece),R)for(var E=0,B=c;E<B.length;E++){var L=B[E];e[L]=o.__assign(o.__assign({},t[L]),{piece:R,highlight:a.HighlightType.Highlight2})}else for(var O=0,A=c;O<A.length;O++)L=A[O],e[L]=o.__assign(o.__assign({},t[L]),{piece:"inference",highlight:a.HighlightType.Highlight2});return{field:e}}},setFieldColor:function(e){var t=e.guideLineColor;return function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{guideLineColor:t})}}},setSentLine:function(e){var t=e.sentLine;return function(){return{sentLine:t}}},setHold:function(e){var t=e.hold;return function(){return{hold:t}}},setNext:function(e){var t=e.next;return function(){return{nexts:t}}}}},9632:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utilsActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(2315),s=n(4257),c=n(8286),u=n(2995),d=n(1983);t.utilsActions={resize:function(e){var t=e.width,n=e.height;return function(e){return{display:o.__assign(o.__assign({},e.display),{width:t,height:n})}}},loadFumen:function(e){var t=e.fumen,n=e.purgeOnFailed,i=void 0!==n&&n;return function(){r.main.pauseAnimation(),void 0!==t?o.__awaiter(void 0,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,a.decode(t)];case 1:return e=o.sent(),[3,3];case 2:return n=o.sent(),console.error(n),i?r.main.loadNewFumen():n instanceof c.FumenError?r.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.FailedToLoad()}):r.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.Unexpected(n.message)}),[2];case 3:try{r.main.loadPages({pages:e,loadedFumen:t}),r.main.closeAllModals(),r.main.clearFumenData()}catch(e){console.error(e),i?r.main.loadNewFumen():r.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.Unexpected(e.message)})}return[2]}}))})):r.main.showOpenErrorMessage({message:"データを入力してください"})}},loadNewFumen:function(){return function(e){return t.utilsActions.loadFumen({fumen:"v115@vhAAgH"})(e)}},loadPages:function(e){var t=e.pages,n=e.loadedFumen;return function(e){var o=e.fumen.pages.map(u.toPrimitivePage),a=e.fumen.currentIndex;return i.sequence(e,[r.actions.setPages({pages:t}),r.actions.registerHistoryTask({task:u.toFumenTask(o,n,a)})])}},appendFumen:function(e){var t=e.fumen,n=e.pageIndex;return function(){r.main.pauseAnimation(),void 0!==t?o.__awaiter(void 0,void 0,void 0,(function(){var e,i;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,a.decode(t)];case 1:return e=o.sent(),[3,3];case 2:return i=o.sent(),console.error(i),i instanceof c.FumenError?r.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.FailedToLoad()}):r.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.Unexpected(i.message)}),[2];case 3:try{r.main.appendPages({pages:e,pageIndex:n}),r.main.closeAllModals(),r.main.clearFumenData()}catch(e){console.error(e),r.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.Unexpected(e.message)})}return[2]}}))})):r.main.showOpenErrorMessage({message:"データを入力してください"})}},appendPages:function(e){var t=e.pages,n=e.pageIndex;return function(e){return i.sequence(e,[l({pageIndex:n,appendedPages:t,indexAfterReverting:e.fumen.currentIndex})])}},refresh:function(){return function(){return{}}},ontapCanvas:function(e){return function(t){var n=e.currentTarget.getStage();return(n.getPointerPosition().x/n.getSize().width<.5?r.actions.backPage():r.actions.nextPage())(t)}}};var l=function(e){var t=e.pageIndex,n=e.appendedPages,a=e.indexAfterReverting;return function(e){var s=e.fumen.pages;if(t<0)throw new c.FumenError("Illegal index: "+t);var l=s[t],f=new d.Pages(s),p=[];if(void 0!==l){void 0===l.field.obj&&(f.toKeyPage(t),p.push(u.toKeyPageTask(t))),void 0!==l.comment.ref&&(f.freezeComment(t),p.push(u.toFreezeCommentTask(t)));var g=s[0];if(void 0===g||g.flags.colorize!==l.flags.colorize){var m=u.toPrimitivePage(l);l.flags.colorize=void 0===g||g.flags.colorize,p.push(u.toSinglePageTask(t,m,l))}}var h=n.map(u.toPrimitivePage);f.insertPage(t,n),p.push(u.toInsertPageTask(t,h,a));var v=f.pages;return i.sequence(e,[r.actions.registerHistoryTask({task:u.toPageTaskStack(p,a)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:v,maxPage:v.length,currentIndex:t})}},r.actions.reopenCurrentPage()])}}},3149:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Box=void 0;var o=n(6540),i=n(9774),r=n(8711);t.Box=function(e){var t=e.key,n=e.size,s=e.topLeft,c=e.piece,u=e.rects,d=[];if(void 0!==c){var l=c.size,f={width:l,height:l};d=function(e,t,n,o,i){for(var a=r.getPieces(t).map((function(e){return[e[0],-e[1]]})),s={max:{x:0,y:0},min:{x:0,y:0}},c=0,u=a;c<u.length;c++){var d=u[c],l=d[0],f=d[1];s.max.x<l?s.max.x=l:l<s.min.x&&(s.min.x=l),s.max.y<f?s.max.y=f:f<s.min.y&&(s.min.y=f)}var p=(s.max.x-s.min.x+1)/2+s.min.x,g=(s.max.y-s.min.y+1)/2+s.min.y,m=function(e){return e*(o+1)+.5},h=e.x+n.width/2,v=e.y+n.height/2;return a.map((function(e){var t=e[0],n=e[1];return{x:h+m(t-p),y:v+m(n-g)}}))}(s,c.type,n,l).map((function(e,n){var i=t+"-"+n;return o.h(a,{key:i,dataTest:i,rect:u.pieces[n],size:f,fillColor:c.color,strokeColor:"#333",strokeWidth:0,position:e})}))}var p=void 0!==c?c.type:i.Piece.Empty;return o.h("div",null,o.h(a,{key:t,dataTest:t,rect:u.background,type:p,size:n,fillColor:"#333",strokeColor:"#666",strokeWidth:1,position:s}),d)};var a=function(e){var t=e.key,n=e.dataTest,i=e.rect,r=e.fillColor,a=e.position,s=e.size,c=e.strokeWidth,u=e.strokeColor,d=e.type,l=function(){return i.setSize(s)},f=function(){return i.setAbsolutePosition(a)},p=function(){return i.fill(r)},g=function(){return i.stroke(u)},m=function(){return i.strokeWidth(c)},h=function(){return i.strokeEnabled(0<c)};return o.h("param",{name:"konva",value:t,key:t,datatest:n,type:d,oncreate:function(){l(),f(),p(),h(),g(),m(),i.show()},onupdate:function(e,t){s.width===t.size.width&&s.height===t.size.height||l(),a.x===t.position.x&&a.y===t.position.y||f(),r!==t.color&&p(),u!==t.strokeColor&&g(),c!==t.strokeWidth&&(h(),m())},ondestroy:function(){i.hide()},color:r,position:a,size:s,strokeColor:u,strokeWidth:c})}},4264:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.comment=void 0;var o=n(4055),i=n(4361);t.comment=function(e){var t=e.height,n=e.textColor,r=e.backgroundColorClass,a=e.dataTest,s=e.key,c=e.id,u=e.text,d=e.readonly,l=e.placeholder,f=e.commentKey,p=e.actions,g=o.style({width:"100%",height:o.px(t),lineHeight:o.px(t),fontSize:o.px(.6*t),boxSizing:"border-box",textAlign:"center",border:"none",color:n}),m=function(e,t){t.commentKey!==f&&(e.value=u)},h=!0;return i.div({key:s,style:o.style({width:"100%",height:o.px(t),whiteSpace:"nowrap"})},[i.input({key:s,dataTest:a,id:c,placeholder:l,commentKey:f,type:"text",className:r,style:g,readonly:d?"readonly":void 0,oncreate:function(e){m(e,{})},onupdate:m,onkeydown:void 0!==p?function(e){"Enter"===e.key&&(h=e.isComposing)}:void 0,onkeyup:void 0!==p?function(e){e.isComposing||(p.onupdate(),h||"Enter"!==e.key||p.onenter())}:void 0,onblur:void 0!==p?function(){p.onblur()}:void 0})])}},6100:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawingEventCanvas=void 0;var o=n(6540);n(5917),t.DrawingEventCanvas=function(e){var t=e.fieldBlocks,n=e.sentBlocks,i=e.fieldLayer,r=e.actions;return o.h("param",{key:"drawing-event-canvas",name:"konva",value:"draw-event-box",oncreate:function(){var e={mouseOnField:!1,addBodyEvent:!1};t.forEach((function(e,t){e.on("touchstart mousedown",(function(){r.ontouchStartField({index:t})})),e.on("touchmove mouseenter",(function(){r.ontouchMoveField({index:t})})),e.on("touchend mouseup",(function(){r.ontouchEnd()}))})),n.forEach((function(e,t){e.on("touchstart mousedown",(function(){r.ontouchStartSentLine({index:t})})),e.on("touchmove mouseenter",(function(){r.ontouchMoveSentLine({index:t})})),e.on("touchend mouseup",(function(){r.ontouchEnd()}))})),i.on("touchleave mouseleave",(function(){e.mouseOnField=!1,e.addBodyEvent||(e.addBodyEvent=!0,document.body.addEventListener("mouseup",(function(){e.addBodyEvent=!1,e.mouseOnField||r.ontouchEnd()}),{once:!0}))})),i.on("touchenter mouseenter",(function(){e.mouseOnField=!0}))},ondestroy:function(){t.forEach((function(e){e.off("touchstart mousedown"),e.off("touchmove mouseenter"),e.off("touchend mouseup")})),n.forEach((function(e){e.off("touchstart mousedown"),e.off("touchmove mouseenter"),e.off("touchend mouseup")})),i.off("touchleave mouseleave"),i.off("touchenter touchenter")}})}},5154:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventCanvas=void 0;var o=n(6540);t.EventCanvas=function(e){var t=e.rect,n=e.canvas,i=e.actions,r=function(){return t.setSize(n)};return o.h("param",{key:"reader-event-canvas",name:"konva",value:"event-box",canvas:n,oncreate:function(){r(),t.show(),t.on("tap click",i.ontapCanvas)},onupdate:function(e,t){n.width===t.canvas.width&&n.height===t.canvas.height||r()},ondestroy:function(){t.off("tap click"),t.hide()}})}},8174:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0;var o=n(6540),i=n(9774),r=n(3891),a=n(6314);t.Field=function(e){var t=e.topLeft,n=e.field,u=e.sentLine,d=e.blockSize,l=e.fieldMarginWidth,f=e.guideLineColor,p=t.y+22.5*(d+1)+1,g=a.resources.konva.fieldBlocks.map((function(e,a){var c=[a%10,Math.floor(a/10)],u=c[0],l=c[1],p=22-l,g=n[u+10*l],m="block-"+u+"-"+l,h={width:d,height:0!==p?d:d/2},v={x:t.x+u*d+u+1,y:t.y+Math.max(0,p-.5)*d+p+1},y=g.piece===i.Piece.Empty?r.decideBackgroundColor(l):r.decidePieceColor(g.piece,g.highlight,f);return o.h(s,{key:m,dataTest:m,size:h,position:v,color:y,rect:e})})),m=a.resources.konva.sentBlocks.map((function(e,n){var i=[n%10,Math.floor(n/10)],a=i[0],c=i[1],g=u[a+10*c],m="sent-block-"+a+"-"+c,h={width:d,height:d},v={x:t.x+a*d+a+1,y:p+l},y=r.decidePieceColor(g.piece,g.highlight,f);return o.h(s,{key:m,dataTest:m,size:h,position:v,color:y,rect:e})})),h={width:10*(d+1)+1,height:23.5*(d+1)+1+l};return o.h("div",null,o.h(s,{key:"field-bg",dataTest:"field-bg",rect:a.resources.konva.background,size:h,position:t,color:"#333"}),g,o.h(c,{key:"field-margin",dataTest:"field-margin",line:a.resources.konva.fieldMarginLine,width:l,color:"#d8d8d8",start:{x:t.x,y:p+l/2},end:{x:t.x+h.width,y:p+l/2}}),m)};var s=function(e){var t=e.key,n=e.dataTest,i=e.rect,r=e.color,a=e.position,s=e.size,c=function(){return i.setSize(s)},u=function(){return i.setAbsolutePosition(a)},d=function(){return i.fill(r)};return o.h("param",{name:"konva",value:t,key:t,datatest:n,oncreate:function(){c(),u(),d(),i.show()},onupdate:function(e,t){s.width===t.size.width&&s.height===t.size.height||c(),a.x===t.position.x&&a.y===t.position.y||u(),r!==t.color&&d()},ondestroy:function(){i.hide()},color:r,position:a,size:s})},c=function(e){var t=e.key,n=e.dataTest,i=e.line,r=e.color,a=e.width,s=e.start,c=e.end,u=function(){return i.points([s.x,s.y,c.x,c.y])},d=function(){return i.strokeWidth(a)},l=function(){return i.stroke(r)};return o.h("param",{name:"konva",value:t,key:t,datatest:n,oncreate:function(){u(),d(),l(),i.show()},onupdate:function(e,t){s.x===t.start.x&&s.y===t.start.y&&c.x===t.end.x&&c.y===t.end.y||u(),a!==t.width&&d(),r!==t.color&&l()},ondestroy:function(){i.hide()},color:r,start:s,end:c,width:a})}},4245:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KonvaCanvas=void 0;var o=n(655),i=n(4055),r=n(6314),a=n(6540),s=o.__importDefault(n(185));t.KonvaCanvas=function(e){var t=e.canvas,n=e.hyperStage,c=e.actions,u=i.style({width:i.px(t.width),height:i.px(t.height)});return a.h("div",{canvas:t,id:"canvas-container",style:u,oncreate:function(e){var i=new s.default.Stage(o.__assign(o.__assign({},t),{container:e}));i.add(r.resources.konva.layers.background),i.add(r.resources.konva.layers.field),i.add(r.resources.konva.layers.boxes),i.add(r.resources.konva.layers.overlay),n.addStage(i),c.refresh()},onupdate:function(e,o){t.width===o.canvas.width&&t.height===o.canvas.height||n.resize(t)},ondestroy:function(){n.removeStage()}})}},1336:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonIconContent=t.Button=t.AppendFumenModal=void 0;var o=n(4055),i=n(6540),r=n(6314),a=n(4257);t.AppendFumenModal=function(e){var n=e.textAreaValue,s=e.errorMessage,c=e.currentIndex,u=e.maxPage,d=e.actions,l=o.style({width:"100%",border:void 0!==s?"solid 1px #ff5252":void 0}),f=function(){var e=document.getElementById("input-fumen");if(null!==e)return""!==e.value?e.value:""};return i.h("div",{key:"append-fumen-modal-top"},i.h("div",{key:"mdl-append-fumen",datatest:"mdl-append-fumen",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onOpenEnd:function(){var e=document.getElementById("input-fumen");null!==e&&e.focus()},onCloseStart:function(){d.closeAppendModal()}});t.open(),r.resources.modals.append=t},ondestroy:function(){var e=r.resources.modals.append;void 0!==e&&e.close(),r.resources.modals.append=void 0}},i.h("div",{key:"modal-content",className:"modal-content"},i.h("h4",{key:"append-fumen-label",dataTest:"append-fumen-label"},a.i18n.AppendFumen.Title()),i.h("textarea",{key:"input-fumen",dataTest:"input-fumen",id:"input-fumen",rows:3,style:l,oninput:function(e){if("insertLineBreak"!==e.inputType){var t=f(),o=null!=t?t:"";void 0===s&&""!==o&&""!==n||d.inputFumenData({value:o})}else{var i=document.getElementById("btn-open");null!==i&&i.click()}},onblur:function(){var e=f();n!==e&&d.inputFumenData({value:e})},value:n,placeholder:a.i18n.AppendFumen.PlaceHolder()}),i.h("span",{key:"text-message",datatest:"text-message",className:"red-text text-accent-2",style:o.style({display:void 0!==s?void 0:"none"})},s)),i.h("div",{key:"modal-footer",className:"modal-footer"},i.h(t.Button,{key:"btn-cancel",datatest:"btn-cancel",width:40,enable:!0,onclick:function(){return d.closeAppendModal(),void d.clearFumenData()}},i.h(t.ButtonIconContent,{iconSize:20,iconName:"delete"})),i.h(t.Button,{key:"btn-append-to-next",datatest:"btn-append-to-next",width:80,colorTheme:"teal",enable:""!==n&&void 0===s,onclick:function(){return function(){var e=f();d.inputFumenData({value:e}),void 0!==e&&d.appendFumen({fumen:e,pageIndex:c+1});var t=document.getElementById("input-fumen");null!==t&&t.focus()}()}},i.h(t.ButtonIconContent,{iconSize:20,iconName:"library_add"},"next")),i.h(t.Button,{key:"btn-append-to-end",datatest:"btn-append-to-end",width:80,colorTheme:"teal",enable:""!==n&&void 0===s,onclick:function(){return function(){var e=f();d.inputFumenData({value:e}),void 0!==e&&d.appendFumen({fumen:e,pageIndex:u});var t=document.getElementById("input-fumen");null!==t&&t.focus()}()}},i.h(t.ButtonIconContent,{iconSize:20,iconName:"library_add"},"end")))))},t.Button=function(e,t){e.href;var n=e.key,r=e.onclick,a=e.datatest,s=e.width,c=e.colorTheme,u=e.enable,d=void 0!==c?"waves-effect waves-"+c+" btn white-text "+(u?"":"disabled"):"waves-effect waves-light btn-flat black-text "+(u?"":"disabled");return i.h("a",{href:"#",key:n,datatest:a,className:d,onclick:r,style:o.style({margin:"0px 5px",padding:o.px(5),width:o.px(s),maxWidth:o.px(s),textAlign:"center"})},i.h("div",{style:o.style({width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"})},t))},t.ButtonIconContent=function(e,t){var n=e.iconSize,r=e.iconName,a=e.textSize,s=void 0===a?13:a;return i.h("div",null,i.h("i",{className:"material-icons left",style:o.style({display:"block",fontSize:o.px(n),border:"solid 0px #000",marginRight:o.px(2),cursor:"pointer"})},r),i.h("span",{style:o.style({fontSize:o.px(s)})},t))}},1699:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClipboardIconButton=t.ClipboardButton=t.ClipboardModal=void 0;var o=n(655),i=n(4055),r=n(6540),a=n(6314),s=n(4257),c=n(2315),u=n(8286);t.ClipboardModal=function(e){var n=e.actions,d=e.pages,l=o.__awaiter(void 0,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,c.encode(d)];case 1:return[2,"v115@"+e.sent()]}}))})),f=function(e){return function(){var t=void 0;l.then((function(e){return document.body.setAttribute("datatest","copied-fumen-data"),document.body.setAttribute("data",e),e})).then((function(t){return""+e+t})).then((function(e){if(!(t=document.createElement("pre")))throw new u.FumenError("no element");var n=t.style;n.position="fixed",n.left="-100%",t.textContent=e,document.body.appendChild(t);var o=document.getSelection();if(null===o)throw new u.FumenError("no selection");if(o.selectAllChildren(t),!document.execCommand("copy"))throw new u.FumenError("command error")})).then((function(){M.toast({html:"Copied to clipboard",classes:"top-toast",displayLength:1e3})})).catch((function(e){M.toast({html:"Failed to copy: "+e,classes:"top-toast",displayLength:1500})})).finally((function(){t&&document.body.removeChild(t)}))}},p=function(e){return function(){l.then((function(t){return""+e+t})).then((function(e){var t=document.querySelector("form[name=clipboard-form]");if(null==t)throw new Error("Not found form element");var n=t.querySelector("input[name=url]");if(null==n)throw new Error("Not found url element");n.value=e,t.submit()})).catch((function(e){M.toast({html:"Failed to open tinyurl: "+e,classes:"top-toast",displayLength:1500})}))}};return r.h("div",{key:"clipboard-modal-top"},r.h("div",{key:"mdl-clipboard",datatest:"mdl-clipboard",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onCloseStart:function(){n.closeClipboardModal()}});t.open(),a.resources.modals.clipboard=t},ondestroy:function(){var e=a.resources.modals.clipboard;void 0!==e&&e.close(),a.resources.modals.clipboard=void 0}},r.h("div",{key:"modal-content",className:"modal-content"},r.h("h4",{key:"clipboard-label",dataTest:"clipboard-label"},s.i18n.Clipboard.Title()),r.h("div",{style:i.style({margin:"0px auto",padding:"0px",display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"center"})},r.h("form",{name:"clipboard-form",style:i.style({margin:"0px"}),action:"http://tinyurl.com/create.php",method:"get",target:"_blank"},r.h("input",{type:"hidden",name:"url",id:"url",value:"https://knewjade.github.io/fumen-for-mobile/#?d=v115@vhAAgH"}),r.h("div",null,r.h(t.ClipboardButton,{key:"btn-knewjade",onclick:f("https://knewjade.github.io/fumen-for-mobile/#?d=")},"THIS SITE"),r.h(t.ClipboardIconButton,{key:"btn-knewjade-tinyurl",onclick:p("https://knewjade.github.io/fumen-for-mobile/#?d=")},"archive")),r.h("div",null,r.h(t.ClipboardButton,{key:"btn-zui-jp",onclick:f("http://fumen.zui.jp/?")},"FUMEN.ZUI.JP"),r.h(t.ClipboardIconButton,{key:"btn-zui-jp-tinyurl",onclick:p("http://fumen.zui.jp/?")},"archive")),r.h("div",null,r.h(t.ClipboardButton,{key:"btn-harddrop",onclick:f("http://harddrop.com/fumen/?")},"HARDDROP"),r.h(t.ClipboardIconButton,{key:"btn-harddrop-tinyurl",onclick:p("http://harddrop.com/fumen/?")},"archive")),r.h("div",null,r.h(t.ClipboardButton,{key:"btn-raw-fumen",colorName:"white black-text",onclick:f("")},"RAW DATA"))))),r.h("div",{key:"modal-footer",className:"modal-footer"},r.h("a",{href:"#",key:"btn-clipboard-cancel",datatest:"btn-clipboard-cancel",id:"btn-clipboard-cancel",className:"waves-effect waves-teal btn-flat",onclick:function(){n.closeClipboardModal()}},s.i18n.Clipboard.Buttons.Close()))))},t.ClipboardButton=function(e,t){var n=e.key,o=e.onclick,a=e.colorName,s=void 0===a?"red white-text":a,c=e.padding,u=void 0===c?8:c,d=e.textSize,l=void 0===d?17:d;return r.h("a",{href:"#",key:n,datatest:n,id:n,fontSize:i.px(l),style:i.style({minWidth:i.px(165),margin:i.px(5),paddingLeft:i.px(u),paddingRight:i.px(u)}),className:"waves-effect waves-teal btn "+s,onclick:function(e){o(),e.stopPropagation(),e.preventDefault()}},t)},t.ClipboardIconButton=function(e,t){var n=e.key,o=e.onclick,a=e.padding,s=void 0===a?10:a,c=e.textSize,u=void 0===c?20:c,d=i.style({display:"block",fontSize:i.px(u),border:"solid 0px #000",marginRight:i.px(2),cursor:"pointer"});return r.h("a",{href:"#",key:n,datatest:n,id:n,fontSize:i.px(u),style:i.style({margin:i.px(5),paddingLeft:i.px(s),paddingRight:i.px(s)}),className:"waves-effect waves-teal btn white black-text",onclick:function(e){o(),e.stopPropagation(),e.preventDefault()}},r.h("i",{className:"material-icons",style:d},t))}},5874:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingButton=t.MenuModal=void 0;var o=n(4055),i=n(6540),r=n(6314),a=n(9774),s=n(4257);t.MenuModal=function(e){var n=e.version,c=e.screen,u=e.currentIndex,d=e.maxPageIndex,l=e.comment,f=e.ghostVisible,p=e.actions,g=o.style({margin:0,padding:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"start",alignItems:"center"});return i.h("div",{key:"menu-modal-top"},i.h("div",{key:"mdl-open-fumen",datatest:"mdl-open-fumen",className:"modal bottom-sheet",oncreate:function(e){var t=M.Modal.init(e,{onOpenEnd:function(){var e=document.getElementById("textarea-fumen");null!==e&&e.focus()},onCloseStart:function(){p.closeMenuModal()}});t.open(),r.resources.modals.menu=t},ondestroy:function(){var e=r.resources.modals.menu;void 0!==e&&e.close(),r.resources.modals.menu=void 0}},i.h("div",{key:"modal-content",className:"modal-content"},i.h("h4",{key:"memu-title"},s.i18n.Menu.Title()," ",i.h("span",{style:o.style({color:"#999",fontSize:"50%"})},"[",s.i18n.Menu.Build(n),"]")),i.h("div",{key:"menu-top",style:g},c===a.Screens.Editor?i.h(t.SettingButton,{key:"btn-readonly",datatest:"btn-readonly",href:"#",icons:[{name:"visibility",size:31.25}],onclick:function(){p.changeToReaderScreen(),p.closeMenuModal()}},s.i18n.Menu.Buttons.Readonly()):void 0,c===a.Screens.Reader?i.h(t.SettingButton,{key:"btn-writable",datatest:"btn-writable",href:"#",icons:[{name:"mode_edit",size:31.25}],onclick:function(){p.changeToDrawerScreen({refresh:!0}),p.closeMenuModal()}},s.i18n.Menu.Buttons.Writable()):void 0,i.h(t.SettingButton,{key:"btn-copy-fumen",datatest:"btn-copy-fumen",href:"#",icons:[{name:"content_copy",size:29.3}],onclick:function(){p.fixInferencePiece(),p.closeMenuModal(),p.openClipboardModal()}},s.i18n.Menu.Buttons.Clipboard()),i.h(t.SettingButton,{key:"btn-new-fumen",datatest:"btn-new-fumen",href:"#",icons:[{name:"insert_drive_file",size:32.3}],onclick:function(){p.fixInferencePiece(),p.clearInferencePiece(),p.loadNewFumen(),p.changeToDrawerScreen({refresh:!0}),p.closeMenuModal()}},s.i18n.Menu.Buttons.New()),i.h(t.SettingButton,{key:"btn-open-fumen",datatest:"btn-open-fumen",href:"#",icons:[{name:"open_in_new",size:32.3}],onclick:function(){p.fixInferencePiece(),p.clearInferencePiece(),p.closeMenuModal(),p.openFumenModal()}},s.i18n.Menu.Buttons.Open()),i.h(t.SettingButton,{key:"btn-append-fumen",datatest:"btn-append-fumen",href:"#",icons:[{name:"library_add",size:29}],onclick:function(){p.closeMenuModal(),p.openAppendModal()}},s.i18n.Menu.Buttons.Append()),i.h(t.SettingButton,{key:"btn-first-page",datatest:"btn-first-page",href:"#",icons:[{name:"fast_rewind",size:32.3}],onclick:function(){p.firstPage(),p.closeMenuModal()}},s.i18n.Menu.Buttons.FirstPage()),i.h(t.SettingButton,{key:"btn-last-page",datatest:"btn-last-page",href:"#",icons:[{name:"fast_forward",size:32.3}],onclick:function(){p.lastPage(),p.closeMenuModal()}},s.i18n.Menu.Buttons.LastPage()),i.h(t.SettingButton,{key:"btn-clear-past",datatest:"btn-clear-past",href:"#",icons:[{name:"arrow_back",size:18},{name:"clear",size:28}],textSize:12,enable:0<u,onclick:function(){p.clearPast(),p.closeMenuModal()}},s.i18n.Menu.Buttons.ClearPast()),i.h(t.SettingButton,{key:"btn-clear-to-end",datatest:"btn-clear-to-end",href:"#",icons:[{name:"clear",size:28},{name:"arrow_forward",size:18}],textSize:12,enable:u<d-1,onclick:function(){p.clearToEnd(),p.closeMenuModal()}},s.i18n.Menu.Buttons.ClearToEnd()),l!==a.CommentType.PageSlider?i.h(t.SettingButton,{key:"btn-page-slider",href:"#",datatest:"btn-page-slider",icons:[{name:"looks_one",size:30}],onclick:function(){p.changeCommentMode({type:a.CommentType.PageSlider}),p.closeMenuModal()}},s.i18n.Menu.Buttons.PageSlider()):void 0,c===a.Screens.Reader&&l===a.CommentType.PageSlider?i.h(t.SettingButton,{key:"btn-show-comment",href:"#",datatest:"btn-show-comment",icons:[{name:"text_fields",size:32}],onclick:function(){p.changeCommentMode({type:a.CommentType.Writable}),p.closeMenuModal()}},s.i18n.Menu.Buttons.ShowComment()):void 0,c===a.Screens.Editor&&l!==a.CommentType.Writable?i.h(t.SettingButton,{key:"btn-comment-writable",href:"#",datatest:"btn-comment-writable",icons:[{name:"text_fields",size:32}],onclick:function(){p.changeCommentMode({type:a.CommentType.Writable}),p.closeMenuModal()}},s.i18n.Menu.Buttons.WritableComment()):void 0,c===a.Screens.Editor&&l!==a.CommentType.Readonly?i.h(t.SettingButton,{key:"btn-comment-readonly",href:"#",datatest:"btn-comment-readonly",icons:[{name:"lock_outline",size:30}],enable:c===a.Screens.Editor,onclick:c===a.Screens.Editor?function(){p.changeCommentMode({type:a.CommentType.Readonly}),p.closeMenuModal()}:function(){M.toast({html:s.i18n.Menu.Messages.NoAvailableCommentButton(),classes:"top-toast",displayLength:3e3})}},s.i18n.Menu.Buttons.ReadonlyComment()):void 0,i.h(t.SettingButton,{key:"btn-ghost-toggle",href:"#",datatest:"btn-ghost-toggle",icons:[{name:f?"visibility_off":"pageview",size:32}],onclick:function(){p.changeGhostVisible({visible:!f}),p.reopenCurrentPage(),p.closeMenuModal()}},f?s.i18n.Menu.Buttons.GhostOff():s.i18n.Menu.Buttons.GhostOn()),i.h(t.SettingButton,{key:"btn-help",datatest:"btn-help",href:"./help.html",icons:[{name:"help_outline",size:31.25}]},s.i18n.Menu.Buttons.Help()),i.h("div",{style:o.style({height:o.px(10),width:"100%"})})))))},t.SettingButton=function(e,t){var n=e.href,r=void 0===n?"#":n,a=e.key,s=e.onclick,c=e.icons,u=e.datatest,d=e.textSize,l=void 0===d?13:d,f=e.enable,p=void 0===f||f,g=c.map((function(e){return i.h("i",{key:a+"-icon-"+e.name,className:"material-icons "+(p?" ":"disabled"),style:o.style({fontSize:o.px(e.size)})},e.name)}));return i.h("a",{key:a,href:r,onclick:void 0!==s?function(e){s(e),e.stopPropagation(),e.preventDefault()}:void 0},i.h("div",{key:a+"-icon",datatest:u,className:"z-depth-1 "+(p?" ":"disabled"),style:o.style({width:o.px(50),height:o.px(40),lineHeight:o.px(40),display:"flex",alignItems:"center",justifyContent:"center",color:p?"#333":"#bdbdbd",margin:o.px(5),border:"solid 1px "+(p?"#999":"#bdbdbd"),boxSizing:"border-box",cursor:"pointer"})},g),i.h("div",{key:a+"-text",style:o.style({textAlign:"center",fontSize:o.px(l),color:p?"#333":"#bdbdbd"})},t))}},6691:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OpenFumenModal=void 0;var o=n(4055),i=n(6540),r=n(6314),a=n(4257);t.OpenFumenModal=function(e){var t=e.textAreaValue,n=e.errorMessage,s=e.actions,c=o.style({width:"100%",border:void 0!==n?"solid 1px #ff5252":void 0}),u=function(){var e=document.getElementById("input-fumen");if(null!==e)return""!==e.value?e.value:""},d="waves-effect waves-teal btn-flat"+(""!==t&&void 0===n?"":" disabled");return i.h("div",{key:"open-fumen-modal-top"},i.h("div",{key:"mdl-open-fumen",datatest:"mdl-open-fumen",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onOpenEnd:function(){var e=document.getElementById("input-fumen");null!==e&&e.focus()},onCloseStart:function(){s.closeFumenModal()}});t.open(),r.resources.modals.fumen=t},ondestroy:function(){var e=r.resources.modals.fumen;void 0!==e&&e.close(),r.resources.modals.fumen=void 0}},i.h("div",{key:"modal-content",className:"modal-content"},i.h("h4",{key:"open-fumen-label",dataTest:"open-fumen-label"},a.i18n.OpenFumen.Title()),i.h("textarea",{key:"input-fumen",dataTest:"input-fumen",id:"input-fumen",rows:3,style:c,oninput:function(e){if("insertLineBreak"!==e.inputType){var o=u(),i=null!=o?o:"";void 0===n&&""!==i&&""!==t||s.inputFumenData({value:i})}else{var r=document.getElementById("btn-open");null!==r&&r.click()}},onblur:function(){var e=u();t!==e&&s.inputFumenData({value:e})},value:t,placeholder:a.i18n.OpenFumen.PlaceHolder()}),i.h("span",{key:"text-message",datatest:"text-message",className:"red-text text-accent-2",style:o.style({display:void 0!==n?void 0:"none"})},n)),i.h("div",{key:"modal-footer",className:"modal-footer"},i.h("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:function(){s.closeFumenModal(),s.clearFumenData()}},a.i18n.OpenFumen.Buttons.Cancel()),i.h("a",{href:"#",key:"btn-open",datatest:"btn-open",id:"btn-open",className:d,onclick:function(){var e=u();s.inputFumenData({value:e}),void 0!==e&&s.loadFumen({fumen:e});var t=document.getElementById("input-fumen");null!==t&&t.focus()}},a.i18n.OpenFumen.Buttons.Open()))))}},37:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.page_slider=void 0;var o=n(4361),i=n(4055);t.page_slider=function(e){var t=e.datatest,n=e.size,r=e.maxPage,a=e.currentIndex,s=e.actions;return o.div({className:"range-field",style:i.style({width:i.px(n.width),height:i.px(n.height),margin:"0px auto"})},[o.input({oninput:function(){var e=document.getElementById("input-page-number");if(null!==e){var t=Number(e.value);s.openPageWhenChange({index:t-1})}},datatest:t,id:"input-page-number",type:"range",min:"1",max:""+r,value:""+(a+1)})])}},1809:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorTools=void 0;var o=n(4055),i=n(6540),r=n(3136),a=n(7478),s=n(9774);t.EditorTools=function(e){var t=e.currentPage,n=e.maxPage,c=e.height,u=(e.animationState,e.palette),d=e.modeType,l=e.undoCount,f=e.redoCount,p=e.inferenceCount,g=e.actions,m=o.style({width:"100%",height:o.px(c),margin:0,padding:0}),h=o.style({width:"100%",height:o.px(c),margin:0,padding:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),v={baseClass:u.baseClass,baseCode:u.baseCode,darkCode:u.darkCode},y="page-footer tools "+u.baseClass,x=t+" / "+n,P=t<n?"navigate_next":"add";return i.h("nav",{datatest:"tools",className:y,style:m},i.h("div",{className:"nav-wrapper",style:h},i.h(r.ToolButton,{iconName:"undo",datatest:"btn-undo",width:35,height:c-10,key:"btn-undo",fontSize:33.75,marginRight:5,colors:v,actions:{onclick:function(){return g.undo()}},enable:0<l||0<p}),i.h(r.ToolButton,{iconName:"redo",datatest:"btn-redo",width:35,height:c-10,key:"btn-redo",fontSize:33.75,marginRight:15,colors:v,actions:{onclick:function(){return g.redo()}},enable:0<f}),i.h(r.ToolButton,{iconName:"navigate_before",datatest:"btn-back-page",width:35,height:c-10,key:"btn-back-page",fontSize:33.75,marginRight:5,colors:v,actions:{onclick:function(){return g.backPage()}},enable:1<t}),i.h(a.ToolText,{datatest:"text-pages",height:c-10,minWidth:75,fontSize:18,marginRight:5},x),i.h(r.ToolButton,{iconName:P,datatest:"btn-next-page",width:35,height:c-10,key:"btn-next-page",fontSize:33.75,marginRight:10,colors:v,actions:{onclick:function(){return g.nextPageOrNewPage()}}}),i.h(r.ToolButton,{iconName:"home",datatest:"btn-drawing-tool",width:40,height:c-10,key:"btn-drawing-tool",fontSize:30,marginRight:40,colors:v,actions:{onclick:function(){return g.changeToDrawingToolMode()}},enable:d!==s.ModeTypes.DrawingTool}),i.h(r.ToolButton,{iconName:"menu",datatest:"btn-open-menu",sticky:!0,key:"btn-open-menu",width:40,height:c-10,fontSize:32,colors:v,actions:{onclick:function(){return g.openMenuModal()}}})))}},6136:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReaderTools=void 0;var o=n(4055),i=n(6540),r=n(3136),a=n(7478),s=n(9774);t.ReaderTools=function(e){var t=e.currentPage,n=e.maxPage,c=e.height,u=e.animationState,d=e.pages,l=e.palette,f=e.actions,p=o.style({width:"100%",height:o.px(c),margin:0,padding:0}),g=o.style({width:"100%",height:o.px(c),margin:0,padding:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),m="page-footer tools "+l.baseClass;return i.h("nav",{datatest:"tools",className:m,style:p},i.h("div",{className:"nav-wrapper",style:g},i.h(r.ToolButton,{iconName:"pause"!==u?"pause":"play_arrow",datatest:"btn-play-anime",key:"btn-play-anime",width:40,height:c-10,fontSize:40,colors:l,marginRight:15,actions:{onclick:function(){switch(u){case s.AnimationState.Play:f.pauseAnimation();break;default:f.startAnimation()}}}}),i.h(r.ToolButton,{iconName:"navigate_before",datatest:"btn-back-page",width:35,height:c-10,key:"btn-back-page",fontSize:33.75,marginRight:5,colors:l,actions:{onclick:function(){return f.backPage()}},enable:1<t}),i.h(a.ToolText,{datatest:"text-pages",height:c-10,minWidth:75,fontSize:18,marginRight:5},d),i.h(r.ToolButton,{iconName:"navigate_next",datatest:"btn-next-page",width:35,height:c-10,key:"btn-next-page",fontSize:33.75,marginRight:10,colors:l,enable:t<n,actions:{onclick:function(){return f.nextPage()}}}),i.h(r.ToolButton,{iconName:"mode_edit",datatest:"btn-writable-in-reader",width:40,height:c-10,key:"btn-writable-in-reader",fontSize:33.75,marginRight:10,colors:l,actions:{onclick:function(){f.changeToDrawerScreen({refresh:!0})}}}),i.h(r.ToolButton,{iconName:"menu",datatest:"btn-open-menu",sticky:!0,key:"btn-open-menu",width:40,height:c-10,fontSize:32,colors:l,actions:{onclick:function(){return f.openMenuModal()}}})))}},3136:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolButton=void 0;var o=n(6540),i=n(4055);t.ToolButton=function(e){var t=e.height,n=e.width,a=e.fontSize,s=e.key,c=e.iconName,u=e.sticky,d=void 0!==u&&u,l=e.marginLeft,f=void 0===l?void 0:l,p=e.marginRight,g=void 0===p?0:p,m=e.datatest,h=e.colors,v=e.enable,y=void 0===v||v,x=e.actions,P=i.style({height:i.px(t),lineHeight:i.px(t),width:i.px(n),marginLeft:d?"auto":f,position:d?"absolute":void 0,right:d?"10px":void 0,marginRight:i.px(g)}),b=x.onclick;return o.h("a",{href:"#",key:s,datatest:m,style:P,onclick:void 0!==b?function(e){b(e),e.stopPropagation(),e.preventDefault()}:void 0},o.h(r,{height:t,fontSize:a,colors:h,enable:y},c))};var r=function(e,t){var n=e.height,r=e.fontSize,a=e.colors,s=e.enable,c=s?a.darkCode:a.baseCode,u=i.style({display:"block",fontSize:i.px(r),height:i.px(n),lineHeight:i.px(n),width:"100%",border:"solid 1px "+c,boxSizing:"border-box",textAlign:"center",cursor:"pointer",color:"#fff"}),d="material-icons darken-"+(s?3:1)+" "+a.baseClass;return o.h("i",{className:d,style:u},s?t:"")}},7478:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolText=void 0;var o=n(6540),i=n(4055);t.ToolText=function(e,t){var n=e.datatest,r=e.height,a=e.fontSize,s=e.minWidth,c=e.marginRight,u=void 0===c?0:c,d=i.style({lineHeight:i.px(r),fontSize:i.px(a),minWidth:i.px(s),textAlign:"center",whiteSpace:"nowrap",marginRight:i.px(u)});return o.h("span",{datatest:n,style:d},t)}},2995:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toPage=t.toPrimitivePage=t.toDecoratorOperationTask=t.toPageTaskStack=t.toUnsetQuizFlagTask=t.toSetQuizFlagTask=t.toUnfreezeCommentTask=t.toFreezeCommentTask=t.toRefPageTask=t.toKeyPageTask=t.toInsertPageTask=t.toRemovePageTask=t.toSinglePageTask=t.toFumenTask=t.isOperationTask=void 0;var o=n(655),i=n(1983),r=n(5187),a=n(2315),s=n(9782);t.isOperationTask=function(e){return!e.fixed},t.toFumenTask=function(e,n,i){return{replay:function(){return o.__awaiter(void 0,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return e={},[4,a.decode(n)];case 1:return[2,(e.pages=t.sent(),e.index=0,e)]}}))}))},revert:function(){return o.__awaiter(void 0,void 0,void 0,(function(){return o.__generator(this,(function(n){return[2,{pages:e.map(t.toPage),index:i}]}))}))},fixed:!0,key:r.generateKey()}},t.toSinglePageTask=function(e,n,o){var i=t.toPrimitivePage(o);return{replay:function(n){return n[e]=t.toPage(i),{pages:n,index:e}},revert:function(o){return o[e]=t.toPage(n),{pages:o,index:e}},fixed:!1,key:r.generateKey()}},t.toRemovePageTask=function(e,n,o,a){return{replay:function(t){var o=new i.Pages(t);o.deletePage(e,n);var r=o.pages;return{pages:r,index:e<r.length?e:r.length-1}},revert:function(n){var r=new i.Pages(n);return r.insertPage(e,o.map(t.toPage)),{pages:r.pages,index:a}},fixed:!1,key:r.generateKey()}},t.toInsertPageTask=function(e,n,o){return{replay:function(o){var r=new i.Pages(o);return r.insertPage(e,n.map(t.toPage)),{pages:r.pages,index:e}},revert:function(t){var r=new i.Pages(t);return r.deletePage(e,e+n.length),{pages:r.pages,index:o}},fixed:!1,key:r.generateKey()}},t.toKeyPageTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.toKeyPage(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.toRefPage(e),{index:e,pages:n.pages}},fixed:!1,key:r.generateKey()}},t.toRefPageTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.toRefPage(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.toKeyPage(e),{index:e,pages:n.pages}},fixed:!1,key:r.generateKey()}},t.toFreezeCommentTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.freezeComment(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.unfreezeComment(e),{index:e,pages:n.pages}},fixed:!1,key:r.generateKey()}},t.toUnfreezeCommentTask=function(e,t){return{replay:function(t){var n=new i.Pages(t);return n.unfreezeComment(e),{index:e,pages:n.pages}},revert:function(n){var o=new i.Pages(n);o.freezeComment(e);var r=o.pages;return r[e].comment={text:t},{index:e,pages:r}},fixed:!1,key:r.generateKey()}},t.toSetQuizFlagTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.setQuizFlag(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.unsetQuizFlag(e),{index:e,pages:n.pages}},fixed:!1,key:r.generateKey()}},t.toUnsetQuizFlagTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.unsetQuizFlag(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.setQuizFlag(e),{index:e,pages:n.pages}},fixed:!1,key:r.generateKey()}},t.toPageTaskStack=function(e,t){return{replay:function(t){for(var n={pages:t,index:0},o=0,i=e;o<i.length;o++)n=i[o].replay(n.pages);return n},revert:function(n){for(var o={pages:n,index:0},i=0,r=e.concat().reverse();i<r.length;i++)o=r[i].revert(o.pages);return{pages:o.pages,index:void 0!==t?t:o.index}},fixed:!1,key:r.generateKey()}},t.toDecoratorOperationTask=function(e,t){return{replay:function(n){var o=e.replay(n);return t.replay(o.pages)},revert:function(n){var o=t.revert(n);return e.revert(o.pages)},fixed:!1,key:e.key}},t.toPrimitivePage=function(e){var t=e.field.obj,n=e.commands;return{index:e.index,field:{obj:void 0!==t?{play:t.toPlayFieldPieces(),sentLine:t.toSentLintPieces()}:void 0,ref:e.field.ref},piece:void 0!==e.piece?{type:e.piece.type,coordinate:o.__assign({},e.piece.coordinate),rotation:e.piece.rotation}:void 0,comment:{text:e.comment.text,ref:e.comment.ref},commands:void 0!==n?{pre:o.__assign({},n.pre)}:void 0,flags:{lock:e.flags.lock,mirror:e.flags.mirror,colorize:e.flags.colorize,rise:e.flags.rise,quiz:e.flags.quiz}}},t.toPage=function(e){var t=e.field.obj,n=e.commands;return{index:e.index,field:{obj:void 0!==t?new s.Field({field:new s.PlayField({pieces:t.play}),sentLine:new s.PlayField({pieces:t.sentLine})}):void 0,ref:e.field.ref},piece:e.piece,comment:{text:e.comment.text,ref:e.comment.ref},commands:void 0!==n?{pre:o.__assign({},n.pre)}:void 0,flags:{lock:e.flags.lock,mirror:e.flags.mirror,colorize:e.flags.colorize,rise:e.flags.rise,quiz:e.flags.quiz}}}},3891:(e,t,n)=>{var o,i,r,a,s,c,u,d,l,f,p,g;Object.defineProperty(t,"__esModule",{value:!0}),t.decideBackgroundColor=t.decidePieceColor=t.Palette=void 0;var m=n(9774),h=n(2742);t.Palette=function(e){return{baseClass:function(){switch(e){case m.Screens.Editor:return"red";default:return"teal"}}(),baseCode:function(){switch(e){case m.Screens.Editor:return"#f44336";default:return"#009688"}}(),darkCode:function(){switch(e){case m.Screens.Editor:return"#d32f2f";default:return"#00796b"}}()}},t.decidePieceColor=function(e,t,n){return(n?v:y)[e][void 0!==t?t:h.HighlightType.Normal]};var v=((o={}).inference=((i={})[h.HighlightType.Normal]="#ffffff",i[h.HighlightType.Highlight1]="#ffffff",i[h.HighlightType.Highlight2]="#ffffff",i[h.HighlightType.Lighter]="#ffffff",i),o[m.Piece.Gray]=((r={})[h.HighlightType.Normal]="#999999",r[h.HighlightType.Highlight1]="#cccccc",r[h.HighlightType.Highlight2]="#ffffff",r[h.HighlightType.Lighter]="#333333",r),o[m.Piece.I]=((a={})[h.HighlightType.Normal]="#009999",a[h.HighlightType.Highlight1]="#33cccc",a[h.HighlightType.Highlight2]="#00ffff",a[h.HighlightType.Lighter]="#003333",a),o[m.Piece.T]=((s={})[h.HighlightType.Normal]="#990099",s[h.HighlightType.Highlight1]="#cc33cc",s[h.HighlightType.Highlight2]="#ff00ff",s[h.HighlightType.Lighter]="#4d004d",s),o[m.Piece.S]=((c={})[h.HighlightType.Normal]="#009900",c[h.HighlightType.Highlight1]="#33cc33",c[h.HighlightType.Highlight2]="#00ff00",c[h.HighlightType.Lighter]="#003300",c),o[m.Piece.Z]=((u={})[h.HighlightType.Normal]="#990000",u[h.HighlightType.Highlight1]="#cc3333",u[h.HighlightType.Highlight2]="#ff0000",u[h.HighlightType.Lighter]="#4d0000",u),o[m.Piece.L]=((d={})[h.HighlightType.Normal]="#996600",d[h.HighlightType.Highlight1]="#cc9933",d[h.HighlightType.Highlight2]="#ff9900",d[h.HighlightType.Lighter]="#3b1d00",d),o[m.Piece.J]=((l={})[h.HighlightType.Normal]="#0000BB",l[h.HighlightType.Highlight1]="#3333cc",l[h.HighlightType.Highlight2]="#0000ff",l[h.HighlightType.Lighter]="#000061",l),o[m.Piece.O]=((f={})[h.HighlightType.Normal]="#999900",f[h.HighlightType.Highlight1]="#cccc33",f[h.HighlightType.Highlight2]="#ffff00",f[h.HighlightType.Lighter]="#333300",f),o[m.Piece.Empty]=((p={})[h.HighlightType.Normal]="#000000",p[h.HighlightType.Highlight1]="#000000",p[h.HighlightType.Highlight2]="#000000",p[h.HighlightType.Lighter]="#000000",p),o),y=((g={}).inference=v.inference,g[m.Piece.Gray]=v[m.Piece.Gray],g[m.Piece.I]=v[m.Piece.Z],g[m.Piece.T]=v[m.Piece.I],g[m.Piece.S]=v[m.Piece.T],g[m.Piece.Z]=v[m.Piece.S],g[m.Piece.L]=v[m.Piece.L],g[m.Piece.J]=v[m.Piece.J],g[m.Piece.O]=v[m.Piece.O],g[m.Piece.Empty]=v[m.Piece.Empty],g);t.decideBackgroundColor=function(e){return e<20?"#000000":"#333333"}},9774:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isInPlayField=t.parseRotationName=t.nextRotationToRight=t.nextRotationToLeft=t.toPositionIndex=t.isMinoPiece=t.parsePiece=t.parsePieceName=t.CommentType=t.TouchTypes=t.ModeTypes=t.Screens=t.FieldConstants=t.Action=t.Operation=t.AnimationState=t.Rotation=t.Piece=void 0;var o,i,r,a,s,c,u,d,l,f=n(8286);!function(e){e[e.Empty=0]="Empty",e[e.I=1]="I",e[e.L=2]="L",e[e.O=3]="O",e[e.Z=4]="Z",e[e.T=5]="T",e[e.J=6]="J",e[e.S=7]="S",e[e.Gray=8]="Gray"}(o=t.Piece||(t.Piece={})),function(e){e[e.Spawn=0]="Spawn",e[e.Right=1]="Right",e[e.Reverse=2]="Reverse",e[e.Left=3]="Left"}(i=t.Rotation||(t.Rotation={})),(l=t.AnimationState||(t.AnimationState={})).Pause="pause",l.Play="play",(d=t.Operation||(t.Operation={})).Direct="direct",d.Swap="swap",d.Stock="stock",(t.Action||(t.Action={})).Block="block",function(e){e[e.Width=10]="Width",e[e.Height=23]="Height",e[e.SentLine=1]="SentLine",e[e.PlayBlocks=230]="PlayBlocks",e[e.AllBlocks=240]="AllBlocks"}(r=t.FieldConstants||(t.FieldConstants={})),(u=t.Screens||(t.Screens={})).Reader="Reader",u.Editor="Editor",(c=t.ModeTypes||(t.ModeTypes={})).Drawing="Drawing",c.Piece="Piece",c.Fill="Fill",c.DrawingTool="DrawingTool",c.Flags="Flags",c.Utils="Utils",c.Slide="Slide",c.FillRow="FillRow",c.SelectPiece="SelectPiece",(s=t.TouchTypes||(t.TouchTypes={})).None="None",s.Drawing="Drawing",s.Piece="Piece",s.Fill="Fill",s.MovePiece="MovePiece",s.FillRow="FillRow",(a=t.CommentType||(t.CommentType={})).Writable="Writable",a.Readonly="Readonly",a.PageSlider="PageSlider",t.parsePieceName=function(e){switch(e){case o.I:return"I";case o.L:return"L";case o.O:return"O";case o.Z:return"Z";case o.T:return"T";case o.J:return"J";case o.S:return"S";case o.Gray:return"Gray";case o.Empty:return"Empty"}},t.parsePiece=function(e){switch(e.toUpperCase()){case"I":return o.I;case"L":return o.L;case"O":return o.O;case"Z":return o.Z;case"T":return o.T;case"J":return o.J;case"S":return o.S;case"X":return o.Gray;case" ":case"_":return o.Empty}throw new f.FumenError("Unexpected piece: "+e)},t.isMinoPiece=function(e){return e!==o.Empty&&e!==o.Gray},t.toPositionIndex=function(e){return e[0]+10*e[1]},t.nextRotationToLeft=function(e){switch(e){case i.Spawn:return i.Left;case i.Left:return i.Reverse;case i.Reverse:return i.Right;case i.Right:return i.Spawn}},t.nextRotationToRight=function(e){switch(e){case i.Spawn:return i.Right;case i.Right:return i.Reverse;case i.Reverse:return i.Left;case i.Left:return i.Spawn}},t.parseRotationName=function(e){switch(e){case i.Spawn:return"Spawn";case i.Left:return"Left";case i.Right:return"Right";case i.Reverse:return"Reverse"}},t.isInPlayField=function(e,t){return 0<=e&&e<r.Width&&0<=t&&t<r.Height}},8286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ViewError=t.FumenError=void 0;var o=n(655),i=function(){function e(e){this.message=e,this.name=this.constructor.name,Object.setPrototypeOf(this,this.constructor.prototype)}return e.prototype.toString=function(){return this.name+": "+this.message},e}(),r=function(e){function t(t){return e.call(this,t)||this}return o.__extends(t,e),t}(i);t.FumenError=r;var a=function(e){function t(t){return e.call(this,t)||this}return o.__extends(t,e),t}(i);t.ViewError=a},2534:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encodeAction=t.decodeAction=void 0;var o=n(8286),i=n(9774);function r(e){return 0!==e}function a(e){return e?1:0}t.decodeAction=function(e,t){var n=(t+i.FieldConstants.SentLine)*i.FieldConstants.Width,a=e,s=function(e){switch(e){case 0:return i.Piece.Empty;case 1:return i.Piece.I;case 2:return i.Piece.L;case 3:return i.Piece.O;case 4:return i.Piece.Z;case 5:return i.Piece.T;case 6:return i.Piece.J;case 7:return i.Piece.S;case 8:return i.Piece.Gray}throw new o.FumenError("Unexpected piece")}(a%8),c=function(e){switch(e){case 0:return i.Rotation.Reverse;case 1:return i.Rotation.Right;case 2:return i.Rotation.Spawn;case 3:return i.Rotation.Left}throw new o.FumenError("Unexpected rotation")}((a=Math.floor(a/8))%4),u=function(e,t,n,o){var r=e%i.FieldConstants.Width,a=o-Math.floor(e/10)-1;return t===i.Piece.O&&n===i.Rotation.Left?(r+=1,a-=1):t===i.Piece.O&&n===i.Rotation.Reverse?r+=1:t===i.Piece.O&&n===i.Rotation.Spawn?a-=1:t===i.Piece.I&&n===i.Rotation.Reverse?r+=1:t===i.Piece.I&&n===i.Rotation.Left||t===i.Piece.S&&n===i.Rotation.Spawn?a-=1:t===i.Piece.S&&n===i.Rotation.Right?r-=1:t===i.Piece.Z&&n===i.Rotation.Spawn?a-=1:t===i.Piece.Z&&n===i.Rotation.Left&&(r+=1),{x:r,y:a}}((a=Math.floor(a/4))%n,s,c,t);return{rise:r((a=Math.floor(a/n))%2),mirror:r((a=Math.floor(a/2))%2),colorize:r((a=Math.floor(a/2))%2),comment:r((a=Math.floor(a/2))%2),lock:!r((a=Math.floor(a/2))%2),piece:{type:s,rotation:c,coordinate:u}}},t.encodeAction=function(e){var t,n,o,r,s,c,u=e.lock,d=e.comment,l=e.colorize,f=e.mirror,p=e.rise,g=e.piece,m=a(!u);return m*=2,m+=a(d),m*=2,m+=a(l),m*=2,m+=a(f),m*=2,m+=a(p),m*=i.FieldConstants.AllBlocks,m+=(n=(t=g).coordinate,o=t.type,r=t.rotation,s=n.x,c=n.y,i.isMinoPiece(o)?o===i.Piece.O&&r===i.Rotation.Left?(s-=1,c+=1):o===i.Piece.O&&r===i.Rotation.Reverse?s-=1:o===i.Piece.O&&r===i.Rotation.Spawn?c+=1:o===i.Piece.I&&r===i.Rotation.Reverse?s-=1:o===i.Piece.I&&r===i.Rotation.Left||o===i.Piece.S&&r===i.Rotation.Spawn?c+=1:o===i.Piece.S&&r===i.Rotation.Right?s+=1:o===i.Piece.Z&&r===i.Rotation.Spawn?c+=1:o===i.Piece.Z&&r===i.Rotation.Left&&(s-=1):(s=0,c=22),(i.FieldConstants.Height-c-1)*i.FieldConstants.Width+s),m*=4,m+=function(e){var t=e.type,n=e.rotation;if(!i.isMinoPiece(t))return 0;switch(n){case i.Rotation.Reverse:return 0;case i.Rotation.Right:return 1;case i.Rotation.Spawn:return 2;case i.Rotation.Left:return 3}}(g),(m*=8)+g.type}},9782:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayField=t.Field=void 0;var o=n(9774),i=n(8286),r=n(8711),a=function(){function e(t){var n=t.field,i=void 0===n?e.create(o.FieldConstants.PlayBlocks):n,r=t.sentLine,a=void 0===r?e.create(o.FieldConstants.Width):r;this.playField=i,this.sentLine=a}return e.create=function(e){return new s({length:e})},e.prototype.add=function(e,t,n){0<=t?this.playField.add(e,t,n):this.sentLine.add(e,-(t+1),n)},e.prototype.put=function(e){this.playField.put(e)},e.prototype.setToPlayField=function(e,t){this.playField.setAt(e,t)},e.prototype.setToSentLine=function(e,t){this.sentLine.setAt(e,t)},e.prototype.clearLine=function(){this.playField.clearLine()},e.prototype.up=function(){this.playField.up(this.sentLine),this.sentLine.clearAll()},e.prototype.mirror=function(){this.playField.mirror()},e.prototype.shiftToLeft=function(){this.playField.shiftToLeft()},e.prototype.shiftToRight=function(){this.playField.shiftToRight()},e.prototype.shiftToUp=function(){this.playField.shiftToUp()},e.prototype.shiftToBottom=function(){this.playField.shiftToBottom()},e.prototype.get=function(e,t){return 0<=t?this.playField.get(e,t):this.sentLine.get(e,-(t+1))},e.prototype.getAtIndex=function(e,t){return t?this.get(e%10,Math.floor(e/10)):this.get(e%10,-(Math.floor(e/10)+1))},e.prototype.copy=function(){return new e({field:this.playField.copy(),sentLine:this.sentLine.copy()})},e.prototype.toPlayFieldPieces=function(){return this.playField.toArray()},e.prototype.toSentLintPieces=function(){return this.sentLine.toArray()},e.prototype.equals=function(e){return this.playField.equals(e.playField)&&this.sentLine.equals(e.sentLine)},e.prototype.canPut=function(e,t,n,i){var a=this;return r.getBlockPositions(e,t,n,i).every((function(e){var t=e[0],n=e[1];return 0<=t&&t<10&&0<=n&&a.get(t,n)===o.Piece.Empty}))},e.prototype.isOnGround=function(e,t,n,o){return!this.canPut(e,t,n,o-1)},e.prototype.convertToGray=function(){this.playField.convertToGray(),this.sentLine.convertToGray()},e}();t.Field=a;var s=function(){function e(e){var t=e.pieces,n=e.length,i=void 0===n?o.FieldConstants.PlayBlocks:n;this.pieces=void 0!==t?t:Array.from({length:i}).map((function(){return o.Piece.Empty})),this.length=i}return e.load=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.join("").trim();return e.loadInner(o)},e.loadMinify=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.join("").trim();return e.loadInner(o,o.length)},e.loadInner=function(t,n){var r=void 0!==n?n:t.length;if(r%10!=0)throw new i.FumenError("Num of block in field should be mod 10");for(var a=new e(void 0!==n?{length:n}:{}),s=0;s<r;s+=1){var c=t[s];a.set(s%10,Math.floor((r-s-1)/10),o.parsePiece(c))}return a},e.prototype.get=function(e,t){return this.pieces[e+t*o.FieldConstants.Width]},e.prototype.add=function(e,t,n){this.pieces[e+t*o.FieldConstants.Width]+=n},e.prototype.set=function(e,t,n){this.setAt(e+t*o.FieldConstants.Width,n)},e.prototype.setAt=function(e,t){this.pieces[e]=t},e.prototype.put=function(e){for(var t=e.type,n=e.rotation,o=e.coordinate,i=0,a=r.getBlocks(t,n);i<a.length;i++){var s=a[i],c=[o.x+s[0],o.y+s[1]],u=c[0],d=c[1];this.set(u,d,t)}},e.prototype.clearLine=function(){for(var e=this.pieces.concat(),t=this.pieces.length/o.FieldConstants.Width-1;0<=t;t-=1)if(this.pieces.slice(t*o.FieldConstants.Width,(t+1)*o.FieldConstants.Width).every((function(e){return e!==o.Piece.Empty}))){var n=e.slice(0,t*o.FieldConstants.Width),i=e.slice((t+1)*o.FieldConstants.Width);e=n.concat(i,Array.from({length:o.FieldConstants.Width}).map((function(){return o.Piece.Empty})))}this.pieces=e},e.prototype.up=function(e){this.pieces=e.pieces.concat(this.pieces).slice(0,this.length)},e.prototype.mirror=function(){for(var e=[],t=0;t<this.pieces.length;t+=1){var n=this.pieces.slice(t*o.FieldConstants.Width,(t+1)*o.FieldConstants.Width);n.reverse();for(var i=0,r=n;i<r.length;i++){var a=r[i];e.push(a)}}this.pieces=e},e.prototype.shiftToLeft=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=0;n<o.FieldConstants.Width-1;n+=1)this.pieces[n+t*o.FieldConstants.Width]=this.pieces[n+1+t*o.FieldConstants.Width];this.pieces[9+t*o.FieldConstants.Width]=o.Piece.Empty}},e.prototype.shiftToRight=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=o.FieldConstants.Width-1;1<=n;n-=1)this.pieces[n+t*o.FieldConstants.Width]=this.pieces[n-1+t*o.FieldConstants.Width];this.pieces[t*o.FieldConstants.Width]=o.Piece.Empty}},e.prototype.shiftToUp=function(){var e=Array.from({length:10}).map((function(){return o.Piece.Empty}));this.pieces=e.concat(this.pieces).slice(0,this.length)},e.prototype.shiftToBottom=function(){var e=Array.from({length:10}).map((function(){return o.Piece.Empty}));this.pieces=this.pieces.slice(10,this.length).concat(e)},e.prototype.toArray=function(){return this.pieces.concat()},Object.defineProperty(e.prototype,"numOfBlocks",{get:function(){return this.pieces.length},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e({pieces:this.pieces.concat(),length:this.length})},e.prototype.toShallowArray=function(){return this.pieces},e.prototype.clearAll=function(){this.pieces=this.pieces.map((function(){return o.Piece.Empty}))},e.prototype.equals=function(e){if(this.pieces.length!==e.pieces.length)return!1;for(var t=0;t<this.pieces.length;t+=1)if(this.pieces[t]!==e.pieces[t])return!1;return!0},e.prototype.convertToGray=function(){this.pieces=this.pieces.map((function(e){return e!==o.Piece.Empty?o.Piece.Gray:o.Piece.Empty}))},e}();t.PlayField=s},2315:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.innerDecode=t.decode=t.extract=void 0;var o=n(655),i=n(9774),r=n(4826),a=n(9782),s=n(2534),c=n(2375),u=n(8286),d=n(1983),l=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",f=l.length+1;function p(e){for(var t=[],n=e,o=0;o<4;o+=1){var i=n%f;t.push(l[i]),n=Math.floor(n/f)}return t}var g=i.FieldConstants.Width;function m(e){var t,n=function(e,t){return{version:e,data:t.trim().replace(/[?\s]+/g,"")}},o=e,i=o.indexOf("&");if(0<=i&&(o=o.substring(0,i)),null!=(t=e.match(/[vmd]115@/))&&void 0!==t.index)return n("115",o.substr(t.index+5));if(null!=(t=e.match(/[vmd]110@/))&&void 0!==t.index)return n("110",o.substr(t.index+5));throw new u.FumenError("Fumen is not supported")}function h(e,t,n){return void 0===n&&(n=function(){}),o.__awaiter(this,void 0,void 0,(function(){var u,d,l,f,m,h,v,y,x,P,b,w,k,_,T,C,S,z,M,F,R,I,E,B,L,O,A,q,N;return o.__generator(this,(function(o){for(u=t+i.FieldConstants.SentLine,d=u*g,l=function(e){for(var n={changed:!1,field:e},o=0;o<d;){var i=m.poll(2),r=Math.floor(i/d),a=i%d;a!==d-1&&(n.changed=!0);for(var s=0;s<a+1;s+=1){var c=o%g,u=t-Math.floor(o/g)-1;n.field.add(c,u,r-8),o+=1}}return n},f=0,m=new c.Values(e),h=new a.Field({}),v={repeatCount:-1,refIndex:{comment:0,field:0},quiz:void 0,lastCommentText:""},y=[];!m.isEmpty();){if(x=void 0,0<v.repeatCount?(x={field:h,changed:!1},v.repeatCount-=1):(x=l(h.copy())).changed||(v.repeatCount=m.poll(1)),P=m.poll(3),b=s.decodeAction(P,t),w=void 0,b.comment){for(k=[],_=m.poll(2),T=0;T<Math.floor((_+3)/4);T+=1)C=m.poll(5),k.push(C);for(S=[],z=0,M=k;z<M.length;z++)F=M[z],R=p(F),S.push.apply(S,R);if(I=unescape(S.slice(0,_).join("")),v.lastCommentText=I,w={text:I},v.refIndex.comment=f,E=w.text,r.Quiz.isQuizComment(E))try{v.quiz=new r.Quiz(E)}catch(e){v.quiz=void 0}else v.quiz=void 0}else w=0===f?{text:""}:{ref:v.refIndex.comment};if(B=!1,void 0!==v.quiz&&(B=!0,v.quiz.canOperate()&&b.lock))if(i.isMinoPiece(b.piece.type))try{L=v.quiz.nextIfEnd(),O=L.getOperation(b.piece.type),v.quiz=L.operate(O)}catch(e){console.error(e.message),v.quiz=v.quiz.format()}else v.quiz=v.quiz.format();A=void 0,b.piece.type!==i.Piece.Empty&&(A=b.piece),q=void 0,x.changed||0===f?(q={obj:x.field.copy()},v.refIndex.field=f):q={ref:v.refIndex.field},N={field:q,comment:w,index:f,piece:A,flags:{quiz:B,lock:b.lock,mirror:b.mirror,colorize:b.colorize,rise:b.rise}},y.push(N),n(x.field.copy(),A,void 0!==v.quiz?v.quiz.format().toString():v.lastCommentText),f+=1,b.lock&&(i.isMinoPiece(b.piece.type)&&x.field.put(b.piece),x.field.clearLine(),b.rise&&x.field.up(),b.mirror&&x.field.mirror()),h=x.field}return[2,y]}))}))}t.extract=m,t.decode=function(e,t){return void 0===t&&(t=function(){}),o.__awaiter(this,void 0,void 0,(function(){var n,i,r;return o.__generator(this,(function(o){switch(n=m(e),i=n.version,r=n.data,i){case"115":return[2,h(r,23,t)];case"110":return[2,h(r,21,t)]}return[2]}))}))},t.innerDecode=h,t.encode=function(e,t){return void 0===t&&(t=!1),o.__awaiter(this,void 0,void 0,(function(){var n,r,u,p,m,h,v,y,x,P,b,w,k=this;return o.__generator(this,(function(_){switch(_.label){case 0:n=function(e,t){var n=function(e,t){for(var n=24*g,o=new c.Values,i=function(n,o){var i=23-o-1;return t.get(n,i)-e.get(n,i)+8},r=function(e,t){var i=e*n+t;o.push(i,2)},a=!1,s=i(0,0),u=-1,d=0;d<24;d+=1)for(var l=0;l<g;l+=1){var f=i(l,d);f!==s?(r(s,u),u=0,s=f,a=!0):u+=1}return r(s,u),{values:o,changed:a}}(e,t),o=n.changed,i=n.values;if(o)u.merge(i),r=-1;else if(r<0||u.get(r)===c.ENCODE_TABLE_LENGTH-1)u.merge(i),u.push(0),r=u.length-1;else if(u.get(r)<c.ENCODE_TABLE_LENGTH-1){var a=u.get(r);u.set(r,a+1)}},r=-1,u=new c.Values,p=new a.Field({}),m=new d.Pages(e),h=function(t){var o=m.getField(t),r=e[t],a=void 0!==o?o.copy():p.copy(),c=r.commands;void 0!==c&&Object.keys(c.pre).map((function(e){return c.pre[e]})).forEach((function(e){switch(e.type){case"block":var t=e.x,n=e.y,o=e.piece;return void a.setToPlayField(t+10*n,o);case"sentBlock":t=e.x,n=e.y;var i=e.piece;return void a.setToSentLine(t+10*n,i)}})),n(p,a);var d,g=void 0!==r.comment.text&&(0!==t||""!==r.comment.text),h={piece:void 0!==r.piece?r.piece:{type:i.Piece.Empty,rotation:i.Rotation.Reverse,coordinate:{x:0,y:22}},rise:r.flags.rise,mirror:r.flags.mirror,colorize:r.flags.colorize,lock:r.flags.lock,comment:g},v=s.encodeAction(h);if(u.push(v,3),void 0!==r.comment.text&&g){var y=escape(r.comment.text),x=Math.min(y.length,4095);u.push(x,2);for(var P=0;P<x;P+=4){for(var b=0,w=0;w<4;w+=1){var k=P+w;if(x<=k)break;b+=(d=y.charAt(k),l.indexOf(d)*Math.pow(f,w))}u.push(b,5)}}h.lock&&(i.isMinoPiece(h.piece.type)&&a.put(h.piece),a.clearLine(),h.rise&&a.up(),h.mirror&&a.mirror()),p=a},v=function(e){return o.__awaiter(k,void 0,void 0,(function(){return o.__generator(this,(function(t){return h(e),[2]}))}))},y=0,_.label=1;case 1:return y<e.length?t?[4,v(y)]:[3,3]:[3,5];case 2:return _.sent(),[3,4];case 3:h(y),_.label=4;case 4:return y+=1,[3,1];case 5:return(x=u.toString()).length<41?[2,x]:(P=[x.substr(0,42)],b=x.substring(42),w=b.match(/[\S]{1,47}/g)||[],[2,P.concat(w).join("?")])}}))}))}},4826:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Quiz=void 0;var o=n(8286),i=n(9774),r=function(){function e(t){this.quiz=e.verify(t)}return Object.defineProperty(e.prototype,"next",{get:function(){var e=this.quiz.indexOf(")")+1,t=this.quiz[e];return void 0===t||";"===t?"":t},enumerable:!1,configurable:!0}),e.isQuizComment=function(e){return e.startsWith("#Q=")},e.create=function(t,n){var o=function(t,n){var o=function(e){return e||""};return new e("#Q=["+o(t)+"]("+o(n[0])+")"+o(n.substring(1)))};return void 0!==n?o(t,n):o(void 0,t)},e.trim=function(e){return e.trim().replace(/\s+/g,"")},Object.defineProperty(e.prototype,"least",{get:function(){var e=this.quiz.indexOf(")");return this.quiz.substr(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){var e=this.quiz.indexOf("(")+1,t=this.quiz[e];return")"===t?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hold",{get:function(){var e=this.quiz.indexOf("[")+1,t=this.quiz[e];return"]"===t?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leastAfterNext2",{get:function(){var e=this.quiz.indexOf(")");return";"===this.quiz[e+1]?this.quiz.substr(e+1):this.quiz.substr(e+2)},enumerable:!1,configurable:!0}),e.prototype.getOperation=function(e){var t=i.parsePieceName(e),n=this.current;if(t===n)return i.Operation.Direct;var r=this.hold;if(t===r)return i.Operation.Swap;if(""===r){if(t===this.next)return i.Operation.Stock}else if(""===n&&t===this.next)return i.Operation.Direct;throw new o.FumenError("Unexpected hold piece in quiz: "+this.quiz)},Object.defineProperty(e.prototype,"leastInActiveBag",{get:function(){var e=this.quiz.indexOf(";"),t=0<=e?this.quiz.substring(0,e):this.quiz,n=t.indexOf(")");return";"===t[n+1]?t.substr(n+1):t.substr(n+2)},enumerable:!1,configurable:!0}),e.verify=function(e){var t=this.trim(e);if(0===t.length||"#Q=[]()"===e||!e.startsWith("#Q="))return e;if(!t.match(/^#Q=\[[TIOSZJL]?]\([TIOSZJL]?\)[TIOSZJL]*;?.*$/i))throw new o.FumenError("Current piece doesn't exist, however next pieces exist: "+e);return t},e.prototype.direct=function(){if(""===this.current){var t=this.leastAfterNext2;return new e("#Q=["+this.hold+"]("+t[0]+")"+t.substr(1))}return new e("#Q=["+this.hold+"]("+this.next+")"+this.leastAfterNext2)},e.prototype.swap=function(){if(""===this.hold)throw new o.FumenError("Cannot find hold piece: "+this.quiz);var t=this.next;return new e("#Q=["+this.current+"]("+t+")"+this.leastAfterNext2)},e.prototype.stock=function(){if(""!==this.hold||""===this.next)throw new o.FumenError("Cannot stock: "+this.quiz);var t=this.leastAfterNext2,n=void 0!==t[0]?t[0]:"";return 1<t.length?new e("#Q=["+this.current+"]("+n+")"+t.substr(1)):new e("#Q=["+this.current+"]("+n+")")},e.prototype.operate=function(e){switch(e){case i.Operation.Direct:return this.direct();case i.Operation.Swap:return this.swap();case i.Operation.Stock:return this.stock()}},e.prototype.format=function(){var t=this.nextIfEnd();if("#Q=[]()"===t.quiz)return new e("");var n=t.current,o=t.hold;if(""===n&&""!==o)return new e("#Q=[]("+o+")"+t.least);if(""===n){var i=t.least,r=i[0];return new e(void 0===r?"":";"===r?i.substr(1):"#Q=[]("+r+")"+i.substr(1))}return t},e.prototype.getHoldPiece=function(){if(!this.canOperate())return i.Piece.Empty;var e=this.hold;return void 0===e||""===e||";"===e?i.Piece.Empty:i.parsePiece(e)},e.prototype.getNextPieces=function(e){if(!this.canOperate())return void 0!==e?Array.from({length:e}).map((function(){return i.Piece.Empty})):[];var t=(this.current+this.next+this.leastInActiveBag).substr(0,e);return void 0!==e&&t.length<e&&(t+=" ".repeat(e-t.length)),t.split("").map((function(e){return void 0===e||" "===e||";"===e?i.Piece.Empty:i.parsePiece(e)}))},e.prototype.toString=function(){return this.quiz},e.prototype.canOperate=function(){var e=this.quiz;return e.startsWith("#Q=[]();")&&(e=this.quiz.substr(8)),e.startsWith("#Q=")&&"#Q=[]()"!==e},e.prototype.nextIfEnd=function(){return this.quiz.startsWith("#Q=[]();")?new e(this.quiz.substr(8)):this},e}();t.Quiz=r},2375:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Values=t.ENCODE_TABLE_LENGTH=void 0;var o=n(8286),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t.ENCODE_TABLE_LENGTH=i.length;var r=function(){function e(e){void 0===e&&(e=""),this.values=e.split("").map(a)}return e.prototype.poll=function(e){for(var n=0,i=0;i<e;i+=1){var r=this.values.shift();if(void 0===r)throw new o.FumenError("Unexpected");n+=r*Math.pow(t.ENCODE_TABLE_LENGTH,i)}return n},e.prototype.push=function(e,n){void 0===n&&(n=1);for(var o=e,i=0;i<n;i+=1)this.values.push(o%t.ENCODE_TABLE_LENGTH),o=Math.floor(o/t.ENCODE_TABLE_LENGTH)},e.prototype.merge=function(e){for(var t=0,n=e.values;t<n.length;t++){var o=n[t];this.values.push(o)}},e.prototype.isEmpty=function(){return 0===this.values.length},Object.defineProperty(e.prototype,"length",{get:function(){return this.values.length},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.values[e]},e.prototype.set=function(e,t){this.values[e]=t},e.prototype.toString=function(){return this.values.map(s).join("")},e}();function a(e){return i.indexOf(e)}function s(e){return i[e]}t.Values=r},5584:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HyperStage=void 0;var o=n(655),i=n(6314),r=function(){function e(){}return e.prototype.addStage=function(e){this.stage=e},e.prototype.removeStage=function(){void 0!==this.stage&&(this.stage.removeChildren(),this.stage=void 0)},Object.defineProperty(e.prototype,"isReady",{get:function(){return void 0!==this.stage},enumerable:!1,configurable:!0}),e.prototype.resize=function(e){void 0!==this.stage&&this.stage.setSize(e)},e.prototype.batchDraw=function(){void 0!==this.stage&&this.stage.batchDraw()},e.prototype.reload=function(e){var t=this;if(void 0!==this.stage){var n=this.stage;setTimeout((function(){return o.__awaiter(t,void 0,void 0,(function(){var t,r,a,s=this;return o.__generator(this,(function(c){switch(c.label){case 0:return t=function(e){return o.__awaiter(s,void 0,void 0,(function(){return o.__generator(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},r=function(e){return o.__awaiter(s,void 0,void 0,(function(){return o.__generator(this,(function(o){switch(o.label){case 0:return e.hide(),n.batchDraw(),[4,t(4)];case 1:return o.sent(),[2]}}))}))},a=i.resources.konva.layers,[4,r(a.boxes)];case 1:return c.sent(),[4,r(a.field)];case 2:return c.sent(),[4,r(a.background)];case 3:return c.sent(),e((function(e){var i=function(e){return o.__awaiter(s,void 0,void 0,(function(){return o.__generator(this,(function(o){switch(o.label){case 0:return e.show(),n.batchDraw(),[4,t(6)];case 1:return o.sent(),[2]}}))}))},r=void 0!==e?e:30;setTimeout((function(){return o.__awaiter(s,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,t(r)];case 1:return e.sent(),[4,i(a.background)];case 2:return e.sent(),[4,i(a.field)];case 3:return e.sent(),[4,i(a.boxes)];case 4:return e.sent(),[2]}}))}))}),0)})),[2]}}))}))}),0)}},e}();t.HyperStage=r},3876:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.inferPiece=void 0;for(var o=n(9774),i=[{positions:[0,1,10,11],result:{piece:o.Piece.O,rotate:o.Rotation.Spawn,offset:{x:0,y:0}}},{positions:[0,1,2,3],result:{piece:o.Piece.I,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,10,20,30],result:{piece:o.Piece.I,rotate:o.Rotation.Right,offset:{x:0,y:2}}},{positions:[0,1,2,11],result:{piece:o.Piece.T,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,9,10,11],result:{piece:o.Piece.T,rotate:o.Rotation.Reverse,offset:{x:0,y:1}}},{positions:[0,10,11,20],result:{piece:o.Piece.T,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,9,10,20],result:{piece:o.Piece.T,rotate:o.Rotation.Left,offset:{x:0,y:1}}},{positions:[0,1,11,12],result:{piece:o.Piece.S,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,9,10,19],result:{piece:o.Piece.S,rotate:o.Rotation.Right,offset:{x:-1,y:1}}},{positions:[0,1,9,10],result:{piece:o.Piece.Z,rotate:o.Rotation.Spawn,offset:{x:0,y:0}}},{positions:[0,10,11,21],result:{piece:o.Piece.Z,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,1,2,12],result:{piece:o.Piece.L,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,10,11,12],result:{piece:o.Piece.L,rotate:o.Rotation.Reverse,offset:{x:1,y:1}}},{positions:[0,1,10,20],result:{piece:o.Piece.L,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,10,19,20],result:{piece:o.Piece.L,rotate:o.Rotation.Left,offset:{x:0,y:1}}},{positions:[0,1,2,10],result:{piece:o.Piece.J,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,8,9,10],result:{piece:o.Piece.J,rotate:o.Rotation.Reverse,offset:{x:-1,y:1}}},{positions:[0,10,20,21],result:{piece:o.Piece.J,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,1,11,21],result:{piece:o.Piece.J,rotate:o.Rotation.Left,offset:{x:1,y:1}}}],r=function(e){for(var t=0,n="",o=0,i=e;o<i.length;o++){var r=i[o],a=Math.floor(r/10);if(t+1<a)return"";t=a,n+=r+","}return n},a=new Map,s=0,c=i;s<c.length;s++){var u=c[s],d=r(u.positions);a.set(d,u.result)}var l=function(e,t){return e-t};t.inferPiece=function(e){if(4===e.length){var t=new Set;e.forEach((function(e){return t.add(Math.floor(e/10))}));var n=Array.from(t.keys()).map(Number).sort(l),o={};n.forEach((function(e,t){o[""+e]=t}));for(var i=e.sort(l),s=i.map((function(e){var t=e%10,n=Math.floor(e/10);return 10*o[""+n]+t})),c=!1,u=1;u<n.length;u+=1)if(1<n[u]-n[u-1]){c=!0;break}var d=s[0],f=s.map((function(e){return e-d})),p=a.get(r(f));if(p){var g=i[0],m=g%10,h=Math.floor(g/10);return{piece:p.piece,rotate:p.rotate,coordinate:c?void 0:{x:m+p.offset.x,y:h+p.offset.y}}}}}},1983:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseToCommands=t.PageFieldOperation=t.Pages=t.isQuizCommentResult=t.isTextCommentResult=void 0;var o=n(655),i=n(8286),r=n(9774),a=n(4826);function s(e){return void 0!==e.text}t.isTextCommentResult=s,t.isQuizCommentResult=function(e){return void 0!==e.quiz};var c,u=function(){function e(e){this.pages=e}return e.extractNext=function(e){for(var t=[],n=e[0],o=void 0!==n.piece?n.piece.type:r.Piece.Empty,i=0,a=e;i<a.length;i++){var s=a[i];if(void 0!==s.piece&&o!==s.piece.type){var c=s.piece.type;r.isMinoPiece(c)&&t.push(c),o=c}if(5<=t.length)break;(void 0===s.piece||s.flags.lock)&&(o=r.Piece.Empty)}return t},e.prototype.getComment=function(e){return this.pages[e].flags.quiz?this.restructureQuiz(e):this.getDescription(e)},e.prototype.setComment=function(e,t){var n=this.pages[e];void 0===n.comment.text&&this.freezeComment(e),void 0!==n.comment.text&&(n.comment.text=t)},e.prototype.getField=function(e,t){return void 0===t&&(t=c.None),this.restructureField(e,t)},e.prototype.insertRefPage=function(e){if(e<0)throw new i.FumenError("Illegal index: "+e);var t=this.pages[e-1];if(void 0===t)throw new i.FumenError("Not found prev page: "+e);var n={index:e,field:{ref:void 0},comment:{ref:void 0},flags:{lock:t.flags.lock,mirror:!t.flags.lock&&t.flags.mirror,colorize:t.flags.colorize,rise:!t.flags.lock&&t.flags.rise,quiz:t.flags.quiz},piece:t.flags.lock?void 0:t.piece};if(void 0!==t.field.ref)n.field.ref=t.field.ref;else{if(void 0===t.field.obj)throw new i.FumenError("Unexpected field: "+t.field);n.field.ref=e-1}if(void 0!==t.comment.ref)n.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new i.FumenError("Unexpected comment: "+t.comment);n.comment.ref=e-1}this.insertPage(e,[n])},e.prototype.insertKeyPage=function(e){if(e<0)throw new i.FumenError("Illegal index: "+e);var t=this.pages[e-1];if(void 0===t)throw new i.FumenError("Not found prev page: "+e);var n={index:e,field:{obj:this.restructureField(e-1,c.All)},comment:{ref:void 0},flags:{lock:t.flags.lock,mirror:!t.flags.lock&&t.flags.mirror,colorize:t.flags.colorize,rise:!t.flags.lock&&t.flags.rise,quiz:t.flags.quiz},piece:t.flags.lock?void 0:t.piece};if(void 0!==t.comment.ref)n.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new i.FumenError("Unexpected comment: "+t.comment);n.comment.ref=e-1}this.insertPage(e,[n])},e.prototype.insertPage=function(e,t){if(void 0===t[0])throw new i.ViewError("No inserted pages");var n=t[0].index,o=t.map((function(t,o){if(t.index=e+o,void 0!==t.field.ref){var i=t.field.ref;t.field.ref=e+(i-n)}return void 0!==t.comment.ref&&(i=t.comment.ref,t.comment.ref=e+(i-n)),t})),r=o.length,a=o[r-1],s={field:void 0!==a.field.ref?a.field.ref:a.index,comment:void 0!==a.comment.ref?a.comment.ref:a.index};this.pages=this.pages.slice(0,e).concat(o).concat(this.pages.slice(e).map((function(t){var n;return t.index+=r,void 0!==t.field.ref&&((n=t.field.ref)<e?t.field.ref=s.field:e<=n&&(t.field.ref+=r)),void 0!==t.comment.ref&&((n=t.comment.ref)<e?t.comment.ref=s.comment:e<=n&&(t.comment.ref+=r)),t})))},e.prototype.duplicatePage=function(e){if(e<0)throw new i.FumenError("Illegal index: "+e);var t=this.pages[e-1];if(void 0===t)throw new i.FumenError("Not found prev page: "+e);var n={index:e,field:{obj:this.restructureField(e-1,c.Command)},comment:{ref:void 0},flags:o.__assign({},t.flags),piece:void 0!==t.piece?{type:t.piece.type,rotation:t.piece.rotation,coordinate:o.__assign({},t.piece.coordinate)}:void 0};if(void 0!==t.comment.ref)n.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new i.FumenError("Unexpected comment: "+t.comment);n.comment.ref=e-1}this.insertPage(e,[n])},e.prototype.deletePage=function(e,t){var n=this.pages[t],o={field:0,comment:0},i=this.pages.slice(0,e).reverse();if(void 0!==n&&void 0!==n.field.obj)o.field=e;else{var r=i.findIndex((function(e){return void 0!==e.field.obj}));o.field=0<=r?e-r-1:0}void 0!==n&&void 0!==n.comment.text?o.comment=e:(r=i.findIndex((function(e){return void 0!==e.comment.text})),o.comment=0<=r?e-r-1:0);var a=t-e;this.pages=this.pages.slice(0,e).concat(this.pages.slice(t).map((function(t){var n;return t.index-=a,void 0!==t.field.ref&&((n=t.field.ref)<=e?t.field.ref=o.field:e<n&&(t.field.ref-=a)),void 0!==t.comment.ref&&((n=t.comment.ref)<=e?t.comment.ref=o.comment:e<n&&(t.comment.ref-=a)),t})))},e.prototype.toRefPage=function(e){var n=this.pages;if(e<=0||n.length<=e)throw new i.FumenError("Illegal index: "+e);if(void 0===n[e].field.obj)throw new i.FumenError("Not found field obj: "+e);var o=this.getField(e-1,c.All),r=this.getField(e,c.Command);n[e].commands=t.parseToCommands(o,r);for(var a=0,s=e-1;0<=s;s-=1)if(void 0!==n[s].field.obj){a=s;break}for(s=a+1;s<n.length;s+=1)n[s].field.ref===e&&(n[s].field.ref=a);n[e].field={ref:a}},e.prototype.toKeyPage=function(e){var t=this.pages;if(!(e<=0||t.length<=e)&&void 0!==t[e].field.ref){for(var n=this.getField(e,c.None),o=e+1;o<t.length;o+=1){var i=t[o].field.ref;void 0!==i&&i<e&&(t[o].field.ref=e)}t[e].field={obj:n}}},e.prototype.freezeComment=function(e){var t=this.pages;if(!(e<=0||t.length<=e)){var n=t[e];if(void 0===n)throw new i.FumenError("Not found page");if(void 0===n.comment.text&&void 0!==n.comment.ref){var o=this.getComment(e);s(o)?n.comment={text:o.text}:n.comment={text:o.quiz};for(var r=e+1;r<t.length;r+=1){var a=t[r].comment.ref;void 0!==a&&a<e&&(t[r].comment.ref=e)}}}},e.prototype.unfreezeComment=function(e){var t=this.pages;if(!(e<=0||t.length<=e)){var n=t[e];if(void 0===n)throw new i.FumenError("Not found page");if(void 0===n.comment.ref&&void 0!==n.comment.text){for(var o=0,r=e-1;0<=r;r-=1)if(void 0===t[r].comment.ref){o=r;break}for(r=e+1;r<t.length;r+=1){var a=t[r].comment.ref;void 0!==a&&a===e&&(t[r].comment.ref=o)}t[e].comment={ref:o}}}},e.prototype.restructureQuiz=function(t){var n=this,o=this.pages[t];return function(){var s=void 0;if(void 0!==o.comment.text)s={comment:u=o.comment.text,quiz:new a.Quiz(u),startIndex:t};else{var c=o.comment.ref;if(void 0===c)throw new i.ViewError("Cannot open reference for comment");if(void 0===s){var u,d=n.pages[c];if(void 0===d.comment.text)throw new i.ViewError("Not found quiz");s={comment:u=d.comment.text,quiz:new a.Quiz(u),startIndex:c}}}if(void 0===s)throw new i.ViewError("Unexpected state");for(var l={quiz:s.quiz,comment:s.comment},f={quizAfterOperation:l.quiz,quiz:l.comment},p=s.startIndex;p<=t;p+=1){var g=n.pages[p];if(!g.flags.quiz)throw new i.ViewError("Unexpected quiz operation");var m=l.quiz;if(!m.canOperate())return{text:l.comment,next:e.extractNext(n.pages.slice(t))};if(g.flags.lock)if(void 0!==g.piece&&r.isMinoPiece(g.piece.type))try{var h=(y=m.nextIfEnd()).getOperation(g.piece.type),v=y.operate(h);f={quizAfterOperation:v,quiz:l.comment},l={quiz:v,comment:v.format().toString()}}catch(e){var y;console.error(e),f={quizAfterOperation:l.quiz,quiz:l.comment},l={quiz:y=m.format(),comment:y.toString()}}else f={quizAfterOperation:l.quiz,quiz:l.comment},l={quiz:y=m.format(),comment:y.toString()};else f={quizAfterOperation:l.quiz,quiz:l.comment}}return f}()},e.prototype.getDescription=function(t){var n=this,o=this.pages[t];return{next:e.extractNext(this.pages.slice(t)),text:function(){if(void 0!==o.comment.text)return o.comment.text;if(void 0!==o.comment.ref){var e=n.pages[o.comment.ref];if(void 0===e.comment.text)throw new i.ViewError("Unexpected comment");return e.comment.text}throw new i.ViewError("Not found comment")}()}},e.prototype.restructureField=function(e,t){var n=this,o=this.pages[e];return function(){var a=void 0;if(void 0!==o.field.obj)a={field:o.field.obj.copy(),startIndex:e,cache:!1};else{var s=o.field.ref;if(void 0===s)throw new i.ViewError("Cannot open reference for comment");if(void 0===a){var u=n.pages[s];if(void 0===u.field.obj)throw new i.ViewError("Not found quiz");a={field:u.field.obj.copy(),startIndex:s,cache:!1}}}if(void 0===a)throw new i.ViewError("Unexpected state");for(var d=a.field,l=function(o){var i=o===e;if(i&&t===c.None)return{value:d};d.copy();var a=n.pages[o],s=a.flags,u=a.piece,l=a.commands;if(void 0!==l&&Object.keys(l.pre).map((function(e){return l.pre[e]})).forEach((function(e){switch(e.type){case"block":var t=e.x,n=e.y,o=e.piece;return void d.setToPlayField(t+10*n,o);case"sentBlock":t=e.x,n=e.y;var i=e.piece;return void d.setToSentLine(t+10*n,i)}})),i&&t===c.Command)return{value:d};s.lock&&(void 0!==u&&r.isMinoPiece(u.type)&&d.put(u),d.clearLine(),s.rise&&d.up(),s.mirror&&d.mirror())},f=a.startIndex;f<=e;f+=1){var p=l(f);if("object"==typeof p)return p.value}return d}()},e.prototype.setQuizFlag=function(e){this.changeQuizFlag(e,!0)},e.prototype.unsetQuizFlag=function(e){this.changeQuizFlag(e,!1)},e.prototype.changeQuizFlag=function(e,t){var n=this.pages[e];if(void 0===n.comment.text)throw new i.FumenError("Comment does not exist in page: index="+e+", flag="+t);n.flags.quiz=t;for(var o=e+1;o<this.pages.length;o+=1){var r=this.pages[o];if(r.comment.ref!==e)break;r.flags.quiz=t}},e}();t.Pages=u,function(e){e.None="None",e.Command="Command",e.All="All"}(c=t.PageFieldOperation||(t.PageFieldOperation={})),t.parseToCommands=function(e,t){for(var n={pre:{}},o=-1;o<23;o+=1)for(var i=0;i<10;i+=1){var r=e.get(i,o),a=t.get(i,o),s=0<=o,c=s?"block":"sentBlock",u=c+"-"+(s?i+10*o:i);r!==a&&(n.pre[u]={x:i,type:c,y:s?o:o+1,piece:a})}return n}},8711:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPieces=t.getBlocks=t.getBlockPositions=void 0;var o=n(8286),i=n(9774);function r(e,t){var n=a(e);switch(t){case i.Rotation.Spawn:return n;case i.Rotation.Left:return n.map((function(e){return[-e[1],e[0]]}));case i.Rotation.Reverse:return n.map((function(e){return[-e[0],-e[1]]}));case i.Rotation.Right:return function(e){return e.map((function(e){return[e[1],-e[0]]}))}(n)}}function a(e){switch(e){case i.Piece.I:return[[0,0],[-1,0],[1,0],[2,0]];case i.Piece.T:return[[0,0],[-1,0],[1,0],[0,1]];case i.Piece.O:return[[0,0],[1,0],[0,1],[1,1]];case i.Piece.L:return[[0,0],[-1,0],[1,0],[1,1]];case i.Piece.J:return[[0,0],[-1,0],[1,0],[-1,1]];case i.Piece.S:return[[0,0],[-1,0],[0,1],[1,1]];case i.Piece.Z:return[[0,0],[1,0],[0,1],[-1,1]]}throw new o.FumenError("Unsupported rotation")}t.getBlockPositions=function(e,t,n,o){return r(e,t).map((function(e){return e[0]+=n,e[1]+=o,e}))},t.getBlocks=r,t.getPieces=a},5187:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateKey=void 0;var n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";t.generateKey=function(e){void 0===e&&(e=8);var t=n.length;return Array.from({length:e}).map((function(){return n[Math.floor(Math.random()*t)]})).join("")}},7989:(e,t,n)=>{var o,i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.testRightRotation=t.testLeftRotation=void 0;var a=n(9774),s=((o={})[a.Rotation.Spawn]=[[0,0],[-1,0],[2,0],[-1,0],[2,0]],o[a.Rotation.Right]=[[-1,0],[0,0],[0,0],[0,1],[0,-2]],o[a.Rotation.Reverse]=[[-1,1],[1,1],[-2,1],[1,0],[-2,0]],o[a.Rotation.Left]=[[0,1],[0,1],[0,1],[0,-1],[0,2]],o),c=((i={})[a.Rotation.Spawn]=[[0,0]],i[a.Rotation.Right]=[[0,-1]],i[a.Rotation.Reverse]=[[-1,-1]],i[a.Rotation.Left]=[[-1,0]],i),u=((r={})[a.Rotation.Spawn]=[[0,0],[0,0],[0,0],[0,0],[0,0]],r[a.Rotation.Right]=[[0,0],[1,0],[1,-1],[0,2],[1,2]],r[a.Rotation.Reverse]=[[0,0],[0,0],[0,0],[0,0],[0,0]],r[a.Rotation.Left]=[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],r),d=function(e){switch(e){case a.Piece.I:return s;case a.Piece.O:return c;default:return u}};t.testLeftRotation=function(e,t){for(var n=d(e),o=n[t],i=a.nextRotationToLeft(t),r=n[i],s=[],c=0;c<o.length;c+=1)s.push([o[c][0]-r[c][0],o[c][1]-r[c][1]]);return{test:s,rotation:i}},t.testRightRotation=function(e,t){for(var n=d(e),o=n[t],i=a.nextRotationToRight(t),r=n[i],s=[],c=0;c<o.length;c+=1)s.push([o[c][0]-r[c][0],o[c][1]-r[c][1]]);return{test:s,rotation:i}}},4055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.px=t.style=void 0,t.style=function(e){return e},t.px=function(e){return e+"px"}},7486:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=void 0,t.resources={Top:{RestoreFromStorage:"Restored to last state"},OpenFumen:{Title:"Open fumen",PlaceHolder:"URL or v115@~ / Support v115 or v110",Buttons:{Open:"Open",Cancel:"Cancel"},Errors:{FailedToLoad:"Failed to load",Unexpected:"Unexpected error: {{message}}"}},AppendFumen:{Title:"Append fumen",PlaceHolder:"URL or v115@~ / Support v115 or v110",Buttons:{AppendToEnd:"End",AppendToNext:"Next"},Errors:{FailedToLoad:"Failed to load",Unexpected:"Unexpected error: {{message}}"}},Clipboard:{Title:"Copy to clipboard",Buttons:{Close:"Close"}},Menu:{Title:"Menu",Build:"build {{version}}",Buttons:{Readonly:"Readonly",Writable:"Edit",Clipboard:"Clipboard",FirstPage:"FirstPage",LastPage:"LastPage",New:"New",Open:"Open",Help:"Help",ShowComment:"ShowText",ReadonlyComment:"ReadText",WritableComment:"WriteText",PageSlider:"PageSlider",ClearToEnd:"ClearToEnd",ClearPast:"ClearPast",Append:"Append",GhostOn:"GhostOn",GhostOff:"GhostOff"},Messages:{NoAvailableCommentButton:"Available only when writable mode"}}}},1307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=void 0,t.resources={Top:{RestoreFromStorage:"最後の状態が復元されました"},OpenFumen:{Title:"テト譜を開く",Buttons:{Open:"開く",Cancel:"キャンセル"},Errors:{FailedToLoad:"テト譜を読み込めませんでした"}},AppendFumen:{Title:"テト譜を追加",Errors:{FailedToLoad:"テト譜を読み込めませんでした"}},Clipboard:{Title:"クリップボードにコピー"},Menu:{Messages:{NoAvailableCommentButton:"Writableモードのときだけ変更できます"}}}},4257:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=void 0;var o=n(655).__importDefault(n(2181)),i=function(e,t){return o.default.t(e,t)};t.i18n={Top:{RestoreFromStorage:function(){return i("Top.RestoreFromStorage")}},OpenFumen:{Title:function(){return i("OpenFumen.Title")},PlaceHolder:function(){return i("OpenFumen.PlaceHolder")},Buttons:{Open:function(){return i("OpenFumen.Buttons.Open")},Cancel:function(){return i("OpenFumen.Buttons.Cancel")}},Errors:{FailedToLoad:function(){return i("OpenFumen.Errors.FailedToLoad")},Unexpected:function(e){return i("OpenFumen.Errors.Unexpected",{message:e})}}},AppendFumen:{Title:function(){return i("AppendFumen.Title")},PlaceHolder:function(){return i("AppendFumen.PlaceHolder")},Buttons:{AppendToEnd:function(){return i("AppendFumen.Buttons.AppendToEnd")},AppendToNext:function(){return i("AppendFumen.Buttons.AppendToNext")}},Errors:{FailedToLoad:function(){return i("AppendFumen.Errors.FailedToLoad")},Unexpected:function(e){return i("AppendFumen.Errors.Unexpected",{message:e})}}},Clipboard:{Title:function(){return i("Clipboard.Title")},Buttons:{Close:function(){return i("Clipboard.Buttons.Close")}}},Menu:{Title:function(){return i("Menu.Title")},Build:function(e){return i("Menu.Build",{version:e})},Buttons:{Readonly:function(){return i("Menu.Buttons.Readonly")},Writable:function(){return i("Menu.Buttons.Writable")},Clipboard:function(){return i("Menu.Buttons.Clipboard")},FirstPage:function(){return i("Menu.Buttons.FirstPage")},LastPage:function(){return i("Menu.Buttons.LastPage")},New:function(){return i("Menu.Buttons.New")},Open:function(){return i("Menu.Buttons.Open")},ShowComment:function(){return i("Menu.Buttons.ShowComment")},ReadonlyComment:function(){return i("Menu.Buttons.ReadonlyComment")},WritableComment:function(){return i("Menu.Buttons.WritableComment")},PageSlider:function(){return i("Menu.Buttons.PageSlider")},Help:function(){return i("Menu.Buttons.Help")},ClearToEnd:function(){return i("Menu.Buttons.ClearToEnd")},ClearPast:function(){return i("Menu.Buttons.ClearPast")},Append:function(){return i("Menu.Buttons.Append")},GhostOn:function(){return i("Menu.Buttons.GhostOn")},GhostOff:function(){return i("Menu.Buttons.GhostOff")}},Messages:{NoAvailableCommentButton:function(){return i("Menu.Messages.NoAvailableCommentButton")}}}}},6266:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.memento=void 0;var o,i,r=n(655),a=n(2995),s=n(5187),c=n(2315),u={isWorking:!1,last:{key:s.generateKey(),saverObj:void 0}},d=function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return u.isWorking=!0,[4,c.encode(e,!0)];case 1:return t=n.sent(),u.isWorking=!1,[2,"v115@"+t]}}))}))},l=function(e){var t=s.generateKey(),n=function(e,t){var n=e.saveKey,o=e.pages,i=!1;return{save:function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t,a;return r.__generator(this,(function(r){switch(r.label){case 0:return i||e!==n?[2]:(i=!0,[4,d(o)]);case 1:return t=r.sent(),setTimeout((function(){return function(e){localStorage.setItem("data@1",e)}(t)}),0),void 0===(a=u.last).saverObj?[3,3]:[4,a.saverObj.save(a.key)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}}}({pages:e,saveKey:t});u.last={key:t,saverObj:n},setTimeout((function(){n.save(u.last.key).catch((function(e){return console.error(e)}))}),u.isWorking?3e3:0)};t.memento=(o=[],i=[],{save:function(e){l(e)},register:function(e,t){var n=o[o.length-1];return void 0!==n&&n.key===t&&a.isOperationTask(n)&&a.isOperationTask(e)?o[o.length-1]=a.toDecoratorOperationTask(n,e):(o.length<200||o.shift(),o.push(e)),i=[],o.length-1},undo:function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t,n,a;return r.__generator(this,(function(r){switch(r.label){case 0:return void 0===(t=o.pop())?[2,void 0]:(i.push(t),t.fixed?[4,t.revert()]:[3,2]);case 1:return a=r.sent(),[3,3];case 2:a=t.revert(e),r.label=3;case 3:return[2,{pages:(n=a).pages,index:n.index,undoCount:o.length-1,redoCount:i.length}]}}))}))},redo:function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t,n,a;return r.__generator(this,(function(r){switch(r.label){case 0:return void 0===(t=i.pop())?[2,void 0]:(o.push(t),t.fixed?[4,t.replay()]:[3,2]);case 1:return a=r.sent(),[3,3];case 2:a=t.replay(e),r.label=3;case 3:return[2,{pages:(n=a).pages,index:n.index,undoCount:o.length-1,redoCount:i.length}]}}))}))},lastKey:function(){var e=o[o.length-1];return void 0!==e?e.key:void 0}})},2742:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightType=void 0,(n=t.HighlightType||(t.HighlightType={}))[n.Normal=0]="Normal",n[n.Lighter=1]="Lighter",n[n.Highlight1=10]="Highlight1",n[n.Highlight2=11]="Highlight2"},6314:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=t.initState=void 0;var o=n(655),i=n(9774),r=n(5584),a=n(7210),s=n(5187),c=o.__importDefault(n(185)),u=n(9782),d=a.PageEnv.Version;t.initState={field:Array.from({length:230}).map((function(e){return{piece:i.Piece.Empty}})),sentLine:Array.from({length:10}).map((function(e){return{piece:i.Piece.Empty}})),comment:{text:"",isChanged:!1,changeKey:s.generateKey()},display:{width:window.document.body.clientWidth,height:window.document.body.clientHeight},hold:void 0,nexts:void 0,play:{status:i.AnimationState.Pause,intervalTime:1500},fumen:{currentIndex:0,maxPage:1,pages:[],value:void 0,errorMessage:void 0,guideLineColor:!0},cache:{currentInitField:new u.Field({}),taskKey:void 0},modal:{fumen:!1,menu:!1,append:!1,clipboard:!1},handlers:{animation:void 0},events:{piece:void 0,drawing:!1,inferences:[],prevPage:void 0,updated:!1},mode:{screen:window.location.hash.includes("#/writable")?i.Screens.Editor:i.Screens.Reader,type:i.ModeTypes.DrawingTool,touch:i.TouchTypes.Drawing,piece:void 0,comment:i.CommentType.Writable,ghostVisible:!0},history:{undoCount:0,redoCount:0},version:d},t.resources={modals:{menu:void 0,fumen:void 0,append:void 0,clipboard:void 0},konva:function(){var e={stage:new r.HyperStage,event:{},background:{},fieldMarginLine:{},fieldBlocks:[],sentBlocks:[],hold:{},nexts:[],layers:{background:new c.default.Layer({name:"background"}),field:new c.default.Layer({name:"field"}),boxes:new c.default.Layer({name:"boxes"}),overlay:new c.default.Layer({name:"overlay"})}},t=e.layers,n=new c.default.Rect({strokeWidth:0,opacity:1});e.background=n,t.background.add(n);var o=new c.default.Line({points:[]});e.fieldMarginLine=o,t.background.add(o);var i=Array.from({length:230}).map((function(){return new c.default.Rect({strokeWidth:0,opacity:1})}));e.fieldBlocks=i;for(var a=0,s=i;a<s.length;a++)n=s[a],t.field.add(n);i=Array.from({length:10}).map((function(){return new c.default.Rect({strokeWidth:0,opacity:.75})})),e.sentBlocks=i;for(var u=0,d=i;u<d.length;u++)n=d[u],t.field.add(n);var l=new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1}),f=Array.from({length:4}).map((function(){return new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1})}));e.hold={background:l,pieces:f};for(var p=0,g=[l].concat(f);p<g.length;p++)n=g[p],t.boxes.add(n);var m=Array.from({length:5}).map((function(){return{background:new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1}),pieces:Array.from({length:4}).map((function(){return new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1})}))}}));e.nexts=m;for(var h=0,v=m;h<v.length;h++)for(var y=v[h],x=(l=y.background,f=y.pieces,0),P=[l].concat(f);x<P.length;x++)n=P[x],t.boxes.add(n);return n=new c.default.Rect({fill:"#333",opacity:0,strokeEnabled:!1,listening:!0}),e.event=n,t.overlay.add(n),e}(),comment:void 0,focussedElement:void 0}},6085:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=void 0;var o=n(4361),i=n(9774),r=n(3288),a=n(6453),s=n(6691),c=n(5874),u=n(1336),d=n(1699);t.view=function(e,t){return o.div([function(){switch(e.mode.screen){case i.Screens.Reader:return r.view(e,t);case i.Screens.Editor:return a.view(e,t);default:return o.div(["Unexpected mode"])}}(),e.modal.fumen?s.OpenFumenModal({actions:t,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:""}):void 0,e.modal.menu?c.MenuModal({actions:t,version:e.version,screen:e.mode.screen,currentIndex:e.fumen.currentIndex,maxPageIndex:e.fumen.maxPage,comment:e.mode.comment,ghostVisible:e.mode.ghostVisible}):void 0,e.modal.append?u.AppendFumenModal({actions:t,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:"",currentIndex:e.fumen.currentIndex,maxPage:e.fumen.maxPage}):void 0,e.modal.clipboard?d.ClipboardModal({actions:t,pages:e.fumen.pages}):void 0])}},4028:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.blockMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.blockMode=function(e){var t=e.layout,n=e.modePiece,s=e.colorize,c=e.actions,u=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S,o.Piece.Empty,o.Piece.Gray];return i.div({style:a.toolStyle(t)},[r.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(u.map((function(e){return r.colorButton({layout:t,piece:e,colorize:s,onclick:c.selectPieceColor,highlight:n===e})}))).concat([r.inferenceButton({layout:t,actions:c,highlight:void 0===n})]))}},6453:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.getComment=t.toolStyle=void 0;var o=n(9774),i=n(6314),r=n(1809),a=n(3891),s=n(8174),c=n(4245),u=n(6100),d=n(4361),l=n(4055),f=n(4264),p=n(37),g=n(8722),m=n(4028),h=n(4932),v=n(5224),y=n(2908),x=n(2308),P=n(9135),b=n(6769),w=n(4961);t.toolStyle=function(e){var t=(e.canvas.size.height-e.field.size.height)/2;return l.style({marginTop:"0px",marginBottom:"0px",marginLeft:"10px",marginRight:"0px",padding:l.px(t)+" 0px",display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"center",height:l.px(e.canvas.size.height),width:l.px(e.buttons.size.width)})};var k=function(e,t,n){var r=e.fumen.pages[e.fumen.currentIndex],a=void 0===r||void 0!==r.field.obj,u=void 0===e.fumen.pages[0]||e.fumen.pages[0].flags.colorize;return d.div({key:"field-top",id:"field-top",style:l.style({display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",userSelect:"none"})},[c.KonvaCanvas({actions:t,canvas:n.canvas.size,hyperStage:i.resources.konva.stage}),s.Field({fieldMarginWidth:n.field.bottomBorderWidth,topLeft:n.field.topLeft,blockSize:n.field.blockSize,field:e.field,sentLine:e.sentLine,guideLineColor:e.fumen.guideLineColor}),function(){switch(e.mode.type){case o.ModeTypes.Drawing:return m.blockMode({layout:n,actions:t,colorize:u,modePiece:e.mode.piece});case o.ModeTypes.DrawingTool:return g.toolMode({layout:n,actions:t,keyPage:a,touchType:e.mode.touch,currentIndex:e.fumen.currentIndex});case o.ModeTypes.Piece:var i=e.fumen.pages[e.fumen.currentIndex];return h.pieceMode({layout:n,actions:t,move:void 0!==i?i.piece:void 0,existInferences:0<e.events.inferences.length,pages:e.fumen.pages,flags:i.flags,touchType:e.mode.touch,currentIndex:e.fumen.currentIndex});case o.ModeTypes.Flags:return y.flagsMode({layout:n,actions:t,keyPage:a,flags:r.flags,currentIndex:e.fumen.currentIndex});case o.ModeTypes.Utils:return x.utilsMode({layout:n,actions:t,touchType:e.mode.touch});case o.ModeTypes.Slide:return P.slideMode({layout:n,actions:t});case o.ModeTypes.Fill:return v.fillMode({layout:n,actions:t,colorize:u,modePiece:e.mode.piece});case o.ModeTypes.FillRow:return b.fillRowMode({layout:n,actions:t,colorize:u,modePiece:e.mode.piece});case o.ModeTypes.SelectPiece:return w.pieceSelectMode({layout:n,actions:t,currentIndex:e.fumen.currentIndex,colorize:u})}}()])},_=function(e,t){if(void 0!==e.mode)return u.DrawingEventCanvas({actions:t,fieldBlocks:i.resources.konva.fieldBlocks,sentBlocks:i.resources.konva.sentBlocks,fieldLayer:i.resources.konva.layers.field})},T=function(e,t,n){return r.EditorTools({actions:t,height:n,palette:a.Palette(o.Screens.Editor),animationState:e.play.status,currentPage:e.fumen.currentIndex+1,maxPage:e.fumen.maxPage,modeType:e.mode.type,undoCount:e.history.undoCount,redoCount:e.history.redoCount,inferenceCount:e.events.inferences.length})};t.getComment=function(e,t,n){var r=e.fumen.currentIndex,a=e.fumen.pages[r];switch(e.mode.comment){case o.CommentType.Writable:var s=void 0!==i.resources.comment||void 0!==a&&void 0!==a.comment.text,c=document.querySelector("#text-comment"),u=function(){c&&t.updateCommentText({text:c.value,pageIndex:e.fumen.currentIndex})};return f.comment({key:"text-comment",dataTest:"text-comment",id:"text-comment",textColor:s?"#333":"#757575",backgroundColorClass:"white",height:n.comment.size.height,text:void 0!==i.resources.comment?i.resources.comment.text:e.comment.text,placeholder:"comment",readonly:!1,commentKey:e.comment.changeKey,actions:{onupdate:u,onenter:function(){c&&c.blur()},onblur:function(){u(),t.commitCommentText()}}});case o.CommentType.Readonly:var d=e.fumen.currentIndex,l=e.fumen.pages[d];return s=void 0!==i.resources.comment||void 0!==l&&void 0!==l.comment.text,f.comment({key:"text-comment",dataTest:"text-comment",id:"text-comment",textColor:s?"#333":"#757575",backgroundColorClass:"white",height:n.comment.size.height,text:void 0!==i.resources.comment?i.resources.comment.text:e.comment.text,readonly:!0,commentKey:e.comment.changeKey});case o.CommentType.PageSlider:return p.page_slider({actions:t,datatest:"range-page-slider",size:{width:.8*n.comment.size.width,height:n.comment.size.height},currentIndex:e.fumen.currentIndex,maxPage:e.fumen.maxPage})}},t.view=function(e,n){var o,r,a,s,c,u=(r={width:(o=e.display).width,height:o.height-85},s={width:10*((a=Math.min((r.height-2.4-2)/24,(r.width-90)/10.5)-1)+1)+1,height:23.5*(a+1)+1+2.4+1},c={width:Math.min(.6*(r.width-s.width),80),height:Math.min(s.height/11.5,40)},{canvas:{topLeft:{x:0,y:0},size:{width:s.width,height:r.height}},field:{blockSize:a,bottomBorderWidth:2.4,topLeft:{x:0,y:(r.height-s.height)/2},size:{width:s.width,height:s.height}},buttons:{size:c},comment:{topLeft:{x:0,y:o.height-35-50},size:{width:o.width,height:35}},tools:{topLeft:{x:0,y:o.height-50},size:{width:o.width,height:50}}}),l=function(){return i.resources.konva.stage.batchDraw()};return d.div({oncreate:l,onupdate:l,key:"view"},[i.resources.konva.stage.isReady?_(e,n):void 0,k(e,n,u),d.div({key:"menu-top"},[t.getComment(e,n,u),T(e,n,u.tools.size.height)])])}},5224:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.fillMode=function(e){var t=e.layout,n=e.modePiece,s=e.colorize,c=e.actions,u=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S,o.Piece.Empty,o.Piece.Gray];return i.div({style:a.toolStyle(t)},[r.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(u.map((function(e){return r.colorButton({layout:t,piece:e,colorize:s,onclick:c.selectPieceColor,highlight:n===e})}))))}},6769:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillRowMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.fillRowMode=function(e){var t=e.layout,n=e.modePiece,s=e.colorize,c=e.actions,u=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S,o.Piece.Empty,o.Piece.Gray];return i.div({style:a.toolStyle(t)},[r.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(u.map((function(e){return r.colorButton({layout:t,piece:e,colorize:s,onclick:c.selectPieceColor,highlight:n===e})}))).concat([r.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return c.changeToUtilsMode()}},r.iconContents({description:"Back",iconSize:25,iconName:"chevron_left"}))]))}},2908:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flagsMode=void 0;var o=n(4361),i=n(7975),r=n(6453);t.flagsMode=function(e){var t=e.layout,n=e.currentIndex,a=(e.keyPage,e.flags),s=e.actions;return o.div({style:r.toolStyle(t)},[i.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),i.switchButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-lock-flag",key:"btn-lock-flag",onclick:function(){return s.changeLockFlag({index:n,enable:!a.lock})},enable:a.lock},i.switchIconContents({description:"lock",iconSize:22,enable:a.lock})),i.switchButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-rise-flag",key:"btn-rise-flag",onclick:function(){return s.changeRiseFlag({index:n,enable:!a.rise})},enable:a.rise},i.switchIconContents({description:"rise",iconSize:22,enable:a.rise})),i.switchButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-mirror-flag",key:"btn-mirror-flag",onclick:function(){return s.changeMirrorFlag({index:n,enable:!a.mirror})},enable:a.mirror},i.switchIconContents({description:"mirror",iconSize:22,enable:a.mirror}))])}},4932:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pieceMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453),s=n(1983);t.pieceMode=function(e){var t=e.layout,n=e.currentIndex,c=e.touchType,u=e.move,d=e.pages,l=e.existInferences,f=e.flags,p=e.actions,g=void 0!==u,m=void 0!==u?u.rotation:void 0;return i.div({style:a.toolStyle(t)},[r.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),r.rotationButton({layout:t,rotation:m,highlight:!1}),r.switchButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-lock-flag",key:"btn-lock-flag",onclick:function(){return p.changeLockFlag({index:n,enable:!f.lock})},enable:f.lock},r.switchIconContents({description:"lock",iconSize:22,enable:f.lock})),r.dualButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-move-to-left-end",key:"btn-move-to-left-end",enable:g,onclick:function(){return p.moveToLeftEnd()},contents:r.iconContents({description:"",iconSize:24,iconName:"skip_previous"})},{datatest:"btn-move-to-right-end",key:"btn-move-to-right-end",enable:g,onclick:function(){return p.moveToRightEnd()},contents:r.iconContents({description:"",iconSize:24,iconName:"skip_next"})}),r.dualButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-move-to-left",key:"btn-move-to-left",enable:g,onclick:function(){return p.moveToLeft()},contents:r.iconContents({description:"",iconSize:24,iconName:"keyboard_arrow_left"})},{datatest:"btn-move-to-right",key:"btn-move-to-right",enable:g,onclick:function(){return p.moveToRight()},contents:r.iconContents({description:"",iconSize:24,iconName:"keyboard_arrow_right"})}),r.dualButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-rotate-to-left",key:"btn-rotate-to-left",enable:g,onclick:function(){return p.rotateToLeft()},contents:r.iconContents({description:"",iconSize:23,iconName:"rotate_left"})},{datatest:"btn-rotate-to-right",key:"btn-rotate-to-right",enable:g,onclick:function(){return p.rotateToRight()},contents:r.iconContents({description:"",iconSize:23,iconName:"rotate_right"})}),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-harddrop",key:"btn-harddrop",enable:g,onclick:function(){return p.harddrop()}},r.iconContents({description:"drop",iconSize:22,iconName:"vertical_align_bottom"})),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-reset-piece",enable:l||void 0!==u,key:"btn-reset-piece",onclick:function(){p.clearPiece()}},r.iconContents({description:"reset",iconSize:23,iconName:"clear"})),r.dualSwitchButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336"},{datatest:"btn-move-piece",key:"btn-move-piece",enable:c===o.TouchTypes.MovePiece,onclick:function(){return p.changeToMovePieceMode()},contents:r.iconContents({description:"",iconSize:18,iconName:"pan_tool"})},{datatest:"btn-draw-piece",key:"btn-draw-piece",enable:c===o.TouchTypes.Piece,onclick:function(){return p.changeToDrawPieceMode()},contents:r.iconContents({description:"",iconSize:21,iconName:"edit"})}),r.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-select-mode",key:"btn-piece-select-mode",onclick:function(){var e=new s.Pages(d).getField(n,s.PageFieldOperation.Command);f.lock&&void 0!==u&&e.isOnGround(u.type,u.rotation,u.coordinate.x,u.coordinate.y)&&(p.insertPage({index:n+1}),p.openPage({index:n+1})),p.changeToSelectPieceMode()}},r.iconContents({description:"spawn",iconSize:22,iconName:"add"}))])}},4961:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pieceSelectMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.pieceSelectMode=function(e){var t=e.layout,n=(e.currentIndex,e.colorize),s=e.actions,c=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S];return i.div({style:a.toolStyle(t)},[r.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(c.map((function(e){return r.colorButton({layout:t,piece:e,colorize:n,onclick:function(e){var t=e.piece;s.spawnPiece({piece:t,guideline:n}),s.changeToMovePieceMode(),s.changeToPieceMode()},highlight:!1})}))).concat([r.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return s.changeToPieceMode()}},r.iconContents({description:"Back",iconSize:25,iconName:"chevron_left"}))]))}},9135:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.slideMode=void 0;var o=n(4361),i=n(7975),r=n(6453);t.slideMode=function(e){var t=e.layout,n=e.actions;return o.div({style:r.toolStyle(t)},[i.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),i.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-slide-to-up",key:"btn-slide-to-up",onclick:function(){return n.shiftToUp()}},i.iconContents({description:"",iconSize:22,iconName:"keyboard_arrow_up"})),i.dualButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-slide-to-left",key:"btn-slide-to-left",onclick:function(){return n.shiftToLeft()},contents:i.iconContents({description:"",iconSize:23,iconName:"keyboard_arrow_left"})},{datatest:"btn-slide-to-right",key:"btn-slide-to-right",onclick:function(){return n.shiftToRight()},contents:i.iconContents({description:"",iconSize:23,iconName:"keyboard_arrow_right"})}),i.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-slide-to-down",key:"btn-slide-to-down",onclick:function(){return n.shiftToBottom()}},i.iconContents({description:"",iconSize:22,iconName:"keyboard_arrow_down"})),i.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return n.changeToUtilsMode()}},i.iconContents({description:"Back",iconSize:25,iconName:"chevron_left"}))])}},8722:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toolMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.toolMode=function(e){var t=e.layout,n=e.currentIndex,s=e.keyPage,c=e.touchType,u=e.actions;return i.div({style:a.toolStyle(t)},[r.keyButton({toolButtonMargin:5,keyPage:s,currentIndex:n,actions:u,width:t.buttons.size.width,height:t.buttons.size.height}),r.toolSpace({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-insert-new-page",key:"btn-insert-new-page",onclick:function(){u.insertNewPage({index:n+1})}},r.iconContents({description:"add",iconSize:22,iconName:"note_add"})),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-duplicate-page",key:"btn-duplicate-page",onclick:function(){var e=n+1;u.duplicatePage({index:e}),u.openPage({index:e})}},r.iconContents({description:"copy",iconSize:22,iconName:"content_copy"})),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-remove-page",key:"btn-remove-page",onclick:function(){return u.removePage({index:n})}},r.iconContents({description:"remove",iconSize:22,iconName:"remove_circle_outline"})),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-utils-mode",key:"btn-utils-mode",onclick:function(){return u.changeToUtilsMode()}},r.iconContents({description:"utils",iconSize:24,iconName:"build"})),r.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-flags-mode",key:"btn-flags-mode",onclick:function(){return u.changeToFlagsMode()}},r.iconContents({description:"flags",iconSize:24,iconName:"flag"})),r.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:c===o.TouchTypes.Piece?"#fff":"#f44336",borderType:c===o.TouchTypes.Piece?"double":void 0,datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return u.changeToDrawPieceMode()}},r.iconContents({description:"piece",iconSize:20,iconName:"extension"})),r.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:c===o.TouchTypes.Drawing?"#fff":"#f44336",borderType:c===o.TouchTypes.Drawing?"double":void 0,datatest:"btn-block-mode",key:"btn-block-mode",onclick:function(){return u.changeToDrawingMode()}},r.iconContents({description:"block",iconSize:22,iconName:"edit"}))])}},2308:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utilsMode=void 0;var o=n(4361),i=n(7975),r=n(6453),a=n(9774);t.utilsMode=function(e){var t=e.layout,n=e.touchType,s=e.actions;return o.div({style:r.toolStyle(t)},[i.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-mirror",key:"btn-mirror",onclick:function(){s.convertToMirror()}},i.iconContents({description:"mirror",iconSize:22,iconName:"compare_arrows"})),i.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-convert-to-gray",key:"btn-convert-to-gray",onclick:function(){s.convertToGray()}},i.iconContents({description:"to gray",iconSize:22,iconName:"color_lens"})),i.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-clear-field",key:"btn-clear-field",onclick:function(){s.clearField()}},i.iconContents({description:"clear",iconSize:22,iconName:"clear"})),i.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:n===a.TouchTypes.Fill?"#fff":"#f44336",borderType:n===a.TouchTypes.Fill?"double":void 0,datatest:"btn-fill-mode",key:"btn-fill-mode",onclick:function(){return s.changeToFillMode()}},i.iconContents({description:"fill",iconSize:20,iconName:"brush"})),i.toolButton({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:n===a.TouchTypes.FillRow?"#fff":"#f44336",borderType:n===a.TouchTypes.FillRow?"double":void 0,datatest:"btn-fill-row-mode",key:"btn-fill-row-mode",onclick:function(){return s.changeToFillRowMode()}},i.iconContents({description:"row",iconSize:24,iconName:"power_input"})),i.toolButton({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-slide-mode",key:"btn-slide-mode",onclick:function(){return s.changeToShiftMode()}},i.iconContents({description:"slide",iconSize:24,iconName:"swap_vert"}))])}},7975:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toolSpace=t.dualSwitchButton=t.switchButton=t.dualButton=t.toolButton=t.keyButton=t.radioIconContents=t.switchIconContents=t.iconContents=t.inferenceButton=t.svgButton=t.rotationButton=t.colorButton=void 0;var o=n(655),i=n(4055),r=n(4361),a=n(9774);t.colorButton=function(e){var n=e.layout,o=e.piece,i=e.highlight,r=e.colorize,s=e.onclick,c=i?3:1,u=a.parsePieceName(o),d=r?"img/"+u+".svg":"img/"+u+"_classic.svg";return t.svgButton({src:d,layout:n,highlight:i,borderWidth:c,height:.55*n.buttons.size.height,datatest:"btn-piece-"+u.toLowerCase(),key:"btn-piece-"+u.toLowerCase(),onclick:function(){return s({piece:o})}})},t.rotationButton=function(e){var n=e.layout,o=e.rotation,i=e.highlight,r=void 0!==o?a.parseRotationName(o):"Empty",s="img/rotation_"+r+".svg";return t.svgButton({src:s,layout:n,highlight:i,height:.85*n.buttons.size.height,borderWidth:0,datatest:"img-rotation-"+r.toLowerCase(),key:"img-rotation-"+r.toLowerCase()})},t.svgButton=function(e){var n=e.src,o=e.datatest,a=e.key,s=e.layout,c=e.highlight,u=e.height,d=e.borderWidth,l=e.onclick,f=[r.img({src:n,height:""+u,style:i.style({margin:"auto"})})];return t.toolButton({borderWidth:d,datatest:o,key:a,onclick:l,width:s.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:c?"#ff5252":"#333"},f)},t.inferenceButton=function(e){var n=e.layout,o=e.highlight,i=e.actions,r=t.iconContents({description:"comp",iconSize:22,iconName:"image_aspect_ratio"}),a=o?3:1;return t.toolButton({borderWidth:a,width:n.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:o?"#ff5252":"#333",datatest:"btn-piece-inference",key:"btn-piece-inference",onclick:function(){return i.selectInferencePieceColor()}},r)},t.iconContents=function(e){var t=e.description,n=e.iconSize,o=e.iconName,a=i.style({display:"block",fontSize:i.px(n),border:"solid 0px #333",marginRight:i.px(2),cursor:"pointer"});return[r.i({className:"material-icons left",style:a},o)," ",r.span({style:i.style({fontSize:i.px(11)})},t)]},t.switchIconContents=function(e){var t=e.description,n=e.iconSize,o=e.enable,a=i.style({display:"block",fontSize:i.px(n),border:"solid 0px #000",marginRight:i.px(2),cursor:"pointer"});return[r.i({className:"material-icons left",style:a},o?"check_box":"check_box_outline_blank")," ",r.span({style:i.style({fontSize:i.px(11)})},t)]},t.radioIconContents=function(e){var t=e.description,n=(e.iconSize,e.enable),o=i.style({display:"block",border:"solid 0px #000",marginRight:i.px(2),cursor:"pointer"});return[r.i({className:"material-icons left",style:o},n?"radio_button_checked":"radio_button_unchecked")," ",r.span({style:i.style({fontSize:i.px(11)})},t)]},t.keyButton=function(e){var n=e.width,o=(e.height,e.toolButtonMargin),i=e.keyPage,r=e.currentIndex,a=e.actions,s=i?function(){return a.changeToRef({index:r})}:function(){return a.changeToKey({index:r})};return t.switchButton({width:n,borderWidth:1,margin:o,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-key-page",key:"btn-key-ref-page",onclick:s,enable:i},t.switchIconContents({description:"key",iconSize:18,enable:i}))},t.toolButton=function(e,t){var n=e.width,o=e.backgroundColorClass,a=e.textColor,s=e.borderColor,c=e.borderWidth,u=void 0===c?1:c,d=e.borderType,l=void 0===d?"solid":d,f=e.datatest,p=e.key,g=e.onclick,m=e.flexGrow,h=e.margin,v=e.enable,y=void 0===v||v;return r.a({datatest:f,key:p,href:"#",class:(void 0!==g?"waves-effect ":"")+"z-depth-0 btn-flat "+o+" "+(y?"":"disabled"),style:i.style({flexGrow:m,color:y?a:"#9e9e9e",border:y?l+" "+u+"px "+s:"solid 1px #9e9e9e",margin:i.px(h)+" 0px",padding:i.px(0),width:i.px(n),maxWidth:i.px(n),textAlign:"center"}),onclick:void 0!==g?function(e){g(e),e.stopPropagation(),e.preventDefault()}:void 0},[r.div({style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},t)])},t.dualButton=function(e,t,n){var a=e.width,s=e.backgroundColorClass,c=e.textColor,u=e.borderColor,d=e.borderWidth,l=void 0===d?1:d,f=e.borderType,p=void 0===f?"solid":f,g=e.flexGrow,m=e.margin,h=function(e){var t=e.datatest,n=e.key,o=e.contents,a=e.onclick,d=e.enable,f=void 0===d||d,g=e.margin;return r.a({datatest:t,key:n,href:"#",class:"waves-effect z-depth-0 btn-flat "+s+" "+(f?"":"disabled"),style:i.style({margin:g,color:f?c:"#9e9e9e",border:f?p+" "+l+"px "+u:"solid 1px #9e9e9e",padding:i.px(0),width:"50%",maxWidth:"50%",textAlign:"center"}),onclick:function(e){a(e),e.stopPropagation(),e.preventDefault()}},[r.div({style:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},o)])};return r.div({style:i.style({flexGrow:g,width:i.px(a),maxWidth:i.px(a),display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",margin:i.px(m)+" 0px",padding:i.px(0)})},[h(o.__assign(o.__assign({},t),{margin:"0px 2px 0px 0px"})),h(o.__assign(o.__assign({},n),{margin:"0px 0px 0px 2px"}))])},t.switchButton=function(e,t){var n=e.width,o=e.backgroundColorClass,a=e.textColor,s=e.borderColor,c=e.borderWidth,u=void 0===c?1:c,d=e.datatest,l=e.key,f=e.onclick,p=e.flexGrow,g=e.margin,m=e.enable;return r.a({key:l,href:"#",class:"waves-effect z-depth-0 btn-flat "+(m?o:"white"),datatest:d+"-"+(m?"on":"off"),style:i.style({flexGrow:p,color:m?"#fff":a,border:m?"solid "+u+"px "+s:"dashed 1px #333",margin:i.px(g)+" 0px",padding:i.px(0),width:i.px(n),maxWidth:i.px(n),textAlign:"center"}),onclick:function(e){f(e),e.stopPropagation(),e.preventDefault()}},[r.div({style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},t)])},t.dualSwitchButton=function(e,t,n){var a=e.width,s=e.backgroundColorClass,c=e.textColor,u=e.borderColor,d=e.borderWidth,l=void 0===d?1:d,f=(e.borderType,e.flexGrow),p=e.margin,g=function(e){var t=e.datatest,n=e.key,o=e.contents,a=e.onclick,d=e.enable,f=void 0===d||d,p=e.margin;return r.a({datatest:t,key:n,href:"#",class:"waves-effect z-depth-0 btn-flat "+(f?s:"white"),style:i.style({margin:p,color:f?"#fff":c,border:f?"solid "+l+"px "+u:"dashed 1px #333",padding:i.px(0),width:"50%",maxWidth:"50%",textAlign:"center"}),onclick:function(e){a(e),e.stopPropagation(),e.preventDefault()}},[r.div({style:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},o)])};return r.div({style:i.style({flexGrow:f,width:i.px(a),maxWidth:i.px(a),display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",margin:i.px(p)+" 0px",padding:i.px(0)})},[g(o.__assign(o.__assign({},t),{margin:"0px 2px 0px 0px"})),g(o.__assign(o.__assign({},n),{margin:"0px 0px 0px 2px"}))])},t.toolSpace=function(e){var t=e.width,n=e.key,o=e.flexGrow,a=e.margin;return r.div({key:n,class:"white",style:i.style({flexGrow:o,color:"#fff",borderWidth:i.px(0),margin:i.px(a)+" 0px",padding:i.px(0),width:i.px(t),maxWidth:i.px(t),boxSizing:"border-box",textAlign:"center"})},[])}},3288:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.getComment=void 0;var o=n(655),i=n(6314),r=n(4361),a=n(4245),s=n(4264),c=n(9774),u=n(5154),d=n(3149),l=n(3891),f=n(8174),p=n(6136),g=n(2742),m=n(37),h=function(e,t,n){return u.EventCanvas({actions:t,canvas:n.canvas.size,rect:i.resources.konva.event})},v=function(e,t,n){return r.div({key:"field-top",id:"field-top"},o.__spreadArrays([a.KonvaCanvas({actions:t,canvas:n.canvas.size,hyperStage:i.resources.konva.stage}),f.Field({fieldMarginWidth:n.field.bottomBorderWidth,topLeft:n.field.topLeft,blockSize:n.field.blockSize,field:e.field,sentLine:e.sentLine,guideLineColor:e.fumen.guideLineColor}),void 0!==e.hold?d.Box({size:n.hold.size,key:"box-hold",rects:i.resources.konva.hold,topLeft:n.hold.topLeft,piece:c.isMinoPiece(e.hold)?{type:e.hold,color:l.decidePieceColor(e.hold,g.HighlightType.Highlight2,e.fumen.guideLineColor),size:n.hold.boxSize/4-1}:void 0}):void 0],(void 0!==e.nexts?e.nexts:[]).map((function(t,o){return d.Box({size:n.hold.size,key:"box-next-"+o,rects:i.resources.konva.nexts[o],topLeft:n.nexts.topLeft(o),piece:c.isMinoPiece(t)?{type:t,color:l.decidePieceColor(t,g.HighlightType.Highlight2,e.fumen.guideLineColor),size:n.nexts.boxSize/4-1}:void 0})}))))},y=function(e,t,n){return p.ReaderTools({actions:t,height:n,currentPage:e.fumen.currentIndex+1,maxPage:e.fumen.maxPage,palette:l.Palette(c.Screens.Reader),animationState:e.play.status,pages:e.fumen.currentIndex+1+" / "+e.fumen.maxPage})};t.getComment=function(e,t,n){switch(e.mode.comment){case c.CommentType.PageSlider:return m.page_slider({actions:t,datatest:"range-page-slider",size:{width:.8*n.comment.size.width,height:n.comment.size.height},currentIndex:e.fumen.currentIndex,maxPage:e.fumen.maxPage});default:return s.comment({key:"text-comment",dataTest:"text-comment",id:"text-comment",textColor:e.comment.isChanged?"#fff":"#333",backgroundColorClass:""!==e.comment.text&&e.comment.isChanged?"green darken-1":"white",height:n.comment.size.height,text:e.comment.text,readonly:!0,commentKey:e.comment.changeKey})}},t.view=function(e,n){var o,a,s,c,u,d,l,f=(a={width:(o=e.display).width,height:o.height-85},s=Math.min(Math.floor(Math.min(a.height/23.5,a.width/10))-2,a.width/16),c={width:10*(s+1)+1,height:23.5*(s+1)+1+2.4+1},u=Math.max(Math.min(c.width/5*1.15,(a.width-c.width)/2-15),5),{canvas:{topLeft:{x:0,y:0},size:a},field:{blockSize:s,bottomBorderWidth:2.4,topLeft:l={x:(a.width-c.width)/2,y:(a.height-c.height)/2},size:c},hold:{boxSize:u,size:{width:u,height:u},topLeft:{x:l.x-(u+(d=u/4)/2),y:l.y}},nexts:{boxSize:u,size:{width:u,height:u},topLeft:function(e){return{x:l.x+c.width+d/2,y:l.y+e*(u+d)}}},comment:{topLeft:{x:0,y:o.height-85},size:{width:o.width,height:35}},tools:{topLeft:{x:0,y:o.height-50},size:{width:o.width,height:50}}}),p=function(){return i.resources.konva.stage.batchDraw()};return r.div({oncreate:p,onupdate:p,key:"view"},[i.resources.konva.stage.isReady?h(0,n,f):void 0,v(e,n,f),r.div({key:"menu-top"},[t.getComment(e,n,f),y(e,n,f.tools.size.height)])])}}},t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.m=e,n.x=e=>{},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0},t=[[5917,736]],o=e=>{},i=(i,r)=>{for(var a,s,[c,u,d,l]=r,f=0,p=[];f<c.length;f++)s=c[f],n.o(e,s)&&e[s]&&p.push(e[s][0]),e[s]=0;for(a in u)n.o(u,a)&&(n.m[a]=u[a]);for(d&&d(n),i&&i(r);p.length;)p.shift()();return l&&t.push.apply(t,l),o()},r=self.webpackChunktetfu_sp=self.webpackChunktetfu_sp||[];function a(){for(var o,i=0;i<t.length;i++){for(var r=t[i],a=!0,s=1;s<r.length;s++){var c=r[s];0!==e[c]&&(a=!1)}a&&(t.splice(i--,1),o=n(n.s=r[0]))}return 0===t.length&&(n.x(),n.x=e=>{}),o}r.forEach(i.bind(null,0)),r.push=i.bind(null,r.push.bind(r));var s=n.x;n.x=()=>(n.x=s||(e=>{}),(o=a)())})(),n.x()})();