(()=>{"use strict";var e,t={7210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PageEnv=void 0,t.PageEnv={Version:"1108",Debug:JSON.parse("true")}},5917:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.main=t.actions=void 0;var o,i=n(655),r=n(6314),a=n(6085),c=n(6540),s=n(1639),u=i.__importDefault(n(6073)),d=i.__importDefault(n(886)),l=n(1307),f=n(7486),g=n(7210),p=n(6886),m=n(8456),h=n(5597),v=n(7270),y=n(2265),x=n(9986),P=n(9632),b=n(2281),k=n(9673),w=n(7587),_=n(9164),C=n(4257),T=n(4848),S=n(6266);t.actions=i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign(i.__assign({},m.animationActions),h.modeActions),v.modalActions),y.pageActions),x.setterActions),P.utilsActions),b.mementoActions),p.fieldEditorActions),k.commentActions),w.convertActions),_.userSettingsActions),t.main=(void 0===(o=g.PageEnv.Debug)&&(o=!1),o?(0,s.withLogger)(c.app)(r.initState,t.actions,a.view,document.body):(0,c.app)(r.initState,t.actions,a.view,document.body)),window.onresize=function(){t.main.resize({width:window.document.body.clientWidth,height:window.document.body.clientHeight})},window.addEventListener("load",(function(){var e=(0,T.getURLQuery)();z(e),F(e),I()}));var z=function(e){var n=new d.default(null,{order:["myQueryDetector","querystring","navigator","path","subdomain"],cookieMinutes:0});n.addDetector({name:"myQueryDetector",lookup:function(){return e.get("lng")},cacheUserLanguage:function(){}}),u.default.use(n).init({fallbackLng:"en",resources:{en:{translation:f.resources},ja:{translation:l.resources}}}).then((function(){t.main.refresh()})).catch((function(){console.error("Failed to load i18n")}))},F=function(e){var n;return void 0!==(n=e.get("d"))?t.main.loadFumen({fumen:n}):(n=S.localStorageWrapper.loadFumen())?(M.toast({html:C.i18n.Top.RestoreFromStorage(),classes:"top-toast",displayLength:1500}),t.main.loadFumen({fumen:n})):t.main.loadNewFumen()},I=function(){var e=!1,n=S.localStorageWrapper.loadUserSettings();void 0!==n.ghostVisible&&(t.main.changeGhostVisible({visible:n.ghostVisible}),e=!0),void 0!==n.loop&&(t.main.changeLoop({enable:n.loop}),e=!0),void 0!==n.gradient&&(t.main.changeGradient({gradientStr:n.gradient}),e=!0),e&&t.main.reopenCurrentPage()};"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./sw.js").then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.error("SW registration failed: ",e)}))}))},8456:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.animationActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(9774);t.animationActions={startAnimation:function(){return function(e){return(0,i.sequence)(e,[t.animationActions.pauseAnimation(),function(){return{play:o.__assign(o.__assign({},e.play),{status:a.AnimationState.Play}),handlers:{animation:setInterval((function(){r.main.nextLoopPage()}),e.play.intervalTime)}}}])}},pauseAnimation:function(){return function(e){if(void 0!==e.handlers.animation)return clearInterval(e.handlers.animation),{play:o.__assign(o.__assign({},e.play),{status:a.AnimationState.Pause}),handlers:{animation:void 0}}}}}},9673:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commentActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(6314),c=n(4826),s=n(2995),u=n(1983);t.commentActions={updateCommentText:function(e){var t=e.text,n=e.pageIndex;return function(e){if(e.fumen.currentIndex!==n)return a.resources.comment=void 0,(0,i.sequence)(e,[d(n,void 0!==t?t:""),r.actions.reopenCurrentPage()]);var o=!1;return void 0!==t&&(o=void 0===a.resources.comment,a.resources.comment={pageIndex:n,text:t}),o?{}:void 0}},commitCommentText:function(){return function(e){if(void 0!==a.resources.comment){var t=a.resources.comment,n=t.text,o=t.pageIndex;return a.resources.comment=void 0,(0,i.sequence)(e,[r.actions.setCommentText({text:n,pageIndex:o})])}}},setCommentText:function(e){var t=e.text,n=e.pageIndex;return function(e){return(0,i.sequence)(e,[d(n,t),r.actions.reopenCurrentPage()])}},resetCommentText:function(e){var t=e.pageIndex;return function(e){return(0,i.sequence)(e,[p(t),r.actions.reopenCurrentPage()])}}};var d=function(e,t){return function(n){var o=n.fumen.pages[e];if(void 0!==o&&o.comment.text!==t)return c.Quiz.isQuizComment(t)?f(e,t)(n):g(e,t)(n)}},l=function(e,t){for(var n=void 0,o=t;o<e.length;o+=1)void 0!==e[o].comment.text&&(n=o);return n},f=function(e,t){return function(n){var a=n.fumen.pages,c=new u.Pages(a),d=a[e],f=l(a,e+1),g=void 0!==a[e-1]?c.getComment(e-1):void 0,p=[];if(void 0!==g&&(0,u.isQuizCommentResult)(g)&&g.quizAfterOperation.format().toString()===t){if(void 0!==d.comment.text){var m=d.comment.text;c.unfreezeComment(e),p.push((0,s.toUnfreezeCommentTask)(e,m))}a=c.pages}else{void 0===d.comment.text&&(c.freezeComment(e),p.push((0,s.toFreezeCommentTask)(e))),d.flags.quiz||(c.setQuizFlag(e),p.push((0,s.toSetQuizFlagTask)(e)));var h=(a=c.pages)[e],v=(0,s.toPrimitivePage)(h);h.comment={text:t},p.push((0,s.toSinglePageTask)(e,v,h))}if(void 0!==f&&void 0!==a[f]){var y=c.getComment(f-1);if((0,u.isQuizCommentResult)(y)){var x=y.quizAfterOperation.format().toString(),P=a[f];void 0!==P.comment.text&&P.comment.text===x&&(m=P.comment.text,c.unfreezeComment(f),p.push((0,s.toUnfreezeCommentTask)(f,m)))}}return(0,i.sequence)(n,[function(){return{fumen:o.__assign(o.__assign({},n.fumen),{pages:a})}},r.actions.registerHistoryTask({task:(0,s.toPageTaskStack)(p,e)})])}},g=function(e,t){return function(n){var a=n.fumen.pages,c=new u.Pages(a),d=a[e],f=l(a,e+1),g=void 0!==a[e-1]?c.getComment(e-1):void 0,p=[];if(void 0!==g&&(0,u.isTextCommentResult)(g)&&g.text===t){if(void 0!==d.comment.text){var m=d.comment.text;c.unfreezeComment(e),p.push((0,s.toUnfreezeCommentTask)(e,m))}a=c.pages}else{void 0===d.comment.text&&(c.freezeComment(e),p.push((0,s.toFreezeCommentTask)(e))),d.flags.quiz&&(c.unsetQuizFlag(e),p.push((0,s.toUnsetQuizFlagTask)(e)));var h=(a=c.pages)[e],v=(0,s.toPrimitivePage)(h);h.comment={text:t},p.push((0,s.toSinglePageTask)(e,v,h))}if(void 0!==f&&void 0!==a[f]){var y=a[f];void 0!==y.comment.text&&y.comment.text===t&&(m=y.comment.text,c.unfreezeComment(f),p.push((0,s.toUnfreezeCommentTask)(f,m)))}return(0,i.sequence)(n,[function(){return{fumen:o.__assign(o.__assign({},n.fumen),{pages:a})}},r.actions.registerHistoryTask({task:(0,s.toPageTaskStack)(p,e)})])}},p=function(e){return function(t){var n=t.fumen.pages,a=new u.Pages(n),c=n[e],d=[];if(!(e<=0)&&void 0!==c.comment.text){var l=c.comment.text;return a.unfreezeComment(e),d.push((0,s.toUnfreezeCommentTask)(e,l)),(0,i.sequence)(t,[function(){return{fumen:o.__assign(o.__assign({},t.fumen),{pages:n})}},r.actions.registerHistoryTask({task:(0,s.toPageTaskStack)(d,e)})])}}}},9609:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sequence=void 0;var o=n(655);t.sequence=function(e,t){for(var n=e,i={},r=0,a=t;r<a.length;r++){var c=a[r];if(void 0!==c){var s=c(n);i=o.__assign(o.__assign({},i),s),n=o.__assign(o.__assign({},e),i)}}return i}},7587:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(2995),c=n(1983),s=n(9774),u=n(8711),d=n(9782);t.convertActions={shiftToLeft:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,s=new c.Pages(n),d=n[t],l=(0,a.toPrimitivePage)(d),f=s.getField(t,c.PageFieldOperation.Command),g=f.copy();f.shiftToLeft();var p=d.piece;if(void 0!==p||!g.equals(f)){var m=s.getField(t,c.PageFieldOperation.None);if(d.commands=(0,c.parseToCommands)(m,f),void 0!==p){var h=(0,u.getBlockPositions)(p.type,p.rotation,p.coordinate.x,p.coordinate.y);Math.min.apply(Math,h.map((function(e){return e[0]})))<1?d.piece=void 0:p.coordinate.x-=1}return(0,i.sequence)(e,[r.actions.registerHistoryTask({task:(0,a.toSinglePageTask)(t,l,d)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},shiftToRight:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,s=new c.Pages(n),d=n[t],l=(0,a.toPrimitivePage)(d),f=s.getField(t,c.PageFieldOperation.Command),g=f.copy();f.shiftToRight();var p=d.piece;if(void 0!==p||!g.equals(f)){var m=s.getField(t,c.PageFieldOperation.None);if(d.commands=(0,c.parseToCommands)(m,f),void 0!==p){var h=(0,u.getBlockPositions)(p.type,p.rotation,p.coordinate.x,p.coordinate.y);8<Math.max.apply(Math,h.map((function(e){return e[0]})))?d.piece=void 0:p.coordinate.x+=1}return(0,i.sequence)(e,[r.actions.registerHistoryTask({task:(0,a.toSinglePageTask)(t,l,d)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},shiftToUp:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,d=new c.Pages(n),l=n[t],f=(0,a.toPrimitivePage)(l),g=d.getField(t,c.PageFieldOperation.Command),p=g.copy();g.shiftToUp();var m=l.piece;if(void 0!==m||!p.equals(g)){var h=d.getField(t,c.PageFieldOperation.None);if(l.commands=(0,c.parseToCommands)(h,g),void 0!==m){var v=(0,u.getBlockPositions)(m.type,m.rotation,m.coordinate.x,m.coordinate.y),y=Math.max.apply(Math,v.map((function(e){return e[1]})));s.FieldConstants.Height-2<y?l.piece=void 0:m.coordinate.y+=1}return(0,i.sequence)(e,[r.actions.registerHistoryTask({task:(0,a.toSinglePageTask)(t,f,l)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},shiftToBottom:function(){return function(e){var t=e.fumen.currentIndex,n=e.fumen.pages,s=new c.Pages(n),d=n[t],l=(0,a.toPrimitivePage)(d),f=s.getField(t,c.PageFieldOperation.Command),g=f.copy();f.shiftToBottom();var p=d.piece;if(void 0!==p||!g.equals(f)){var m=s.getField(t,c.PageFieldOperation.None);if(d.commands=(0,c.parseToCommands)(m,f),void 0!==p){var h=(0,u.getBlockPositions)(p.type,p.rotation,p.coordinate.x,p.coordinate.y);Math.min.apply(Math,h.map((function(e){return e[1]})))<1?d.piece=void 0:p.coordinate.y-=1}return(0,i.sequence)(e,[r.actions.registerHistoryTask({task:(0,a.toSinglePageTask)(t,l,d)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},convertToGray:function(){return function(e){return(0,i.sequence)(e,[r.actions.removeUnsettledItems(),l((function(e){var t=e.copy();return t.convertToGray(),t}))])}},clearField:function(){return function(e){return(0,i.sequence)(e,[r.actions.removeUnsettledItems(),l((function(e){return new d.Field({})}))])}},convertToMirror:function(){return function(e){return(0,i.sequence)(e,[r.actions.removeUnsettledItems(),m()])}}};var l=function(e){return function(t){var n=t.fumen.currentIndex,s=t.fumen.pages,u=new c.Pages(s),d=[],l=s[n];void 0===l.field.obj&&(u.toKeyPage(n),d.push((0,a.toKeyPageTask)(n))),void 0!==l.comment.ref&&(u.freezeComment(n),d.push((0,a.toFreezeCommentTask)(n)));var f=(0,a.toPrimitivePage)(l),g=u.getField(n,c.PageFieldOperation.Command),p=e(g);if(0!==d.length||!g.equals(p)){var m=u.getField(n,c.PageFieldOperation.None);return l.commands=(0,c.parseToCommands)(m,p),d.push((0,a.toSinglePageTask)(n,f,l)),(0,i.sequence)(t,[r.actions.registerHistoryTask({task:(0,a.toPageTaskStack)(d,n)}),function(){return{fumen:o.__assign(o.__assign({},t.fumen),{pages:s})}},r.actions.reopenCurrentPage()])}}},f=function(e){switch(e){case s.Piece.J:return s.Piece.L;case s.Piece.L:return s.Piece.J;case s.Piece.S:return s.Piece.Z;case s.Piece.Z:return s.Piece.S}return e},g=function(e){var t=e.type,n=e.rotation,o=e.coordinate,i=o.x,r=o.y,a=(0,u.getBlocks)(t,n),c=i+Math.max.apply(Math,a.map((function(e){return e[0]}))),d=r+Math.min.apply(Math,a.map((function(e){return e[1]}))),l=f(t),g=function(e){switch(e){case s.Rotation.Left:return s.Rotation.Right;case s.Rotation.Right:return s.Rotation.Left}return e}(n),p=(0,u.getBlocks)(l,g);return function(e,t,n,o){return{type:e,rotation:t,coordinate:{x:n,y:o}}}(l,g,9-c-Math.min.apply(Math,p.map((function(e){return e[0]}))),d-Math.min.apply(Math,p.map((function(e){return e[1]}))))},p=function(e){for(var t="",n=0;n<e.length;n+=1)switch(e[n]){case"L":t+="J";break;case"J":t+="L";break;case"S":t+="Z";break;case"Z":t+="S";break;default:t+=e[n]}return t},m=function(){return function(e){for(var t=e.fumen.currentIndex,n=e.fumen.pages,s=new c.Pages(n),u=[],l=n.length,m=t+1;m<n.length;m+=1)if(void 0!==n[m].field.obj){l=m;break}void 0===(C=n[t]).field.obj&&(s.toKeyPage(t),u.push((0,a.toKeyPageTask)(t))),void 0!==C.comment.ref&&(s.freezeComment(t),u.push((0,a.toFreezeCommentTask)(t)));for(var h=(0,a.toPrimitivePage)(C),v=s.getField(t,c.PageFieldOperation.Command),y=new d.Field({}),x=-1;x<23;x+=1)for(var P=0;P<10;P+=1){var b=v.get(9-P,x);y.add(P,x,f(b))}void 0!==C.piece&&(C.piece=g(C.piece));var k=s.getComment(t);if((0,c.isQuizCommentResult)(k)){var w=p(k.quiz);s.setComment(t,w)}var _=s.getField(t,c.PageFieldOperation.None);for(C.commands=(0,c.parseToCommands)(_,y),u.push((0,a.toSinglePageTask)(t,h,C)),m=t+1;m<l;m+=1){var C=n[m];h=(0,a.toPrimitivePage)(C),void 0!==C.piece&&(C.piece=g(C.piece)),k=s.getComment(t),void 0!==C.comment.text&&(0,c.isQuizCommentResult)(k)&&(w=p(k.quiz),s.setComment(t,w)),u.push((0,a.toSinglePageTask)(m,h,C))}return(0,i.sequence)(e,[r.actions.registerHistoryTask({task:(0,a.toPageTaskStack)(u,t)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n})}},r.actions.reopenCurrentPage()])}}},381:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBlockActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),c=n(2995),s=n(6886),u=n(3876),d=n(2742);t.drawBlockActions={fixInferencePiece:function(){return function(e){var t=e.events.inferences;if(!(t.length<4)){var n=(0,u.inferPiece)(t);if(n){var o=n.piece,i=e.fumen.currentIndex,d=e.fumen.pages[i],l=(0,c.toPrimitivePage)(d);d.commands||(d.commands={pre:{}});for(var f=0,g=t;f<g.length;f++){var p=g[f],m=p%10,h=Math.floor(p/10),v="block",y="".concat(v,"-").concat(p);e.cache.currentInitField.getAtIndex(p,!0)!==o?d.commands.pre[y]={x:m,y:h,piece:o,type:v}:delete d.commands.pre[y]}return(0,a.sequence)(e,[s.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,c.toSinglePageTask)(i,l,d)})])}}}},clearInferencePiece:function(){return function(e){return(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:[]})}}])}},resetInferencePiece:function(){return function(e){return(0,a.sequence)(e,[s.fieldEditorActions.clearInferencePiece(),r.actions.openPage({index:e.fumen.currentIndex})])}},ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece){if(void 0!==e.mode.piece)return(0,a.sequence)(e,[r.actions.fixInferencePiece(),function(e){return l(e,t,!0)},r.actions.ontouchMoveField({index:t})]);var n=e.events.inferences;return(0,a.sequence)(e,[void 0===n.find((function(e){return e===t}))?r.actions.fixInferencePiece():void 0,function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0===e.events.inferences.find((function(e){return e===t}))?i.Piece.Gray:i.Piece.Empty,updated:!1})}},r.actions.ontouchMoveField({index:t})])}}},ontouchMoveField:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece){if(void 0!==e.mode.piece)return f(e,t,!0);var n=e.events.piece;if(void 0!==n){var c=e.events.inferences;if(n!==i.Piece.Empty){if(4<=c.length)return;if(e.field[t].piece!==i.Piece.Empty&&e.field[t].highlight!==d.HighlightType.Lighter)return;if(void 0===c.find((function(e){return e===t}))){var s=e.events.inferences.concat([t]);return(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:s,updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})])}}return n===i.Piece.Empty?(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:e.events.inferences.filter((function(e){return e!==t})),updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})]):void 0}}}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=e.fumen.currentIndex,n=e.fumen.pages[t],o=e.events.updated;return(0,a.sequence)(e,[o&&void 0!==e.events.prevPage?r.actions.registerHistoryTask({task:(0,c.toSinglePageTask)(t,e.events.prevPage,n)}):void 0,g])}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){if(void 0===e.events.piece)return void 0!==e.mode.piece?(0,a.sequence)(e,[function(){return l(e,t,!1)},r.actions.ontouchMoveSentLine({index:t})]):void 0}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece)return void 0!==e.mode.piece?f(e,t,!1):void 0}}};var l=function(e,t,n){var s=e.fumen.currentIndex,u=(n?e.field[t]:e.sentLine[t]).piece!==e.mode.piece?e.mode.piece:i.Piece.Empty;if(void 0!==u)return(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{piece:u,prevPage:(0,c.toPrimitivePage)(e.fumen.pages[e.fumen.currentIndex]),updated:!1})}},r.actions.openPage({index:s})])},f=function(e,t,n){var i=e.fumen.pages,c=e.fumen.currentIndex,s=e.events.piece;if(void 0!==s&&(n?e.field[t]:e.sentLine[t]).piece!==s){var u=i[c];u.commands||(u.commands={pre:{}});var d=t%10,l=Math.floor(t/10),f=n?"block":"sentBlock",g="".concat(f,"-").concat(t);return e.cache.currentInitField.getAtIndex(t,n)!==s?u.commands.pre[g]={x:d,y:l,piece:s,type:f}:delete u.commands.pre[g],(0,a.sequence)(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:i}),events:o.__assign(o.__assign({},e.events),{updated:!0})}},r.actions.openPage({index:c})])}},g=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1})}}},6886:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fieldEditorActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),c=n(6312),s=n(381),u=n(1542),d=n(2995),l=n(2579),f=n(1983),g=n(7989),p=n(479),m=n(8286),h=n(8711);t.fieldEditorActions={fixInferencePiece:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.fixInferencePiece()(e);case i.TouchTypes.Piece:return c.putPieceActions.fixInferencePiece()(e)}}},clearInferencePiece:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.clearInferencePiece()(e);case i.TouchTypes.Piece:return c.putPieceActions.clearInferencePiece()(e)}}},resetInferencePiece:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.resetInferencePiece()(e);case i.TouchTypes.Piece:return c.putPieceActions.resetInferencePiece()(e)}}},removeUnsettledItemsInField:function(){return function(e){return(0,a.sequence)(e,[t.fieldEditorActions.fixInferencePiece(),t.fieldEditorActions.resetInferencePiece()])}},ontouchStartField:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.ontouchStartField({index:t})(e);case i.TouchTypes.Piece:return c.putPieceActions.ontouchStartField({index:t})(e);case i.TouchTypes.MovePiece:return l.movePieceActions.ontouchStartField({index:t})(e);case i.TouchTypes.FillRow:return p.fillRowActions.ontouchStartField({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchStartField({index:t})(e)}}},ontouchMoveField:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.ontouchMoveField({index:t})(e);case i.TouchTypes.Piece:return c.putPieceActions.ontouchMoveField({index:t})(e);case i.TouchTypes.MovePiece:return l.movePieceActions.ontouchMoveField({index:t})(e);case i.TouchTypes.FillRow:return p.fillRowActions.ontouchMoveField({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchMoveField({index:t})(e)}}},ontouchEnd:function(){return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.ontouchEnd()(e);case i.TouchTypes.Piece:return c.putPieceActions.ontouchEnd()(e);case i.TouchTypes.MovePiece:return l.movePieceActions.ontouchEnd()(e);case i.TouchTypes.FillRow:return p.fillRowActions.ontouchEnd()(e);case i.TouchTypes.Fill:return u.fillActions.ontouchEnd()(e)}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.ontouchStartSentLine({index:t})(e);case i.TouchTypes.FillRow:return p.fillRowActions.ontouchStartSentLine({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchStartSentLine({index:t})(e)}}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){switch(e.mode.touch){case i.TouchTypes.Drawing:return s.drawBlockActions.ontouchMoveSentLine({index:t})(e);case i.TouchTypes.FillRow:return p.fillRowActions.ontouchMoveSentLine({index:t})(e);case i.TouchTypes.Fill:return u.fillActions.ontouchMoveSentLine({index:t})(e)}}},selectPieceColor:function(e){var t=e.piece;return function(e){return(0,a.sequence)(e,[r.actions.removeUnsettledItems(),function(e){return{mode:o.__assign(o.__assign({},e.mode),{piece:t})}}])}},selectInferencePieceColor:function(){return function(e){return(0,a.sequence)(e,[r.actions.removeUnsettledItems(),function(e){return{mode:o.__assign(o.__assign({},e.mode),{piece:void 0})}}])}},spawnPiece:function(e){var n=e.piece,o=e.guideline;return function(e){if(n===i.Piece.Gray||n===i.Piece.Empty)throw new m.ViewError("Unsupported piece: ".concat(n));var c=e.fumen.pages,s=e.fumen.currentIndex,u=c[s];if(void 0!==u){var l;l=o?{type:n,rotation:i.Rotation.Spawn,coordinate:{x:4,y:20}}:n===i.Piece.I?{type:n,rotation:i.Rotation.Reverse,coordinate:{x:5,y:20}}:n===i.Piece.O?{type:n,rotation:i.Rotation.Reverse,coordinate:{x:5,y:21}}:{type:n,rotation:i.Rotation.Reverse,coordinate:{x:4,y:21}};var f=u.piece;if(void 0!==f&&f.type===l.type&&f.rotation===l.rotation&&f.coordinate.x===l.coordinate.x&&f.coordinate.y===l.coordinate.y)return(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece()]);var g=(0,d.toPrimitivePage)(u);return u.piece=l,(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(s,g,u)}),r.actions.reopenCurrentPage()])}}},clearPiece:function(){return function(e){var n=e.fumen.pages,o=e.fumen.currentIndex,i=n[o];if(void 0!==i){if(void 0===i.piece)return t.fieldEditorActions.resetInferencePiece()(e);var c=(0,d.toPrimitivePage)(i);return i.piece=void 0,(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(o,c,i)}),r.actions.reopenCurrentPage()])}}},rotateToLeft:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=(0,g.testLeftRotation)(s.type,s.rotation),p=l.rotation,m=v(u,s.type,p),h=s.coordinate,y=l.test.map((function(e){return e[0]+=h.x,e[1]+=h.y,e})).find((function(e){return m(e[0],e[1])}));if(void 0!==y){var x=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{rotation:p,coordinate:{x:y[0],y:y[1]}}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,x,c)}),r.actions.reopenCurrentPage()])}}}}},rotateToRight:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=(0,g.testRightRotation)(s.type,s.rotation),p=l.rotation,m=v(u,s.type,p),h=s.coordinate,y=l.test.map((function(e){return e[0]+=h.x,e[1]+=h.y,e})).find((function(e){return m(e[0],e[1])}));if(void 0!==y){var x=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{rotation:p,coordinate:{x:y[0],y:y[1]}}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,x,c)}),r.actions.reopenCurrentPage()])}}}}},moveToLeft:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,s.type,s.rotation),g=s.coordinate;if(l(g.x-1,g.y)){var p=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{coordinate:{x:g.x-1,y:g.y}}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,p,c)}),r.actions.reopenCurrentPage()])}}}}},moveToLeftEnd:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){for(var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,s.type,s.rotation),g=s.coordinate,p=g.x;l(p-1,g.y);)p-=1;if(p!==g.x){var m=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{coordinate:{x:p,y:g.y}}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,m,c)}),r.actions.reopenCurrentPage()])}}}}},moveToRight:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,s.type,s.rotation),g=s.coordinate;if(l(g.x+1,g.y)){var p=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{coordinate:{x:g.x+1,y:g.y}}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,p,c)}),r.actions.reopenCurrentPage()])}}}}},moveToRightEnd:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){for(var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,s.type,s.rotation),g=s.coordinate,p=g.x;l(p+1,g.y);)p+=1;if(p!==g.x){var m=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{coordinate:{x:p,y:g.y}}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,m,c)}),r.actions.reopenCurrentPage()])}}}}},harddrop:function(){return function(e){var n=e.fumen.pages,i=e.fumen.currentIndex,c=n[i];if(void 0!==c){var s=c.piece;if(void 0!==s){for(var u=new f.Pages(n).getField(i,f.PageFieldOperation.Command),l=v(u,s.type,s.rotation),g=s.coordinate.y,p=s.coordinate.y-1;0<=p&&l(s.coordinate.x,p);p-=1)g=p;if(g!==s.coordinate.y){var m=(0,d.toPrimitivePage)(c);return c.piece=o.__assign(o.__assign({},s),{coordinate:o.__assign(o.__assign({},s.coordinate),{y:g})}),(0,a.sequence)(e,[t.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:(0,d.toSinglePageTask)(i,m,c)}),r.actions.reopenCurrentPage()])}}}}}};var v=function(e,t,n){return function(o,r){var a=(0,h.getBlockPositions)(t,n,o,r);return!a.some((function(e){return e[0]<0||10<=e[0]||e[1]<0||24<=e[1]}))&&!a.map(i.toPositionIndex).some((function(t){return e.getAtIndex(t,!0)!==i.Piece.Empty}))}}},1542:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(2995);t.fillActions={ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece&&void 0!==e.mode.piece)return(0,r.sequence)(e,[function(e){return c(e)},i.actions.ontouchMoveField({index:t})])}},ontouchMoveField:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece&&void 0!==e.mode.piece)return(0,r.sequence)(e,[function(e){return s(e,t,!0)}])}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=e.fumen.currentIndex,n=e.fumen.pages[t],o=e.events.updated;return(0,r.sequence)(e,[o&&void 0!==e.events.prevPage?i.actions.registerHistoryTask({task:(0,a.toSinglePageTask)(t,e.events.prevPage,n)}):void 0,u])}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){if(void 0===e.events.piece&&void 0!==e.mode.piece)return(0,r.sequence)(e,[function(){return c(e)},i.actions.ontouchMoveSentLine({index:t})])}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece&&void 0!==e.mode.piece)return s(e,t,!1)}}};var c=function(e){var t=e.fumen.currentIndex,n=e.mode.piece;if(void 0!==n)return(0,r.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{piece:n,prevPage:(0,a.toPrimitivePage)(e.fumen.pages[e.fumen.currentIndex]),updated:!1})}},i.actions.openPage({index:t})])},s=function(e,t,n){var a=e.fumen.pages,c=e.fumen.currentIndex,s=e.events.piece;if(void 0!==s){var u=(n?e.field[t]:e.sentLine[t]).piece;if(u!==s){var d=a[c];d.commands||(d.commands={pre:{}});var l=d.commands,f=n?e.field.concat():e.sentLine.concat(),g=Math.floor(f.length/10),p=function(t){if(f[t]&&f[t].piece===u){delete f[t];var o=t%10,i=Math.floor(t/10),r=n?"block":"sentBlock",a="".concat(r,"-").concat(t);e.cache.currentInitField.getAtIndex(t,n)!==s?l.pre[a]={x:o,y:i,piece:s,type:r}:delete l.pre[a],0<o&&p(t-1),o<9&&p(t+1),0<i&&p(t-10),i<g-1&&p(t+10)}};return p(t),(0,r.sequence)(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a}),events:o.__assign(o.__assign({},e.events),{updated:!0})}},i.actions.openPage({index:c})])}}},u=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1})}}},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillRowActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),c=n(2995);t.fillRowActions={ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece)return(0,a.sequence)(e,[function(e){return s(e)},r.actions.ontouchMoveField({index:t})])}},ontouchMoveField:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece)return(0,a.sequence)(e,[function(e){return u(e,t,!0)},r.actions.reopenCurrentPage()])}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=e.fumen.pages,n=e.fumen.currentIndex,o=t[n],i=e.events.prevPage;return(0,a.sequence)(e,[d,void 0!==i?r.actions.registerHistoryTask({task:(0,c.toSinglePageTask)(n,i,o)}):void 0])}}},ontouchStartSentLine:function(e){var t=e.index;return function(e){if(void 0===e.events.piece)return(0,a.sequence)(e,[function(e){return s(e)},r.actions.ontouchMoveSentLine({index:t})])}},ontouchMoveSentLine:function(e){var t=e.index;return function(e){if(void 0!==e.events.piece)return(0,a.sequence)(e,[function(e){return u(e,t,!1)},r.actions.reopenCurrentPage()])}}};var s=function(e){var t=e.fumen.pages,n=e.fumen.currentIndex;return{events:o.__assign(o.__assign({},e.events),{piece:e.mode.piece?e.mode.piece:i.Piece.Empty,updated:!1,prevPage:(0,c.toPrimitivePage)(t[n])})}},u=function(e,t,n){var c=e.events.piece;if(void 0!==c){var s=e.fumen.currentIndex,u=e.fumen.pages,d=u[s];if(void 0!==d){d.commands||(d.commands={pre:{}});for(var l=t%10,f=Math.floor(t/10),g=0;g<10;g+=1){var p=g+10*f,m=n?"block":"sentBlock",h="".concat(m,"-").concat(p),v=e.cache.currentInitField.getAtIndex(p,!0);l!==g&&v!==c?d.commands.pre[h]={x:g,piece:c,type:m,y:f}:l===g&&v!==i.Piece.Empty?d.commands.pre[h]={x:g,type:m,piece:i.Piece.Empty,y:f}:delete d.commands.pre[h]}return(0,a.sequence)(e,[function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:u})}},r.actions.reopenCurrentPage()])}}},d=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1})}}},2281:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mementoActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(6266);t.mementoActions={registerHistoryTask:function(e){var n=e.task,o=e.mergeKey;return function(e){var r=a.memento.register(n,o);return(0,i.sequence)(e,[t.mementoActions.setHistoryCount({undoCount:r,redoCount:0}),c])}},undo:function(){return function(e){return 0<e.events.inferences.length?(0,i.sequence)(e,[r.actions.clearInferencePiece(),r.actions.openPage({index:e.fumen.currentIndex})]):e.history.undoCount<=0?void 0:(0,i.sequence)(e,[function(e){o.__awaiter(void 0,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return[4,a.memento.undo(e.fumen.pages)];case 1:return void 0!==(t=n.sent())&&r.main.loadPagesViaHistory(t),[2]}}))}))}])}},redo:function(){return function(e){if(!(e.history.redoCount<=0))return(0,i.sequence)(e,[r.actions.fixInferencePiece(),r.actions.clearInferencePiece(),function(e){o.__awaiter(void 0,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return[4,a.memento.redo(e.fumen.pages)];case 1:return void 0!==(t=n.sent())&&r.main.loadPagesViaHistory(t),[2]}}))}))}])}},loadPagesViaHistory:function(e){var t=e.pages,n=e.index,o=e.undoCount,a=e.redoCount;return function(e){return(0,i.sequence)(e,[r.actions.setPages({pages:t,open:!1}),r.actions.openPage({index:n}),r.actions.setHistoryCount({undoCount:o,redoCount:a}),c])}},setHistoryCount:function(e){var t=e.undoCount,n=e.redoCount;return function(){return{history:{undoCount:t,redoCount:n}}}}};var c=function(e){a.memento.save(e.fumen.pages)}},7270:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modalActions=void 0;var o=n(655),i=n(9609);t.modalActions={showOpenErrorMessage:function(e){var t=e.message;return function(e){return(0,i.sequence)(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{errorMessage:t})}}])}},openFumenModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{fumen:!0})}}},openMenuModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{menu:!0})}}},openAppendModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{append:!0})}}},openClipboardModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{clipboard:!0})}}},openUserSettingsModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{userSettings:!0})}}},closeFumenModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{fumen:!1})}}},closeMenuModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{menu:!1})}}},closeAppendModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{append:!1})}}},closeClipboardModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{clipboard:!1})}}},closeUserSettingsModal:function(){return function(e){return{modal:o.__assign(o.__assign({},e.modal),{userSettings:!1})}}},closeAllModals:function(){return function(){return{modal:{append:!1,fumen:!1,menu:!1,clipboard:!1,userSettings:!1}}}}}},2579:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.movePieceActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(9774),c=n(2995),s=n(1983),u=n(8711);t.movePieceActions={ontouchStartField:function(e){var n=e.index;return function(e){if(!e.events.drawing)return(0,r.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{drawing:!0,prevPage:(0,c.toPrimitivePage)(e.fumen.pages[e.fumen.currentIndex]),updated:!1})}},t.movePieceActions.ontouchMoveField({index:n})])}},ontouchMoveField:function(e){var t=e.index;return function(e){if(e.events.drawing){var n=e.fumen.pages,c=e.fumen.currentIndex,d=n[c];if(void 0!==d){var l=d.piece;if(void 0!==l&&(0,a.isMinoPiece)(l.type)){var f=t%10,g=Math.floor(t/10),p=(0,u.getBlockPositions)(l.type,l.rotation,f,g);if(!p.some((function(e){return e[0]<0||10<=e[0]||e[1]<0||24<=e[1]}))){var m=new s.Pages(n).getField(c,s.PageFieldOperation.Command);if(!p.map(a.toPositionIndex).some((function(e){return m.getAtIndex(e,!0)!==a.Piece.Empty})))return d.piece=o.__assign(o.__assign({},l),{coordinate:{x:f,y:g}}),(0,r.sequence)(e,[function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n}),events:o.__assign(o.__assign({},e.events),{updated:!0})}},i.actions.reopenCurrentPage()])}}}}}},ontouchEnd:function(){return function(e){if(e.events.drawing){var t=e.fumen.currentIndex,n=e.fumen.pages[t],a=e.events.updated;return(0,r.sequence)(e,[a&&void 0!==e.events.prevPage?i.actions.registerHistoryTask({task:(0,c.toSinglePageTask)(t,e.events.prevPage,n)}):void 0,function(){return{events:o.__assign(o.__assign({},e.events),{prevPage:void 0,updated:!1,drawing:!1})}}])}}}}},2265:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseToBlocks=t.pageActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(9774),c=n(1983),s=n(2995),u=n(8286),d=n(9782);t.pageActions={reopenCurrentPage:function(){return function(e){return t.pageActions.openPage({index:e.fumen.currentIndex})(e)}},openPage:function(e){var n=e.index;return function(e){var s,u,d,l=new c.Pages(e.fumen.pages),f=l.getComment(n);(0,c.isQuizCommentResult)(f)?(s=f.quiz,""!==f.quiz&&(u=f.quizAfterOperation.getNextPieces(5).filter((function(e){return e!==a.Piece.Empty})),d=f.quizAfterOperation.getHoldPiece())):(s=f.text,u=f.next,d=void 0);var g=l.getField(n,c.PageFieldOperation.None),p=e.fumen.pages[n],m=(0,t.parseToBlocks)(g,p.piece,p.commands),h=void 0===e.fumen.pages[0]||e.fumen.pages[0].flags.colorize;return(0,r.sequence)(e,[e.play.status===a.AnimationState.Play?i.actions.startAnimation():void 0,e.fumen.currentIndex!==n?i.actions.fixInferencePiece():void 0,e.fumen.currentIndex!==n?i.actions.clearInferencePiece():void 0,e.fumen.currentIndex!==n?i.actions.commitCommentText():void 0,i.actions.setComment({comment:s}),i.actions.setField({field:m.playField,move:p.piece,filledHighlight:p.flags.lock,inferences:e.events.inferences,ghost:e.mode.ghostVisible,allowSplit:e.mode.touch===a.TouchTypes.Drawing}),i.actions.setFieldColor({guideLineColor:h}),i.actions.setSentLine({sentLine:m.sentLine}),i.actions.setHold({hold:d}),i.actions.setNext({next:u}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{currentIndex:n}),cache:o.__assign(o.__assign({},e.cache),{currentInitField:g})}}])}},openPageWhenChange:function(e){var n=e.index;return function(e){if(e.fumen.currentIndex!==n)return t.pageActions.openPage({index:n})(e)}},insertPage:function(e){var n=e.index;return function(e){var o=e.fumen.pages[n-1];return(void 0!==o&&void 0===o.field.obj?t.pageActions.insertRefPage:t.pageActions.insertKeyPage)({index:n})(e)}},insertRefPage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return(0,r.sequence)(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),l({index:t}),i.actions.reopenCurrentPage()])}},insertKeyPage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return(0,r.sequence)(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),f({index:t}),i.actions.reopenCurrentPage()])}},insertNewPage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return(0,r.sequence)(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),g({index:t}),i.actions.reopenCurrentPage()])}},duplicatePage:function(e){var t=e.index;return function(e){if(!(e.fumen.pages.length<t))return(0,r.sequence)(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),p({index:t}),i.actions.reopenCurrentPage()])}},removePage:function(e){var t=e.index;return function(e){return(0,r.sequence)(e,[i.actions.removeUnsettledItems(),i.actions.commitCommentText(),m({index:t}),i.actions.reopenCurrentPage()])}},removeUnsettledItems:function(){return function(e){return i.actions.removeUnsettledItemsInField()(e)}},backLoopPage:function(){return function(e){var n=(e.fumen.currentIndex-1+e.fumen.maxPage)%e.fumen.maxPage;return t.pageActions.openPage({index:n})(e)}},nextLoopPage:function(){return function(e){var n=(e.fumen.currentIndex+1)%e.fumen.maxPage;return t.pageActions.openPage({index:n})(e)}},backPage:function(e){var n=e.loop;return function(e){var o=e.fumen.currentIndex-1;return o<0?n?(0,r.sequence)(e,[i.actions.lastPage()]):void 0:(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),t.pageActions.openPage({index:o})])}},nextPage:function(e){var n=e.loop;return function(e){var o=e.fumen,a=o.currentIndex+1;return o.maxPage<=a?n?(0,r.sequence)(e,[i.actions.firstPage()]):void 0:(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),t.pageActions.openPage({index:a})])}},nextPageOrNewPage:function(){return function(e){var n=e.fumen,o=n.currentIndex+1;return n.maxPage<=o?(0,r.sequence)(e,[t.pageActions.insertPage({index:o}),t.pageActions.openPage({index:o})]):(0,r.sequence)(e,[i.actions.nextPage({loop:!1})])}},firstPage:function(){return function(e){return(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),t.pageActions.openPage({index:0})])}},lastPage:function(){return function(e){return(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),t.pageActions.openPage({index:e.fumen.pages.length-1})])}},changeToRef:function(e){var n=e.index;return function(e){if(!(n<=0)){var a=(0,s.toRefPageTask)(n);return(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.registerHistoryTask({task:a}),function(e){var t=new c.Pages(e.fumen.pages);return t.toRefPage(n),{fumen:o.__assign(o.__assign({},e.fumen),{pages:t.pages})}},function(e){return t.pageActions.openPage({index:e.fumen.currentIndex})(e)}])}}},changeToKey:function(e){var n=e.index;return function(e){if(!(n<=0)){var a=(0,s.toKeyPageTask)(n);return(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.registerHistoryTask({task:a}),function(e){var t=new c.Pages(e.fumen.pages);return t.toKeyPage(n),{fumen:o.__assign(o.__assign({},e.fumen),{pages:t.pages})}},function(e){return t.pageActions.openPage({index:e.fumen.currentIndex})(e)}])}}},changeLockFlag:function(e){var t=e.index,n=e.enable;return function(e){var a=e.fumen.pages;if(!(t<0||a.length<=t)){var c=a[t],u=(0,s.toPrimitivePage)(c);c.flags.lock=n;var d=(0,s.toSinglePageTask)(t,u,c);return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:d}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a})}},i.actions.reopenCurrentPage()])}}},changeRiseFlag:function(e){var t=e.index,n=e.enable;return function(e){var a=e.fumen.pages;if(!(t<0||a.length<=t)){var c=a[t],u=(0,s.toPrimitivePage)(c);c.flags.rise=n;var d=(0,s.toSinglePageTask)(t,u,c);return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:d}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a})}}])}}},changeMirrorFlag:function(e){var t=e.index,n=e.enable;return function(e){var a=e.fumen.pages;if(!(t<0||a.length<=t)){var c=a[t],u=(0,s.toPrimitivePage)(c);c.flags.mirror=n;var d=(0,s.toSinglePageTask)(t,u,c);return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:d}),function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a})}}])}}},clearToEnd:function(){return function(e){return(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),h({pageIndex:e.fumen.currentIndex}),i.actions.reopenCurrentPage()])}},clearPast:function(){return function(e){return(0,r.sequence)(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),i.actions.commitCommentText(),v({pageIndex:e.fumen.currentIndex}),i.actions.reopenCurrentPage()])}}},t.parseToBlocks=function(e,t,n){var o=function(e){return{piece:e}},i=e.toPlayFieldPieces().map(o),r=e.toSentLintPieces().map(o);return void 0!==n&&Object.keys(n.pre).map((function(e){return n.pre[e]})).forEach((function(e){switch(e.type){case"block":var t=e.x,n=e.y,o=e.piece;return void(i[t+10*n]={piece:o});case"sentBlock":return t=e.x,n=e.y,o=e.piece,void(r[t+10*n]={piece:o})}})),{playField:i,sentLine:r}};var l=function(e){var t=e.index;return function(e){var n=new c.Pages(e.fumen.pages);n.insertRefPage(t);var a=n.pages,u=(0,s.toInsertPageTask)(t,[(0,s.toPrimitivePage)(a[t])],e.fumen.currentIndex);return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:u}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a,maxPage:a.length})}}])}},f=function(e){var t=e.index;return function(e){var n=new c.Pages(e.fumen.pages);n.insertKeyPage(t);var a=n.pages,u=(0,s.toInsertPageTask)(t,[(0,s.toPrimitivePage)(a[t])],e.fumen.currentIndex);return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:u}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a,maxPage:a.length})}}])}},g=function(e){var t=e.index;return function(e){var n=e.fumen.pages,a=[],u=n[t];if(void 0!==u&&void 0!==u.field.ref){(f=new c.Pages(n)).toKeyPage(t),n=f.pages;var l=(0,s.toKeyPageTask)(t);a.push(l)}void 0!==u&&void 0!==u.comment.ref&&((f=new c.Pages(n)).freezeComment(t),n=f.pages,l=(0,s.toFreezeCommentTask)(t),a.push(l)),(f=new c.Pages(n)).insertKeyPage(t),n=f.pages,l=(0,s.toInsertPageTask)(t,[(0,s.toPrimitivePage)(n[t])],e.fumen.currentIndex),a.push(l);var f,g=n[t];void 0!==g&&void 0===g.comment.text&&((f=new c.Pages(n)).freezeComment(t),n=f.pages,l=(0,s.toFreezeCommentTask)(t),a.push(l));var p=(0,s.toPrimitivePage)(g);return void 0!==g.field.obj&&(g.field.obj=new d.Field({})),void 0!==g.comment.text&&(g.comment.text=""),l=(0,s.toSinglePageTask)(t,p,g),a.push(l),(0,r.sequence)(e,[i.actions.registerHistoryTask({task:(0,s.toPageTaskStack)(a,e.fumen.currentIndex)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:n,maxPage:n.length,currentIndex:t})}}])}},p=function(e){var t=e.index;return function(e){var n=new c.Pages(e.fumen.pages);n.duplicatePage(t);var a=n.pages,u=(0,s.toInsertPageTask)(t,[(0,s.toPrimitivePage)(a[t])],e.fumen.currentIndex);return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:u}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:a,maxPage:a.length})}}])}},m=function(e){var t=e.index;return function(e){var n=e.fumen.pages;if(t<0)throw new u.FumenError("Illegal index: ".concat(t));if(!(n.length<=1)){var a=n[t],d=t+1,l=n[d],f=new c.Pages(n),g=[];if(void 0!==l&&(void 0===l.field.obj&&(f.toKeyPage(d),g.push((0,s.toKeyPageTask)(d))),void 0!==l.comment.ref&&(f.freezeComment(d),g.push((0,s.toFreezeCommentTask)(d))),0===t&&a.flags.colorize!==l.flags.colorize)){var p=(0,s.toPrimitivePage)(l);l.flags.colorize=a.flags.colorize,g.push((0,s.toSinglePageTask)(d,p,l))}var m=(0,s.toPrimitivePage)(a);f.deletePage(t,t+1),g.push((0,s.toRemovePageTask)(t,t+1,[m],t));var h=f.pages,v=t<h.length?t:h.length-1;return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:(0,s.toPageTaskStack)(g,t)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:h,maxPage:h.length,currentIndex:v})}}])}}},h=function(e){var t=e.pageIndex;return function(e){var n=e.fumen.pages;if(t<0)throw new u.FumenError("Illegal index: ".concat(t));var a=t+1;if(!(n.length<=1||n.length<=a)){var d=new c.Pages(n),l=n.slice(a).map(s.toPrimitivePage);d.deletePage(a,n.length);var f=(0,s.toRemovePageTask)(a,n.length,l,t),g=d.pages,p=t<g.length?t:g.length-1;return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:f}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:g,maxPage:g.length,currentIndex:p})}}])}}},v=function(e){var t=e.pageIndex;return function(e){var n=e.fumen.pages;if(t<0)throw new u.FumenError("Illegal index: ".concat(t));if(!(n.length<=1||0===t)){var a=n[0];if(void 0!==a){var d=n[t],l=new c.Pages(n),f=[];if(void 0!==d&&(void 0===d.field.obj&&(l.toKeyPage(t),f.push((0,s.toKeyPageTask)(t))),void 0!==d.comment.ref&&(l.freezeComment(t),f.push((0,s.toFreezeCommentTask)(t))),a.flags.colorize!==d.flags.colorize)){var g=(0,s.toPrimitivePage)(d);d.flags.colorize=a.flags.colorize,f.push((0,s.toSinglePageTask)(t,g,d))}var p=n.slice(0,t).map(s.toPrimitivePage);l.deletePage(0,t),f.push((0,s.toRemovePageTask)(0,t,p,0));var m=l.pages;return(0,r.sequence)(e,[i.actions.registerHistoryTask({task:(0,s.toPageTaskStack)(f,t)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:m,maxPage:m.length,currentIndex:0})}},i.actions.reopenCurrentPage()])}}}}},6312:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.putPieceActions=void 0;var o=n(655),i=n(9774),r=n(5917),a=n(9609),c=n(2995),s=n(6886),u=n(3876),d=n(6266),l=n(2742),f=n(8711);t.putPieceActions={fixInferencePiece:function(){return function(e){var t=p(e);if(void 0!==t){var n=t.task;return g(t.pages,n)(e)}}},clearInferencePiece:function(){return function(e){return(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:[]}),cache:o.__assign(o.__assign({},e.cache),{taskKey:void 0})}}])}},resetInferencePiece:function(){return function(e){return(0,a.sequence)(e,[s.fieldEditorActions.clearInferencePiece(),r.actions.openPage({index:e.fumen.currentIndex})])}},ontouchStartField:function(e){var t=e.index;return function(e){if(void 0===e.events.piece){var n=m(e,t);if(void 0!==n)return(0,a.sequence)(e,[function(){return n},r.actions.ontouchMoveField({index:t})]);var i=e.fumen.currentIndex+1;return(0,a.sequence)(e,[r.actions.insertPage({index:i}),r.actions.openPage({index:i}),function(e){return{cache:o.__assign(o.__assign({},e.cache),{taskKey:d.memento.lastKey()})}},function(e){return m(e,t)},r.actions.ontouchMoveField({index:t})])}}},ontouchMoveField:function(e){var t=e.index;return function(e){var n=e.events.piece;if(void 0!==n){var c=e.fumen.pages[e.fumen.currentIndex];if(void 0!==c&&void 0===c.piece){var s=e.events.inferences;if(n!==i.Piece.Empty){if(4<=s.length)return;if(e.field[t].piece!==i.Piece.Empty&&e.field[t].highlight!==l.HighlightType.Lighter)return;if(void 0===s.find((function(e){return e===t}))){var u=e.events.inferences.concat([t]);return(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:u,updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})])}}return n===i.Piece.Empty?(0,a.sequence)(e,[function(){return{events:o.__assign(o.__assign({},e.events),{inferences:e.events.inferences.filter((function(e){return e!==t})),updated:!0})}},r.actions.openPage({index:e.fumen.currentIndex})]):void 0}}}},ontouchEnd:function(){return function(e){if(void 0!==e.events.piece){var t=p(e);return(0,a.sequence)(e,[void 0!==t?g(t.pages,t.task,e.cache.taskKey):void 0,h])}}}};var g=function(e,t,n){return function(i){return(0,a.sequence)(i,[function(t){return{fumen:o.__assign(o.__assign({},t.fumen),{pages:e}),cache:o.__assign(o.__assign({},t.cache),{taskKey:void 0})}},s.fieldEditorActions.resetInferencePiece(),r.actions.registerHistoryTask({task:t,mergeKey:n})])}},p=function(e){var t=e.events.inferences;if(!(t.length<4)){var n=(0,u.inferPiece)(t);if(n&&n.coordinate){var o=e.fumen.currentIndex,i=e.fumen.pages,r=i[o],a=(0,c.toPrimitivePage)(r);return r.piece={type:n.piece,rotation:n.rotate,coordinate:n.coordinate},{pages:i,task:(0,c.toSinglePageTask)(o,a,r)}}}},m=function(e,t){var n,r=e.fumen.pages,a=r[e.fumen.currentIndex],c=a.piece,s=void 0!==(n=void 0===c?e.events.inferences:(0,f.getBlockPositions)(c.type,c.rotation,c.coordinate.x,c.coordinate.y).map(i.toPositionIndex)).find((function(e){return e===t}));if(void 0===c||s)return a.piece=void 0,{fumen:o.__assign(o.__assign({},e.fumen),{pages:r}),events:o.__assign(o.__assign({},e.events),{inferences:n,piece:s?i.Piece.Empty:i.Piece.Gray,updated:!1})}},h=function(e){return{events:o.__assign(o.__assign({},e.events),{piece:void 0,prevPage:void 0,updated:!1}),cache:o.__assign({},e.cache)}}},5597:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modeActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(9774),c=n(6314),s=n(8456),u=n(9164);t.modeActions={changeToReaderScreen:function(){return function(e){return c.resources.konva.stage.reload((function(e){r.main.changeScreen({screen:a.Screens.Reader}),e()})),(0,i.sequence)(e,[r.actions.fixInferencePiece(),r.actions.resetInferencePiece()])}},changeToDrawerScreen:function(e){var t=e.refresh;return function(e){return c.resources.konva.stage.reload((function(e){r.main.changeScreen({screen:a.Screens.Editor}),e()})),(0,i.sequence)(e,[s.animationActions.pauseAnimation(),t?r.actions.changeToDrawingToolMode():void 0])}},changeToDrawingMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.Drawing}),l({type:a.ModeTypes.Drawing})])}},changeToDrawingToolMode:function(){return function(e){return(0,i.sequence)(e,[l({type:a.ModeTypes.DrawingTool})])}},changeToFlagsMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.Drawing}),l({type:a.ModeTypes.Flags})])}},changeToUtilsMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.Drawing}),l({type:a.ModeTypes.Utils})])}},changeToShiftMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.Drawing,clear:!0}),l({type:a.ModeTypes.Slide})])}},changeToFillRowMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.FillRow}),l({type:a.ModeTypes.FillRow}),function(e){return{mode:o.__assign(o.__assign({},e.mode),{piece:void 0!==e.mode.piece?e.mode.piece:a.Piece.Gray})}}])}},changeToPieceMode:function(){return function(e){return(0,i.sequence)(e,[l({type:a.ModeTypes.Piece})])}},changeToFillMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.Fill}),l({type:a.ModeTypes.Fill})])}},changeToCommentMode:function(){return function(e){return(0,i.sequence)(e,[l({type:a.ModeTypes.Comment})])}},changeToDrawPieceMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.Piece}),l({type:a.ModeTypes.Piece})])}},changeToMovePieceMode:function(){return function(e){return(0,i.sequence)(e,[d({type:a.TouchTypes.MovePiece}),l({type:a.ModeTypes.Piece})])}},changeToSelectPieceMode:function(){return function(e){return(0,i.sequence)(e,[l({type:a.ModeTypes.SelectPiece})])}},changeScreen:function(e){var t=e.screen;return function(e){return{mode:o.__assign(o.__assign({},e.mode),{screen:t})}}},changeCommentMode:function(e){var t=e.type;return function(e){return{mode:o.__assign(o.__assign({},e.mode),{comment:t})}}},changeGhostVisible:function(e){var t=e.visible;return function(e){if(e.mode.ghostVisible!==t)return(0,i.sequence)(e,[function(e){return{mode:o.__assign(o.__assign({},e.mode),{ghostVisible:t})}}])}},changeLoop:function(e){var t=e.enable;return function(e){if(e.mode.loop!==t)return(0,i.sequence)(e,[function(e){return{mode:o.__assign(o.__assign({},e.mode),{loop:t})}}])}},changeGradient:function(e){var t=e.gradientStr;return function(e){for(var n=t,r={},c=0,s=u.gradientPieces;c<s.length;c++){var d=s[c];r[d]=(0,a.gradientPatternFrom)(n[0]||"0"),n=n.substring(1)}return(0,i.sequence)(e,[function(e){return{mode:o.__assign(o.__assign({},e.mode),{gradient:r})}}])}}};var d=function(e){var t=e.type,n=e.clear,a=void 0!==n&&n;return function(e){return e.mode.touch===t?a?r.actions.removeUnsettledItems()(e):void 0:(0,i.sequence)(e,[r.actions.removeUnsettledItems(),function(){return{mode:o.__assign(o.__assign({},e.mode),{touch:t})}}])}},l=function(e){var t=e.type;return function(e){if(e.mode.type!==t)return{mode:o.__assign(o.__assign({},e.mode),{type:t})}}}},9986:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setterActions=void 0;var o=n(655),i=n(5917),r=n(9774),a=n(2742),c=n(3876),s=n(5187),u=n(8711),d=function(e){return"inference"!==e&&(0,r.isMinoPiece)(e)};t.setterActions={setPages:function(e){var t=e.pages,n=e.open,r=void 0===n||n;return function(e){if(!(t.length<1))return r&&setTimeout((function(){i.main.openPage({index:0})}),0),{fumen:o.__assign(o.__assign({},e.fumen),{pages:t,maxPage:t.length})}}},updateFumenData:function(e){var t=e.value;return function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{value:t,errorMessage:void 0})}}},clearFumenData:function(){return function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{value:void 0,errorMessage:void 0})}}},setComment:function(e){var t=e.comment;return function(e){var n=void 0!==t&&t!==e.comment.text,o=void 0!==t?t:e.comment.text;if(n!==e.comment.isChanged||o!==e.comment.text)return{comment:{isChanged:n,text:o,changeKey:(0,s.generateKey)()}}}},setField:function(e){var t=e.field,n=e.move,i=e.filledHighlight,s=e.inferences,l=e.ghost,f=e.allowSplit;return function(){for(var e=t.concat(),g=0,p=e;g<p.length;g++){var m=p[g];m.markable=d(m.piece)}var h=void 0;if(void 0!==n&&l)for(var v=n.type,y=n.coordinate.y-1;0<=y&&(0,u.getBlockPositions)(v,n.rotation,n.coordinate.x,y).every((function(t){var n=t[0],o=t[1];return(0,r.isInPlayField)(n,o)&&e[n+10*o].piece===r.Piece.Empty}));y-=1)h=y;if(void 0!==n)for(var x=n.type,P=0,b=(0,u.getBlockPositions)(x,n.rotation,n.coordinate.x,n.coordinate.y);P<b.length;P++){var k=b[P],w=k[0],_=k[1];(0,r.isInPlayField)(w,_)&&(e[w+10*_]={piece:x,highlight:a.HighlightType.Highlight2,markable:d(x)})}if(i)for(_=0;_<r.FieldConstants.Height+r.FieldConstants.SentLine;_+=1){var C=[_*r.FieldConstants.Width,(_+1)*r.FieldConstants.Width],T=C[0],S=C[1];if(e.slice(T,S).every((function(e){return e.piece!==r.Piece.Empty})))for(var M=T;M<S;M+=1)if(void 0!==(R=e[M])){var z=R.highlight;e[M].highlight=void 0!==z&&a.HighlightType.Highlight1<z?z:a.HighlightType.Highlight1}else e[M]=o.__assign({},t[M])}if(void 0!==n&&void 0!==h)for(var F=n.type,I=0,L=(0,u.getBlockPositions)(F,n.rotation,n.coordinate.x,h);I<L.length;I++){var R,O=L[I];w=O[0],_=O[1],void 0!==(R=e[w+10*_])&&R.piece!==r.Piece.Empty||(e[w+10*_]={piece:F,highlight:a.HighlightType.Lighter})}var B=void 0,E=(0,c.inferPiece)(s);if(E&&(E.coordinate||!E.coordinate&&f)&&(B=E.piece),B)for(var A=0,q=s;A<q.length;A++){var N=q[A];e[N]=o.__assign(o.__assign({},t[N]),{piece:B,highlight:a.HighlightType.Highlight2,markable:d(B)})}else for(var H=0,j=s;H<j.length;H++)N=j[H],e[N]=o.__assign(o.__assign({},t[N]),{piece:"inference",highlight:a.HighlightType.Highlight2});return{field:e}}},setFieldColor:function(e){var t=e.guideLineColor;return function(e){return{fumen:o.__assign(o.__assign({},e.fumen),{guideLineColor:t})}}},setSentLine:function(e){var t=e.sentLine;return function(){return{sentLine:t.map((function(e){return o.__assign(o.__assign({},e),{markable:d(e.piece)})}))}}},setHold:function(e){var t=e.hold;return function(){return{hold:t}}},setNext:function(e){var t=e.next;return function(){return{nexts:t}}}}},9164:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gradientPieces=t.userSettingsActions=void 0;var o=n(655),i=n(5917),r=n(9609),a=n(6266),c=n(9774);t.userSettingsActions={copyUserSettingsToTemporary:function(){return function(e){return{temporary:o.__assign(o.__assign({},e.temporary),{userSettings:{ghostVisible:e.mode.ghostVisible,loop:e.mode.loop,gradient:u(e.mode.gradient)}})}}},commitUserSettings:function(){return function(e){return(0,r.sequence)(e,[i.actions.changeGhostVisible({visible:e.temporary.userSettings.ghostVisible}),i.actions.changeLoop({enable:e.temporary.userSettings.loop}),i.actions.changeGradient({gradientStr:e.temporary.userSettings.gradient}),s,i.actions.reopenCurrentPage()])}},keepGhostVisible:function(e){var t=e.visible;return function(e){if(e.modal.userSettings)return{temporary:o.__assign(o.__assign({},e.temporary),{userSettings:o.__assign(o.__assign({},e.temporary.userSettings),{ghostVisible:t})})}}},keepLoop:function(e){var t=e.enable;return function(e){if(e.modal.userSettings)return{temporary:o.__assign(o.__assign({},e.temporary),{userSettings:o.__assign(o.__assign({},e.temporary.userSettings),{loop:t})})}}},keepGradient:function(e){var t=e.gradient;return function(e){if(e.modal.userSettings)return{temporary:o.__assign(o.__assign({},e.temporary),{userSettings:o.__assign(o.__assign({},e.temporary.userSettings),{gradient:t})})}}}};var s=function(e){a.localStorageWrapper.saveUserSettings({ghostVisible:e.mode.ghostVisible,loop:e.mode.loop,gradient:u(e.mode.gradient)})};t.gradientPieces=[c.Piece.I,c.Piece.L,c.Piece.O,c.Piece.Z,c.Piece.T,c.Piece.J,c.Piece.S];var u=function(e){for(var n="",o=0,i=t.gradientPieces;o<i.length;o++)n+=e[i[o]]||"0";return n}},9632:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utilsActions=void 0;var o=n(655),i=n(9609),r=n(5917),a=n(2315),c=n(4257),s=n(8286),u=n(2995),d=n(1983);t.utilsActions={resize:function(e){var t=e.width,n=e.height;return function(e){return{display:o.__assign(o.__assign({},e.display),{width:t,height:n})}}},commitOpenFumenData:function(){return function(e){var t=e.fumen.value;if(t)return f(t,!1)}},loadFumen:function(e){var t=e.fumen,n=e.purgeOnFailed,o=void 0!==n&&n;return function(){return f(t,o)}},loadNewFumen:function(){return function(e){return t.utilsActions.loadFumen({fumen:"v115@vhAAgH"})(e)}},loadPages:function(e){var t=e.pages,n=e.loadedFumen;return function(e){var o=e.fumen.pages.map(u.toPrimitivePage),a=e.fumen.currentIndex;return(0,i.sequence)(e,[r.actions.setPages({pages:t}),r.actions.registerHistoryTask({task:(0,u.toFumenTask)(o,n,a)})])}},commitAppendFumenData:function(e){var t=e.position;return function(e){var n=e.fumen.value;if(n)switch(t){case"end":return g(n,e.fumen.maxPage);case"next":return g(n,e.fumen.currentIndex+1);default:return}}},appendPages:function(e){var t=e.pages,n=e.pageIndex;return function(e){return(0,i.sequence)(e,[l({pageIndex:n,appendedPages:t,indexAfterReverting:e.fumen.currentIndex})])}},refresh:function(){return function(){return{}}},openInPC:function(){return function(e){return(0,i.sequence)(e,[r.actions.removeUnsettledItemsInField(),function(e){o.__awaiter(void 0,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return[4,(0,a.encode)(e.fumen.pages)];case 1:return t=n.sent(),[2,"v115@".concat(t)]}}))})).then((function(e){var t=c.i18n.Navigator.ExternalFumenURL(e);window.open(t,"_blank")})).catch((function(e){M.toast({html:"Failed to open in PC: ".concat(e),classes:"top-toast",displayLength:1500})}))}])}},ontapCanvas:function(e){return function(t){var n=e.currentTarget.getStage();return(n.getPointerPosition().x/n.getSize().width<.5?r.actions.backPage({loop:t.mode.loop}):r.actions.nextPage({loop:t.mode.loop}))(t)}}};var l=function(e){var t=e.pageIndex,n=e.appendedPages,a=e.indexAfterReverting;return function(e){var c=e.fumen.pages;if(t<0)throw new s.FumenError("Illegal index: ".concat(t));var l=c[t],f=new d.Pages(c),g=[];if(void 0!==l){void 0===l.field.obj&&(f.toKeyPage(t),g.push((0,u.toKeyPageTask)(t))),void 0!==l.comment.ref&&(f.freezeComment(t),g.push((0,u.toFreezeCommentTask)(t)));var p=c[0];if(void 0===p||p.flags.colorize!==l.flags.colorize){var m=(0,u.toPrimitivePage)(l);l.flags.colorize=void 0===p||p.flags.colorize,g.push((0,u.toSinglePageTask)(t,m,l))}}var h=n.map(u.toPrimitivePage);f.insertPage(t,n),g.push((0,u.toInsertPageTask)(t,h,a));var v=f.pages;return(0,i.sequence)(e,[r.actions.registerHistoryTask({task:(0,u.toPageTaskStack)(g,a)}),function(){return{fumen:o.__assign(o.__assign({},e.fumen),{pages:v,maxPage:v.length,currentIndex:t})}},r.actions.reopenCurrentPage()])}},f=function(e,t){r.main.pauseAnimation(),void 0!==e?o.__awaiter(void 0,void 0,void 0,(function(){var n,i;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,(0,a.decode)(e)];case 1:return n=o.sent(),[3,3];case 2:return i=o.sent(),console.error(i),t?r.main.loadNewFumen():i instanceof s.FumenError?r.main.showOpenErrorMessage({message:c.i18n.OpenFumen.Errors.FailedToLoad()}):r.main.showOpenErrorMessage({message:c.i18n.OpenFumen.Errors.Unexpected(i.message)}),[2];case 3:try{r.main.loadPages({pages:n,loadedFumen:e}),r.main.closeAllModals(),r.main.clearFumenData()}catch(e){console.error(e),t?r.main.loadNewFumen():r.main.showOpenErrorMessage({message:c.i18n.OpenFumen.Errors.Unexpected(e.message)})}return[2]}}))})):r.main.showOpenErrorMessage({message:""})},g=function(e,t){r.main.pauseAnimation(),void 0!==e?o.__awaiter(void 0,void 0,void 0,(function(){var n,i;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,(0,a.decode)(e)];case 1:return n=o.sent(),[3,3];case 2:return i=o.sent(),console.error(i),i instanceof s.FumenError?r.main.showOpenErrorMessage({message:c.i18n.AppendFumen.Errors.FailedToLoad()}):r.main.showOpenErrorMessage({message:c.i18n.AppendFumen.Errors.Unexpected(i.message)}),[2];case 3:try{r.main.appendPages({pages:n,pageIndex:t}),r.main.closeAllModals(),r.main.clearFumenData()}catch(e){console.error(e),r.main.showOpenErrorMessage({message:c.i18n.AppendFumen.Errors.Unexpected(e.message)})}return[2]}}))})):r.main.showOpenErrorMessage({message:""})}},4272:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SizedIcon=t.BlockIcon=t.Icon=void 0;var o=n(4055),i=n(6540);t.Icon=function(e,t){var n=e.key,r=e.classNames,a=void 0===r?[]:r,c=e.iconSize,s=["notranslate","material-icons"].concat(a).join(" ");return(0,i.h)("i",{key:n,class:s,style:(0,o.style)({fontSize:(0,o.px)(c)})},t)},t.BlockIcon=function(e,t){var n=e.key,r=e.classNames,a=void 0===r?[]:r,c=e.iconSize,s=["notranslate","material-icons"].concat(a).join(" ");return(0,i.h)("i",{key:n,class:s,style:(0,o.style)({display:"block",fontSize:(0,o.px)(c),margin:(0,o.px)(0)})},t)},t.SizedIcon=function(e,t){var n=e.height,r=e.fontSize,a=e.colors,c=e.enable,s=c?a.darkCode:a.baseCode,u=(0,o.style)({display:"block",fontSize:(0,o.px)(r),height:(0,o.px)(n),lineHeight:(0,o.px)(n),width:"100%",border:"solid 1px ".concat(s),boxSizing:"border-box",textAlign:"center",cursor:"pointer",color:"#fff"}),d=["notranslate","material-icons","darken-".concat(c?3:1),a.baseClass].join(" ");return(0,i.h)("i",{className:d,style:u},c?t:"")}},3149:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Box=void 0;var o=n(655),i=n(6540),r=n(9774),a=n(8711);t.Box=function(e){var t=e.key,n=e.size,s=e.topLeft,u=e.piece,d=e.rects,l=e.mark,f=[];if(void 0!==u){var g=u.size,p={width:g,height:g,half:!1},m=l&&l.type!==r.GradientPattern.None?l:void 0;f=function(e,t,n,o,i){for(var r=(0,a.getPieces)(t).map((function(e){return[e[0],-e[1]]})),c={max:{x:0,y:0},min:{x:0,y:0}},s=0,u=r;s<u.length;s++){var d=u[s],l=d[0],f=d[1];c.max.x<l?c.max.x=l:l<c.min.x&&(c.min.x=l),c.max.y<f?c.max.y=f:f<c.min.y&&(c.min.y=f)}var g=(c.max.x-c.min.x+1)/2+c.min.x,p=(c.max.y-c.min.y+1)/2+c.min.y,m=function(e){return e*(o+1)+.5},h=e.x+n.width/2,v=e.y+n.height/2;return r.map((function(e){var t=e[0],n=e[1];return{x:h+m(t-g),y:v+m(n-p)}}))}(s,u.type,n,g).map((function(e,n){var o="".concat(t,"-").concat(n);return(0,i.h)(c,{key:o,dataTest:o,rect:d.pieces[n],size:p,fillColor:u.color,strokeColor:"#333",strokeWidth:0,position:e,mark:m})}))}var h=void 0!==u?u.type:r.Piece.Empty,v=o.__assign(o.__assign({},n),{half:!1});return i.h.apply(void 0,o.__spreadArray(["div",null,(0,i.h)(c,{key:t,dataTest:t,rect:d.background,type:h,size:v,fillColor:"#333",strokeColor:"#666",strokeWidth:1,position:s,mark:void 0})],f,!1))};var c=function(e){var t=e.key,n=e.dataTest,o=e.rect,a=e.fillColor,c=e.position,s=e.size,u=e.strokeWidth,d=e.strokeColor,l=e.type,f=e.mark,g=function(){return o.setSize(s)},p=function(){return o.setAbsolutePosition(c)},m=function(){return o.fill(a)},h=function(){return o.stroke(d)},v=function(){return o.strokeWidth(u)},y=function(){return o.strokeEnabled(0<u)},x=function(){if(f)switch(f.type){case r.GradientPattern.Circle:return void function(e,t){o.fillPriority("radial-gradient");var n=t?0:s.height/2;o.fillRadialGradientStartPoint({y:n,x:s.width/2}),o.fillRadialGradientStartRadius(0),o.fillRadialGradientEndPoint({y:n,x:s.width/2}),o.fillRadialGradientEndRadius(s.width/2),o.fillRadialGradientColorStops([0,e,.4,e,.4+.025,a])}(f.color,s.half);case r.GradientPattern.Line:return void function(e,t){o.fillPriority("linear-gradient");var n=t?-s.height:0;o.fillLinearGradientStartPoint({y:n,x:0}),o.fillLinearGradientEndPoint({x:s.width,y:s.height});o.fillLinearGradientColorStops([0,a,.6,a,.625,e,.6+.075,e,.7,a])}(f.color,s.half);case r.GradientPattern.Triangle:return void function(e,t){o.fillPriority("linear-gradient");var n=t?-s.height:0;o.fillLinearGradientStartPoint({y:n,x:0}),o.fillLinearGradientEndPoint({x:s.width,y:s.height}),o.fillLinearGradientColorStops([0,a,.6,a,.625,e])}(f.color,s.half)}else o.fillPriority("none")};return(0,i.h)("param",{name:"konva",value:t,key:t,datatest:n,type:l,oncreate:function(){g(),p(),m(),x(),y(),h(),v(),o.show()},onupdate:function(e,t){s.width===t.size.width&&s.height===t.size.height||g(),c.x===t.position.x&&c.y===t.position.y||p(),a!==t.color&&m(),d!==t.strokeColor&&h(),u!==t.strokeWidth&&(y(),v()),(f!==t.mark||f&&(f.type!==t.mark.type||f.color!==t.mark.color))&&x()},ondestroy:function(){o.hide()},color:a,position:c,size:s,strokeColor:d,strokeWidth:u,mark:f})}},4264:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.comment=void 0;var o=n(4055),i=n(4361);t.comment=function(e){var t=e.height,n=e.textColor,r=e.backgroundColorClass,a=e.dataTest,c=e.key,s=e.id,u=e.text,d=e.readonly,l=e.placeholder,f=e.currentIndex,g=e.actions,p=(0,o.style)({width:"100%",height:(0,o.px)(t),lineHeight:(0,o.px)(t),fontSize:(0,o.px)(.6*t),boxSizing:"border-box",textAlign:"center",border:"none",color:n});if(d)return(0,i.div)({style:(0,o.style)({width:"100%",height:(0,o.px)(t),whiteSpace:"nowrap"})},[(0,i.input)({id:s,key:c,dataTest:a,placeholder:l,value:u,type:"text",className:r,style:p,readonly:"readonly"})]);var m=function(e){if(null!==e.target){var t=e.target;g.updateCommentText({text:t.value,pageIndex:f})}},h=!0;return(0,i.div)({style:(0,o.style)({width:"100%",height:(0,o.px)(t),whiteSpace:"nowrap"})},[(0,i.input)({id:s,key:c,dataTest:a,placeholder:l,oncreate:function(e){e.value=u},onblur:function(){g.commitCommentText()},onkeydown:function(e){"Enter"===e.key&&(h=e.isComposing)},onkeyup:function(e){e.isComposing||h||"Enter"!==e.key||function(e){null!==e.target&&e.target.blur()}(e)},oninput:m,onfocus:m,type:"text",className:r,style:p})])}},6100:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawingEventCanvas=void 0;var o=n(6540);n(5917),t.DrawingEventCanvas=function(e){var t=e.fieldBlocks,n=e.sentBlocks,i=e.fieldLayer,r=e.actions;return(0,o.h)("param",{key:"drawing-event-canvas",name:"konva",value:"draw-event-box",oncreate:function(){var e={mouseOnField:!1,addBodyEvent:!1};t.forEach((function(e,t){e.on("touchstart mousedown",(function(){r.ontouchStartField({index:t})})),e.on("touchmove mouseenter",(function(){r.ontouchMoveField({index:t})})),e.on("touchend mouseup",(function(){r.ontouchEnd()}))})),n.forEach((function(e,t){e.on("touchstart mousedown",(function(){r.ontouchStartSentLine({index:t})})),e.on("touchmove mouseenter",(function(){r.ontouchMoveSentLine({index:t})})),e.on("touchend mouseup",(function(){r.ontouchEnd()}))})),i.on("touchleave mouseleave",(function(){e.mouseOnField=!1,e.addBodyEvent||(e.addBodyEvent=!0,document.body.addEventListener("mouseup",(function(){e.addBodyEvent=!1,e.mouseOnField||r.ontouchEnd()}),{once:!0}))})),i.on("touchenter mouseenter",(function(){e.mouseOnField=!0}))},ondestroy:function(){t.forEach((function(e){e.off("touchstart mousedown"),e.off("touchmove mouseenter"),e.off("touchend mouseup")})),n.forEach((function(e){e.off("touchstart mousedown"),e.off("touchmove mouseenter"),e.off("touchend mouseup")})),i.off("touchleave mouseleave"),i.off("touchenter touchenter")}})}},5154:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventCanvas=void 0;var o=n(6540);t.EventCanvas=function(e){var t=e.rect,n=e.canvas,i=e.actions,r=function(){return t.setSize(n)};return(0,o.h)("param",{key:"reader-event-canvas",name:"konva",value:"event-box",canvas:n,oncreate:function(){r(),t.show(),t.on("tap click",i.ontapCanvas)},onupdate:function(e,t){n.width===t.canvas.width&&n.height===t.canvas.height||r()},ondestroy:function(){t.off("tap click"),t.hide()}})}},8174:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0;var o=n(655),i=n(6540),r=n(9774),a=n(3891),c=n(6314);t.Field=function(e){var t=e.topLeft,n=e.field,d=e.sentLine,l=e.blockSize,f=e.fieldMarginWidth,g=e.guideLineColor,p=e.getGradientPattern,m=t.y+22.5*(l+1)+1,h=c.resources.konva.fieldBlocks.map((function(e,o){var c=[o%10,Math.floor(o/10)],u=c[0],d=c[1],f=22-d,m=n[u+10*d],h="block-".concat(u,"-").concat(d),v={width:l,height:0!==f?l:l/2,half:0===f},y={x:t.x+u*l+u+1,y:t.y+Math.max(0,f-.5)*l+f+1},x=m.piece===r.Piece.Empty?(0,a.decideBackgroundColor)(d):(0,a.decidePieceColor)(m.piece,m.highlight,g),P=m.markable?p(m.piece):r.GradientPattern.None,b=P!==r.GradientPattern.None?{type:P,color:(0,a.decideMarkPieceColor)(m.piece,g)}:void 0;return(0,i.h)(s,{key:h,dataTest:h,size:v,position:y,color:x,mark:b,rect:e})})),v=c.resources.konva.sentBlocks.map((function(e,n){var o=[n%10,Math.floor(n/10)],c=o[0],u=o[1],h=d[c+10*u],v="sent-block-".concat(c,"-").concat(u),y={width:l,height:l,half:!1},x={x:t.x+c*l+c+1,y:m+f},P=(0,a.decidePieceColor)(h.piece,h.highlight,g),b=h.markable?p(h.piece):r.GradientPattern.None,k=b!==r.GradientPattern.None?{type:b,color:(0,a.decideMarkPieceColor)(h.piece,g)}:void 0;return(0,i.h)(s,{key:v,dataTest:v,size:y,position:x,color:P,mark:k,rect:e})})),y={width:10*(l+1)+1,height:23.5*(l+1)+1+f,half:!1};return i.h.apply(void 0,o.__spreadArray(o.__spreadArray(o.__spreadArray(["div",null,(0,i.h)(s,{key:"field-bg",dataTest:"field-bg",rect:c.resources.konva.background,size:y,position:t,color:"#333",mark:void 0})],h,!1),[(0,i.h)(u,{key:"field-margin",dataTest:"field-margin",line:c.resources.konva.fieldMarginLine,width:f,color:"#d8d8d8",start:{x:t.x,y:m+f/2},end:{x:t.x+y.width,y:m+f/2}})],!1),v,!1))};var s=function(e){var t=e.key,n=e.dataTest,o=e.rect,a=e.color,c=e.position,s=e.size,u=e.mark,d=function(){return o.setSize(s)},l=function(){return o.setAbsolutePosition(c)},f=function(){if(u)switch(u.type){case r.GradientPattern.Circle:return void function(e,t){o.fillPriority("radial-gradient");var n=t?0:s.height/2;o.fillRadialGradientStartPoint({y:n,x:s.width/2}),o.fillRadialGradientStartRadius(0),o.fillRadialGradientEndPoint({y:n,x:s.width/2}),o.fillRadialGradientEndRadius(s.width/2),o.fillRadialGradientColorStops([0,e,.4,e,.4+.025,a])}(u.color,s.half);case r.GradientPattern.Line:return void function(e,t){o.fillPriority("linear-gradient");var n=t?-s.height:0;o.fillLinearGradientStartPoint({y:n,x:0}),o.fillLinearGradientEndPoint({x:s.width,y:s.height});o.fillLinearGradientColorStops([0,a,.6,a,.625,e,.6+.075,e,.7,a])}(u.color,s.half);case r.GradientPattern.Triangle:return void function(e,t){o.fillPriority("linear-gradient");var n=t?-s.height:0;o.fillLinearGradientStartPoint({y:n,x:0}),o.fillLinearGradientEndPoint({x:s.width,y:s.height}),o.fillLinearGradientColorStops([0,a,.6,a,.625,e])}(u.color,s.half)}else o.fillPriority("none")},g=function(){return o.fill(a)};return(0,i.h)("param",{name:"konva",value:t,key:t,datatest:n,oncreate:function(){d(),l(),g(),f(),o.show()},onupdate:function(e,t){s.width===t.size.width&&s.height===t.size.height&&s.half===t.size.half||d(),c.x===t.position.x&&c.y===t.position.y||l(),a!==t.color&&g(),(u!==t.mark||u&&(u.type!==t.mark.type||u.color!==t.mark.color))&&f()},ondestroy:function(){o.hide()},color:a,position:c,size:s,mark:u})},u=function(e){var t=e.key,n=e.dataTest,o=e.line,r=e.color,a=e.width,c=e.start,s=e.end,u=function(){return o.points([c.x,c.y,s.x,s.y])},d=function(){return o.strokeWidth(a)},l=function(){return o.stroke(r)};return(0,i.h)("param",{name:"konva",value:t,key:t,datatest:n,oncreate:function(){u(),d(),l(),o.show()},onupdate:function(e,t){c.x===t.start.x&&c.y===t.start.y&&s.x===t.end.x&&s.y===t.end.y||u(),a!==t.width&&d(),r!==t.color&&l()},ondestroy:function(){o.hide()},color:r,start:c,end:s,width:a})}},4245:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KonvaCanvas=void 0;var o=n(655),i=n(4055),r=n(6314),a=n(6540),c=o.__importDefault(n(4920));t.KonvaCanvas=function(e){var t=e.canvas,n=e.hyperStage,s=e.actions,u=(0,i.style)({width:(0,i.px)(t.width),height:(0,i.px)(t.height)});return(0,a.h)("div",{canvas:t,id:"canvas-container",style:u,oncreate:function(e){var i=new c.default.Stage(o.__assign(o.__assign({},t),{container:e}));i.add(r.resources.konva.layers.background),i.add(r.resources.konva.layers.field),i.add(r.resources.konva.layers.boxes),i.add(r.resources.konva.layers.overlay),n.addStage(i),s.refresh()},onupdate:function(e,o){t.width===o.canvas.width&&t.height===o.canvas.height||n.resize(t)},ondestroy:function(){n.removeStage()}})}},1336:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonIconContent=t.Button=t.AppendFumenModal=void 0;var o=n(4055),i=n(6540),r=n(6314),a=n(4257),c=n(8874),s=n(4272);t.AppendFumenModal=function(e){var n=e.textAreaValue,s=e.errorMessage,u=e.actions,d=function(){r.resources.modals.fumen=void 0},l=function(){var e=document.getElementById("input-fumen");null!==e&&e.focus()};return(0,i.h)("div",{key:"append-fumen-modal-top"},(0,i.h)("div",{key:"mdl-append-fumen",datatest:"mdl-append-fumen",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onOpenEnd:function(){var e=document.getElementById("input-fumen");null!==e&&e.focus()},onCloseStart:function(){u.closeAppendModal(),u.clearFumenData(),d()}});t.open(),r.resources.modals.append=t}},(0,i.h)("div",{key:"modal-content",className:"modal-content"},(0,i.h)("h4",{key:"append-fumen-label",dataTest:"append-fumen-label"},a.i18n.AppendFumen.Title()),(0,i.h)(c.TextArea,{key:"input-fumen",dataTest:"input-fumen",id:"input-fumen",placeholder:a.i18n.AppendFumen.PlaceHolder(),error:void 0===s,text:n,actions:{update:function(e){var t=e.value;u.updateFumenData({value:t})}}}),(0,i.h)("span",{key:"text-message",datatest:"text-message",className:"red-text text-accent-2",style:(0,o.style)({display:void 0!==s?void 0:"none"})},s)),(0,i.h)("div",{key:"modal-footer",className:"modal-footer"},(0,i.h)("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:function(){var e;u.closeAppendModal(),u.clearFumenData(),void 0!==(e=r.resources.modals.fumen)&&e.close(),d()}},a.i18n.AppendFumen.Buttons.Cancel()),(0,i.h)(t.Button,{key:"btn-append-to-next",datatest:"btn-append-to-next",width:85,colorTheme:"red",enable:""!==n&&void 0===s,onclick:function(){return u.commitAppendFumenData({position:"next"}),void l()}},(0,i.h)(t.ButtonIconContent,{iconSize:20,iconName:"library_add"},"next")),(0,i.h)(t.Button,{key:"btn-append-to-end",datatest:"btn-append-to-end",width:85,colorTheme:"red",enable:""!==n&&void 0===s,onclick:function(){return u.commitAppendFumenData({position:"end"}),void l()}},(0,i.h)(t.ButtonIconContent,{iconSize:20,iconName:"library_add"},"end")))))},t.Button=function(e,t){e.href;var n=e.key,r=e.onclick,a=e.datatest,c=e.width,s=e.colorTheme,u=e.enable,d=void 0!==s?"waves-effect waves-light ".concat(s," btn white-text ").concat(u?"":"disabled"):"waves-effect waves-teal btn-flat black-text ".concat(u?"":"disabled");return(0,i.h)("a",{href:"#",key:n,datatest:a,className:d,onclick:r,style:(0,o.style)({margin:"0px 5px",padding:(0,o.px)(5),width:(0,o.px)(c),maxWidth:(0,o.px)(c),textAlign:"center"})},(0,i.h)("div",{style:(0,o.style)({width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"})},t))},t.ButtonIconContent=function(e,t){var n=e.iconSize,r=e.iconName,a=e.textSize,c=void 0===a?13:a;return(0,i.h)("div",{style:(0,o.style)({cursor:"pointer"})},(0,i.h)("span",{style:(0,o.style)({marginRight:(0,o.px)(2)})},(0,i.h)(s.BlockIcon,{key:"icon",iconSize:n,classNames:["left"]},r)),(0,i.h)("span",{style:(0,o.style)({fontSize:(0,o.px)(c)})},t))}},1699:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClipboardIconButton=t.ClipboardButton=t.ClipboardModal=void 0;var o=n(655),i=n(4055),r=n(6540),a=n(6314),c=n(4257),s=n(2315),u=n(8286),d=n(4272);t.ClipboardModal=function(e){var n=e.actions,d=e.pages,l=o.__awaiter(void 0,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return[4,(0,s.encode)(d)];case 1:return e=t.sent(),[2,"v115@".concat(e)]}}))})),f=function(e){return function(){var t=void 0;l.then((function(e){return document.body.setAttribute("datatest","copied-fumen-data"),document.body.setAttribute("data",e),e})).then((function(t){return"".concat(e).concat(t)})).then((function(e){if(!(t=document.createElement("pre")))throw new u.FumenError("no element");var n=t.style;n.position="fixed",n.left="-100%",t.textContent=e,document.body.appendChild(t);var o=document.getSelection();if(null===o)throw new u.FumenError("no selection");if(o.selectAllChildren(t),!document.execCommand("copy"))throw new u.FumenError("command error")})).then((function(){M.toast({html:"Copied to clipboard",classes:"top-toast",displayLength:1e3})})).catch((function(e){M.toast({html:"Failed to copy: ".concat(e),classes:"top-toast",displayLength:1500})})).finally((function(){t&&document.body.removeChild(t)}))}},g=function(e){return function(){l.then((function(t){return"".concat(e).concat(t)})).then((function(e){var t=document.querySelector("form[name=clipboard-form]");if(null==t)throw new Error("Not found form element");var n=t.querySelector("input[name=url]");if(null==n)throw new Error("Not found url element");n.value=e,t.submit()})).catch((function(e){M.toast({html:"Failed to open tinyurl: ".concat(e),classes:"top-toast",displayLength:1500})}))}};return(0,r.h)("div",{key:"clipboard-modal-top"},(0,r.h)("div",{key:"mdl-clipboard",datatest:"mdl-clipboard",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onCloseStart:function(){n.closeClipboardModal()}});t.open(),a.resources.modals.clipboard=t},ondestroy:function(){var e=a.resources.modals.clipboard;void 0!==e&&e.close(),a.resources.modals.clipboard=void 0}},(0,r.h)("div",{key:"modal-content",className:"modal-content"},(0,r.h)("h4",{key:"clipboard-label",dataTest:"clipboard-label"},c.i18n.Clipboard.Title()),(0,r.h)("div",{style:(0,i.style)({margin:"0px auto",padding:"0px",display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"center"})},(0,r.h)("form",{name:"clipboard-form",style:(0,i.style)({margin:"0px"}),action:"https://tinyurl.com/create.php",method:"get",target:"_blank"},(0,r.h)("input",{type:"hidden",name:"url",id:"url",value:"https://knewjade.github.io/fumen-for-mobile/#?d=v115@vhAAgH"}),(0,r.h)("div",null,(0,r.h)(t.ClipboardButton,{key:"btn-knewjade",onclick:f("https://knewjade.github.io/fumen-for-mobile/#?d=")},"THIS SITE"),(0,r.h)(t.ClipboardIconButton,{key:"btn-knewjade-tinyurl",onclick:g("https://knewjade.github.io/fumen-for-mobile/#?d=")},"archive")),(0,r.h)("div",null,(0,r.h)(t.ClipboardButton,{key:"btn-zui-jp",onclick:f("https://fumen.zui.jp/?")},"FUMEN.ZUI.JP"),(0,r.h)(t.ClipboardIconButton,{key:"btn-zui-jp-tinyurl",onclick:g("https://fumen.zui.jp/?")},"archive")),(0,r.h)("div",null,(0,r.h)(t.ClipboardButton,{key:"btn-harddrop",onclick:f("https://harddrop.com/fumen/?")},"HARDDROP"),(0,r.h)(t.ClipboardIconButton,{key:"btn-harddrop-tinyurl",onclick:g("https://harddrop.com/fumen/?")},"archive")),(0,r.h)("div",null,(0,r.h)(t.ClipboardButton,{key:"btn-raw-fumen",colorName:"white black-text",onclick:f("")},"RAW DATA"))))),(0,r.h)("div",{key:"modal-footer",className:"modal-footer"},(0,r.h)("a",{href:"#",key:"btn-clipboard-cancel",datatest:"btn-clipboard-cancel",id:"btn-clipboard-cancel",className:"waves-effect waves-teal btn-flat",onclick:function(){n.closeClipboardModal()}},c.i18n.Clipboard.Buttons.Close()))))},t.ClipboardButton=function(e,t){var n=e.key,o=e.onclick,a=e.colorName,c=void 0===a?"red white-text":a,s=e.padding,u=void 0===s?8:s,d=e.textSize,l=void 0===d?17:d;return(0,r.h)("a",{href:"#",key:n,datatest:n,id:n,fontSize:(0,i.px)(l),style:(0,i.style)({minWidth:(0,i.px)(165),margin:(0,i.px)(5),paddingLeft:(0,i.px)(u),paddingRight:(0,i.px)(u)}),className:"waves-effect waves-light btn ".concat(c),onclick:function(e){o(),e.stopPropagation(),e.preventDefault()}},t)},t.ClipboardIconButton=function(e,t){var n=e.key,o=e.onclick,a=e.padding,c=void 0===a?10:a,s=e.textSize,u=void 0===s?20:s,l=(0,i.style)({margin:(0,i.px)(5),paddingLeft:(0,i.px)(c),paddingRight:(0,i.px)(c),cursor:"pointer"});return(0,r.h)("a",{href:"#",key:n,datatest:n,id:n,fontSize:(0,i.px)(u),style:l,className:"waves-effect waves-light btn white black-text",onclick:function(e){o(),e.stopPropagation(),e.preventDefault()}},(0,r.h)(d.BlockIcon,{key:"icon",iconSize:u},t))}},5874:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingButton=t.MenuModal=void 0;var o=n(655),i=n(4055),r=n(6540),a=n(6314),c=n(9774),s=n(4257),u=n(4272),d=n(3288),l=n(6453),f=n(7559);t.MenuModal=function(e){var n=e.version,u=e.screen,g=e.currentIndex,p=e.maxPageIndex,m=e.comment,h=e.display,v=e.platform,y=e.actions,x=(0,i.style)({margin:0,padding:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"start",alignItems:"center"});return(0,r.h)("div",{key:"menu-modal-top"},(0,r.h)("div",{key:"mdl-open-fumen",datatest:"mdl-open-fumen",className:"modal bottom-sheet",oncreate:function(e){var t=M.Modal.init(e,{onOpenEnd:function(){var e=document.getElementById("textarea-fumen");null!==e&&e.focus()},onCloseStart:function(){y.closeMenuModal()}});t.open(),a.resources.modals.menu=t},ondestroy:function(){var e=a.resources.modals.menu;void 0!==e&&e.close(),a.resources.modals.menu=void 0}},(0,r.h)("div",{key:"modal-content",className:"modal-content"},(0,r.h)("h4",{key:"memu-title"},s.i18n.Menu.Title(),"",(0,r.h)("span",{style:(0,i.style)({color:"#999",fontSize:"50%"})},"[",s.i18n.Menu.Build(n),"]")),(0,r.h)("div",{key:"menu-top",style:x},u===c.Screens.Editor?(0,r.h)(t.SettingButton,{key:"btn-readonly",datatest:"btn-readonly",href:"#",icons:[{name:"visibility",size:31.25}],onclick:function(){y.changeToReaderScreen(),y.closeMenuModal()}},s.i18n.Menu.Buttons.Readonly()):void 0,u===c.Screens.Reader?(0,r.h)(t.SettingButton,{key:"btn-writable",datatest:"btn-writable",href:"#",icons:[{name:"mode_edit",size:31.25}],onclick:function(){y.changeToDrawerScreen({refresh:!0}),y.closeMenuModal()}},s.i18n.Menu.Buttons.Writable()):void 0,(0,r.h)(t.SettingButton,{key:"btn-copy-fumen",datatest:"btn-copy-fumen",href:"#",icons:[{name:"content_copy",size:29.3}],onclick:function(){y.removeUnsettledItems(),y.closeMenuModal(),y.openClipboardModal()}},s.i18n.Menu.Buttons.Clipboard()),(0,r.h)(t.SettingButton,{key:"btn-new-fumen",datatest:"btn-new-fumen",href:"#",icons:[{name:"insert_drive_file",size:32.3}],onclick:function(){y.removeUnsettledItems(),y.loadNewFumen(),y.changeToDrawerScreen({refresh:!0}),y.closeMenuModal()}},s.i18n.Menu.Buttons.New()),u===c.Screens.Reader||u===c.Screens.Editor?(0,r.h)(t.SettingButton,{key:"btn-save-playfield-to-image",href:"#",datatest:"btn-save-playfield-to-image",icons:[{name:"file_download",size:30}],onclick:function(){function e(e){var t=a.resources.konva.stage.toDataURL(e);null!=t?function(e,t){var n=document.createElement("a");if(null==n)throw new Error("Unexpected: Failed to create an a-element");n.download="playfield_fumen.png",n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}(t):M.toast({html:"Failed to download image",classes:"top-toast",displayLength:5e3})}switch(u){case c.Screens.Reader:var t=(0,d.getFieldLayout)(o.__assign(o.__assign({},h),{topLeftY:(0,f.getNavigatorHeight)(v)}));e(o.__assign(o.__assign({},t.topLeft),t.size));break;case c.Screens.Editor:t=(0,l.getFieldLayout)(o.__assign(o.__assign({},h),{topLeftY:(0,f.getNavigatorHeight)(v)})),e(o.__assign(o.__assign({},t.topLeft),t.size))}y.closeMenuModal()}},s.i18n.Menu.Buttons.SavePlayfieldToImage()):void 0,(0,r.h)(t.SettingButton,{key:"btn-open-fumen",datatest:"btn-open-fumen",href:"#",icons:[{name:"open_in_new",size:32.3}],onclick:function(){y.removeUnsettledItems(),y.closeMenuModal(),y.openFumenModal()}},s.i18n.Menu.Buttons.Open()),(0,r.h)(t.SettingButton,{key:"btn-append-fumen",datatest:"btn-append-fumen",href:"#",icons:[{name:"library_add",size:29}],onclick:function(){y.closeMenuModal(),y.openAppendModal()}},s.i18n.Menu.Buttons.Append()),(0,r.h)(t.SettingButton,{key:"btn-first-page",datatest:"btn-first-page",href:"#",icons:[{name:"fast_rewind",size:32.3}],onclick:function(){y.firstPage(),y.closeMenuModal()}},s.i18n.Menu.Buttons.FirstPage()),(0,r.h)(t.SettingButton,{key:"btn-last-page",datatest:"btn-last-page",href:"#",icons:[{name:"fast_forward",size:32.3}],onclick:function(){y.lastPage(),y.closeMenuModal()}},s.i18n.Menu.Buttons.LastPage()),(0,r.h)(t.SettingButton,{key:"btn-clear-past",datatest:"btn-clear-past",href:"#",icons:[{name:"arrow_back",size:18},{name:"clear",size:28}],textSize:12,enable:0<g,onclick:function(){y.clearPast(),y.closeMenuModal()}},s.i18n.Menu.Buttons.ClearPast()),(0,r.h)(t.SettingButton,{key:"btn-clear-to-end",datatest:"btn-clear-to-end",href:"#",icons:[{name:"clear",size:28},{name:"arrow_forward",size:18}],textSize:12,enable:g<p-1,onclick:function(){y.clearToEnd(),y.closeMenuModal()}},s.i18n.Menu.Buttons.ClearToEnd()),(0,r.h)(t.SettingButton,{key:"btn-user-settings",datatest:"btn-user-settings",href:"#",icons:[{name:"build",size:30}],onclick:function(){y.closeMenuModal(),y.openUserSettingsModal()}},s.i18n.Menu.Buttons.UserSettings()),m!==c.CommentType.PageSlider?(0,r.h)(t.SettingButton,{key:"btn-page-slider",href:"#",datatest:"btn-page-slider",icons:[{name:"looks_one",size:30}],onclick:function(){y.changeCommentMode({type:c.CommentType.PageSlider}),y.closeMenuModal()}},s.i18n.Menu.Buttons.PageSlider()):void 0,u===c.Screens.Reader&&m===c.CommentType.PageSlider?(0,r.h)(t.SettingButton,{key:"btn-show-comment",href:"#",datatest:"btn-show-comment",icons:[{name:"text_fields",size:32}],onclick:function(){y.changeCommentMode({type:c.CommentType.Writable}),y.closeMenuModal()}},s.i18n.Menu.Buttons.ShowComment()):void 0,u===c.Screens.Editor&&m!==c.CommentType.Writable?(0,r.h)(t.SettingButton,{key:"btn-comment-writable",href:"#",datatest:"btn-comment-writable",icons:[{name:"text_fields",size:32}],onclick:function(){y.changeCommentMode({type:c.CommentType.Writable}),y.closeMenuModal()}},s.i18n.Menu.Buttons.WritableComment()):void 0,u===c.Screens.Editor&&m!==c.CommentType.Readonly?(0,r.h)(t.SettingButton,{key:"btn-comment-readonly",href:"#",datatest:"btn-comment-readonly",icons:[{name:"lock_outline",size:30}],enable:u===c.Screens.Editor,onclick:u===c.Screens.Editor?function(){y.changeCommentMode({type:c.CommentType.Readonly}),y.closeMenuModal()}:function(){M.toast({html:s.i18n.Menu.Messages.NoAvailableCommentButton(),classes:"top-toast",displayLength:3e3})}},s.i18n.Menu.Buttons.ReadonlyComment()):void 0,(0,r.h)(t.SettingButton,{key:"btn-help",datatest:"btn-help",href:"./help.html",icons:[{name:"help_outline",size:31.25}]},s.i18n.Menu.Buttons.Help()),(0,r.h)("div",{style:(0,i.style)({height:(0,i.px)(10),width:"100%"})})))))},t.SettingButton=function(e,t){var n=e.href,a=void 0===n?"#":n,c=e.key,s=e.onclick,d=e.icons,l=e.datatest,f=e.textSize,g=void 0===f?13:f,p=e.enable,m=void 0===p||p,h=d.map((function(e){return(0,r.h)(u.Icon,{key:"".concat(c,"-icon-").concat(e.name),classNames:m?[]:["disabled"],iconSize:e.size},e.name)}));return(0,r.h)("a",{key:c,href:a,onclick:void 0!==s?function(e){s(e),e.stopPropagation(),e.preventDefault()}:void 0},r.h.apply(void 0,o.__spreadArray(["div",{key:"".concat(c,"-icon"),datatest:l,className:"z-depth-1 ".concat(m?" ":"disabled"),style:(0,i.style)({width:(0,i.px)(50),height:(0,i.px)(40),lineHeight:(0,i.px)(40),display:"flex",alignItems:"center",justifyContent:"center",color:m?"#333":"#bdbdbd",margin:(0,i.px)(5),border:"solid 1px ".concat(m?"#999":"#bdbdbd"),boxSizing:"border-box",cursor:"pointer"})}],h,!1)),(0,r.h)("div",{key:"".concat(c,"-text"),style:(0,i.style)({textAlign:"center",fontSize:(0,i.px)(g),color:m?"#333":"#bdbdbd"})},t))}},6691:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OpenFumenModal=void 0;var o=n(4055),i=n(6540),r=n(6314),a=n(4257),c=n(8874);t.OpenFumenModal=function(e){var t=e.textAreaValue,n=e.errorMessage,s=e.actions,u=function(){r.resources.modals.fumen=void 0},d="waves-effect waves-light btn red".concat(""!==t&&void 0===n?"":" disabled");return(0,i.h)("div",{key:"open-fumen-modal-top"},(0,i.h)("div",{key:"mdl-open-fumen",datatest:"mdl-open-fumen",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onOpenEnd:function(){var e=document.getElementById("input-fumen");null!==e&&e.focus()},onCloseStart:function(){s.closeFumenModal(),s.clearFumenData(),u()}});t.open(),r.resources.modals.fumen=t}},(0,i.h)("div",{key:"modal-content",className:"modal-content"},(0,i.h)("h4",{key:"open-fumen-label",dataTest:"open-fumen-label"},a.i18n.OpenFumen.Title()),(0,i.h)(c.TextArea,{key:"input-fumen",dataTest:"input-fumen",id:"input-fumen",placeholder:a.i18n.OpenFumen.PlaceHolder(),error:void 0===n,text:t,actions:{update:function(e){var t=e.value;s.updateFumenData({value:t})}}}),(0,i.h)("span",{key:"text-message",datatest:"text-message",className:"red-text text-accent-2",style:(0,o.style)({display:void 0!==n?void 0:"none"})},n)),(0,i.h)("div",{key:"modal-footer",className:"modal-footer"},(0,i.h)("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:function(){var e;s.closeFumenModal(),s.clearFumenData(),void 0!==(e=r.resources.modals.fumen)&&e.close(),u()}},a.i18n.OpenFumen.Buttons.Cancel()),(0,i.h)("a",{href:"#",key:"btn-open",datatest:"btn-open",id:"btn-open",className:d,onclick:function(){var e;s.commitOpenFumenData(),null!==(e=document.getElementById("input-fumen"))&&e.focus()}},a.i18n.OpenFumen.Buttons.Open()))))}},8874:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextArea=void 0;var o=n(4055),i=n(4361);t.TextArea=function(e){var t=e.id,n=e.key,r=e.dataTest,a=e.placeholder,c=e.error,s=e.text,u=e.actions,d=(0,o.style)({width:"100%",border:c?void 0:"solid 1px #ff5252"}),l=function(e){if(null!==e.target){var t=e.target;u.update({value:t.value})}},f=!0;return(0,i.textarea)({id:t,key:n,dataTest:r,placeholder:a,oncreate:function(e){e.value=s},onkeydown:function(e){"Enter"===e.key&&(f=e.isComposing)},onkeyup:function(e){e.isComposing||f||"Enter"!==e.key||function(e){null!==e.target&&e.target.blur()}(e)},oninput:l,onfocus:l,rows:3,style:d})}},3175:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserSettingsModal=void 0;var o=n(655),i=n(4055),r=n(6540),a=n(6314),c=n(4257),s=n(4361),u=n(9164),d=n(9774);t.UserSettingsModal=function(e){var t=e.ghostVisible,n=e.loop,l=e.gradient,f=e.actions;return(0,r.h)("div",{key:"user-settings-modal-top"},(0,r.h)("div",{key:"mdl-user-settings",datatest:"mdl-user-settings",className:"modal",oncreate:function(e){var t=M.Modal.init(e,{onCloseStart:function(){f.closeUserSettingsModal()}});f.copyUserSettingsToTemporary(),t.open();var n=document.querySelectorAll("select");M.FormSelect.init(n),a.resources.modals.userSettings=t},ondestroy:function(){var e=a.resources.modals.userSettings;void 0!==e&&e.close(),a.resources.modals.userSettings=void 0}},(0,r.h)("div",{key:"modal-content",className:"modal-content"},(0,r.h)("h4",null,c.i18n.UserSettings.Title()),(0,r.h)("div",{style:(0,i.style)({color:"#666"})},c.i18n.UserSettings.Notice()),(0,r.h)("div",{style:(0,i.style)({color:"#333",marginTop:(0,i.px)(15)})},(0,r.h)("div",{class:"switch"},(0,r.h)("h6",null,c.i18n.UserSettings.Ghost.Title()),(0,r.h)("label",null,c.i18n.UserSettings.Ghost.Off(),(0,r.h)("input",{type:"checkbox",dataTest:"switch-ghost-visible",onupdate:function(e){e.checked!==t&&(e.checked=t)},onchange:function(e){if(e&&e.target){var t=e.target;f.keepGhostVisible({visible:t.checked})}}}),(0,r.h)("span",{class:"lever"}),c.i18n.UserSettings.Ghost.On())),(0,r.h)("div",{class:"switch"},(0,r.h)("h6",null,c.i18n.UserSettings.Loop.Title()),(0,r.h)("label",null,c.i18n.UserSettings.Loop.Off(),(0,r.h)("input",{type:"checkbox",dataTest:"switch-loop",onupdate:function(e){e.checked!==n&&(e.checked=n)},onchange:function(e){if(e&&e.target){var t=e.target;f.keepLoop({enable:t.checked})}}}),(0,r.h)("span",{class:"lever"}),c.i18n.UserSettings.Loop.On())),(0,r.h)("div",null,(0,r.h)("h6",null,c.i18n.UserSettings.Gradient.Title()),u.gradientPieces.map((function(e,t){var n="group".concat(e),a=l[t]||"0",c=[{label:"None",value:"".concat(d.GradientPattern.None)},{label:"",value:"".concat(d.GradientPattern.Circle)},{label:"/",value:"".concat(d.GradientPattern.Line)},{label:"",value:"".concat(d.GradientPattern.Triangle)}].map((function(e){var o=e.label,c=e.value;return(0,r.h)("label",null,(0,r.h)("input",{name:n,type:"radio",checked:c===a,onchange:function(){return function(e,t){var n=l.substring(0,e)+t+l.substring(e+1,l.length);f.keepGradient({gradient:n})}(t,c)}}),(0,r.h)("span",{style:(0,i.style)({marginRight:(0,i.px)(20)})},o))}));return(0,s.div)(o.__spreadArray([(0,r.h)("div",{style:(0,i.style)({display:"inline-block",width:(0,i.px)(10),marginRight:(0,i.px)(10)})},(0,d.parsePieceName)(e))],c,!0))}))))),(0,r.h)("div",{key:"modal-footer",className:"modal-footer"},(0,r.h)("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:function(){f.closeUserSettingsModal()}},c.i18n.UserSettings.Buttons.Cancel()),(0,r.h)("a",{href:"#",key:"btn-save",datatest:"btn-save",id:"btn-save",className:"waves-effect waves-light btn red",onclick:function(){f.commitUserSettings(),f.closeUserSettingsModal()}},c.i18n.UserSettings.Buttons.Save()))))}},37:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.page_slider=void 0;var o=n(4361),i=n(4055);t.page_slider=function(e){var t=e.datatest,n=e.size,r=e.maxPage,a=e.currentIndex,c=e.actions;return(0,o.div)({className:"range-field",style:(0,i.style)({width:(0,i.px)(n.width),height:(0,i.px)(n.height),margin:"0px auto"})},[(0,o.input)({oninput:function(){var e=document.getElementById("input-page-number");if(null!==e){var t=Number(e.value);c.openPageWhenChange({index:t-1})}},datatest:t,id:"input-page-number",type:"range",min:"1",max:"".concat(r),value:"".concat(a+1)})])}},1809:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorTools=void 0;var o=n(4055),i=n(6540),r=n(3136),a=n(7478),c=n(9774);t.EditorTools=function(e){var t=e.currentPage,n=e.maxPage,s=e.height,u=e.palette,d=e.modeType,l=e.undoCount,f=e.redoCount,g=e.inferenceCount,p=e.actions,m=(0,o.style)({width:"100%",height:(0,o.px)(s),margin:0,padding:0}),h=(0,o.style)({width:"100%",height:(0,o.px)(s),margin:0,padding:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),v={baseClass:u.baseClass,baseCode:u.baseCode,darkCode:u.darkCode},y="page-footer tools ".concat(u.baseClass),x="".concat(t," / ").concat(n),P=t<n?"navigate_next":"add";return(0,i.h)("nav",{datatest:"tools",className:y,style:m},(0,i.h)("div",{className:"nav-wrapper",style:h},(0,i.h)(r.ToolButton,{iconName:"undo",datatest:"btn-undo",width:35,height:s-10,key:"btn-undo",fontSize:33.75,marginRight:5,colors:v,actions:{onclick:function(){return p.undo()}},enable:0<l||0<g}),(0,i.h)(r.ToolButton,{iconName:"redo",datatest:"btn-redo",width:35,height:s-10,key:"btn-redo",fontSize:33.75,marginRight:15,colors:v,actions:{onclick:function(){return p.redo()}},enable:0<f}),(0,i.h)(r.ToolButton,{iconName:"navigate_before",datatest:"btn-back-page",width:35,height:s-10,key:"btn-back-page",fontSize:33.75,marginRight:5,colors:v,actions:{onclick:function(){return p.backPage({loop:!1})}},enable:1<t}),(0,i.h)(a.ToolText,{datatest:"text-pages",height:s-10,minWidth:75,fontSize:18,marginRight:5},x),(0,i.h)(r.ToolButton,{iconName:P,datatest:"btn-next-page",width:35,height:s-10,key:"btn-next-page",fontSize:33.75,marginRight:10,colors:v,actions:{onclick:function(){return p.nextPageOrNewPage()}}}),(0,i.h)(r.ToolButton,{iconName:"home",datatest:"btn-drawing-tool",width:40,height:s-10,key:"btn-drawing-tool",fontSize:30,marginRight:40,colors:v,actions:{onclick:function(){return p.changeToDrawingToolMode()}},enable:d!==c.ModeTypes.DrawingTool}),(0,i.h)(r.ToolButton,{iconName:"menu",datatest:"btn-open-menu",sticky:!0,key:"btn-open-menu",width:40,height:s-10,fontSize:32,colors:v,actions:{onclick:function(){return p.openMenuModal()}}})))}},6136:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReaderTools=void 0;var o=n(4055),i=n(6540),r=n(3136),a=n(7478),c=n(9774);t.ReaderTools=function(e){var t=e.currentPage,n=e.maxPage,s=e.height,u=e.animationState,d=e.pages,l=e.palette,f=e.loop,g=e.actions,p=(0,o.style)({width:"100%",height:(0,o.px)(s),margin:0,padding:0}),m=(0,o.style)({width:"100%",height:(0,o.px)(s),margin:0,padding:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),h="page-footer tools ".concat(l.baseClass);return(0,i.h)("nav",{datatest:"tools",className:h,style:p},(0,i.h)("div",{className:"nav-wrapper",style:m},(0,i.h)(r.ToolButton,{iconName:"pause"!==u?"pause":"play_arrow",datatest:"btn-play-anime",key:"btn-play-anime",width:40,height:s-10,fontSize:40,colors:l,marginRight:15,actions:{onclick:function(){switch(u){case c.AnimationState.Play:g.pauseAnimation();break;default:g.startAnimation()}}}}),(0,i.h)(r.ToolButton,{iconName:"navigate_before",datatest:"btn-back-page",width:35,height:s-10,key:"btn-back-page",fontSize:33.75,marginRight:5,colors:l,actions:{onclick:function(){return g.backPage({loop:f})}},enable:f||1<t}),(0,i.h)(a.ToolText,{datatest:"text-pages",height:s-10,minWidth:75,fontSize:18,marginRight:5},d),(0,i.h)(r.ToolButton,{iconName:"navigate_next",datatest:"btn-next-page",width:35,height:s-10,key:"btn-next-page",fontSize:33.75,marginRight:10,colors:l,enable:f||t<n,actions:{onclick:function(){return g.nextPage({loop:f})}}}),(0,i.h)(r.ToolButton,{iconName:"mode_edit",datatest:"btn-writable-in-reader",width:40,height:s-10,key:"btn-writable-in-reader",fontSize:33.75,marginRight:10,colors:l,actions:{onclick:function(){g.changeToDrawerScreen({refresh:!0})}}}),(0,i.h)(r.ToolButton,{iconName:"menu",datatest:"btn-open-menu",sticky:!0,key:"btn-open-menu",width:40,height:s-10,fontSize:32,colors:l,actions:{onclick:function(){return g.openMenuModal()}}})))}},3136:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolButton=void 0;var o=n(6540),i=n(4055),r=n(4272);t.ToolButton=function(e){var t=e.height,n=e.width,a=e.fontSize,c=e.key,s=e.iconName,u=e.sticky,d=void 0!==u&&u,l=e.marginLeft,f=void 0===l?void 0:l,g=e.marginRight,p=void 0===g?0:g,m=e.datatest,h=e.colors,v=e.enable,y=void 0===v||v,x=e.actions,P=(0,i.style)({height:(0,i.px)(t),lineHeight:(0,i.px)(t),width:(0,i.px)(n),marginLeft:d?"auto":f,position:d?"absolute":void 0,right:d?"10px":void 0,marginRight:(0,i.px)(p)}),b=x.onclick;return(0,o.h)("a",{href:"#",key:c,datatest:m,style:P,onclick:void 0!==b?function(e){b(e),e.stopPropagation(),e.preventDefault()}:void 0},(0,o.h)(r.SizedIcon,{height:t,fontSize:a,colors:h,enable:y},s))}},7478:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolText=void 0;var o=n(6540),i=n(4055);t.ToolText=function(e,t){var n=e.datatest,r=e.height,a=e.fontSize,c=e.minWidth,s=e.marginRight,u=void 0===s?0:s,d=(0,i.style)({lineHeight:(0,i.px)(r),fontSize:(0,i.px)(a),minWidth:(0,i.px)(c),textAlign:"center",whiteSpace:"nowrap",marginRight:(0,i.px)(u)});return(0,o.h)("span",{datatest:n,style:d},t)}},2995:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toPage=t.toPrimitivePage=t.toDecoratorOperationTask=t.toPageTaskStack=t.toUnsetQuizFlagTask=t.toSetQuizFlagTask=t.toUnfreezeCommentTask=t.toFreezeCommentTask=t.toRefPageTask=t.toKeyPageTask=t.toInsertPageTask=t.toRemovePageTask=t.toSinglePageTask=t.toFumenTask=t.isOperationTask=void 0;var o=n(655),i=n(1983),r=n(5187),a=n(2315),c=n(9782);t.isOperationTask=function(e){return!e.fixed},t.toFumenTask=function(e,n,i){return{replay:function(){return o.__awaiter(void 0,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return e={},[4,(0,a.decode)(n)];case 1:return[2,(e.pages=t.sent(),e.index=0,e)]}}))}))},revert:function(){return o.__awaiter(void 0,void 0,void 0,(function(){return o.__generator(this,(function(n){return[2,{pages:e.map(t.toPage),index:i}]}))}))},fixed:!0,key:(0,r.generateKey)()}},t.toSinglePageTask=function(e,n,o){var i=(0,t.toPrimitivePage)(o);return{replay:function(n){return n[e]=(0,t.toPage)(i),{pages:n,index:e}},revert:function(o){return o[e]=(0,t.toPage)(n),{pages:o,index:e}},fixed:!1,key:(0,r.generateKey)()}},t.toRemovePageTask=function(e,n,o,a){return{replay:function(t){var o=new i.Pages(t);o.deletePage(e,n);var r=o.pages;return{pages:r,index:e<r.length?e:r.length-1}},revert:function(n){var r=new i.Pages(n);return r.insertPage(e,o.map(t.toPage)),{pages:r.pages,index:a}},fixed:!1,key:(0,r.generateKey)()}},t.toInsertPageTask=function(e,n,o){return{replay:function(o){var r=new i.Pages(o);return r.insertPage(e,n.map(t.toPage)),{pages:r.pages,index:e}},revert:function(t){var r=new i.Pages(t);return r.deletePage(e,e+n.length),{pages:r.pages,index:o}},fixed:!1,key:(0,r.generateKey)()}},t.toKeyPageTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.toKeyPage(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.toRefPage(e),{index:e,pages:n.pages}},fixed:!1,key:(0,r.generateKey)()}},t.toRefPageTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.toRefPage(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.toKeyPage(e),{index:e,pages:n.pages}},fixed:!1,key:(0,r.generateKey)()}},t.toFreezeCommentTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.freezeComment(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.unfreezeComment(e),{index:e,pages:n.pages}},fixed:!1,key:(0,r.generateKey)()}},t.toUnfreezeCommentTask=function(e,t){return{replay:function(t){var n=new i.Pages(t);return n.unfreezeComment(e),{index:e,pages:n.pages}},revert:function(n){var o=new i.Pages(n);o.freezeComment(e);var r=o.pages;return r[e].comment={text:t},{index:e,pages:r}},fixed:!1,key:(0,r.generateKey)()}},t.toSetQuizFlagTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.setQuizFlag(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.unsetQuizFlag(e),{index:e,pages:n.pages}},fixed:!1,key:(0,r.generateKey)()}},t.toUnsetQuizFlagTask=function(e){return{replay:function(t){var n=new i.Pages(t);return n.unsetQuizFlag(e),{index:e,pages:n.pages}},revert:function(t){var n=new i.Pages(t);return n.setQuizFlag(e),{index:e,pages:n.pages}},fixed:!1,key:(0,r.generateKey)()}},t.toPageTaskStack=function(e,t){return{replay:function(t){for(var n={pages:t,index:0},o=0,i=e;o<i.length;o++)n=i[o].replay(n.pages);return n},revert:function(n){for(var o={pages:n,index:0},i=0,r=e.concat().reverse();i<r.length;i++)o=r[i].revert(o.pages);return{pages:o.pages,index:void 0!==t?t:o.index}},fixed:!1,key:(0,r.generateKey)()}},t.toDecoratorOperationTask=function(e,t){return{replay:function(n){var o=e.replay(n);return t.replay(o.pages)},revert:function(n){var o=t.revert(n);return e.revert(o.pages)},fixed:!1,key:e.key}},t.toPrimitivePage=function(e){var t=e.field.obj,n=e.commands;return{index:e.index,field:{obj:void 0!==t?{play:t.toPlayFieldPieces(),sentLine:t.toSentLintPieces()}:void 0,ref:e.field.ref},piece:void 0!==e.piece?{type:e.piece.type,coordinate:o.__assign({},e.piece.coordinate),rotation:e.piece.rotation}:void 0,comment:{text:e.comment.text,ref:e.comment.ref},commands:void 0!==n?{pre:o.__assign({},n.pre)}:void 0,flags:{lock:e.flags.lock,mirror:e.flags.mirror,colorize:e.flags.colorize,rise:e.flags.rise,quiz:e.flags.quiz}}},t.toPage=function(e){var t=e.field.obj,n=e.commands;return{index:e.index,field:{obj:void 0!==t?new c.Field({field:new c.PlayField({pieces:t.play}),sentLine:new c.PlayField({pieces:t.sentLine})}):void 0,ref:e.field.ref},piece:e.piece,comment:{text:e.comment.text,ref:e.comment.ref},commands:void 0!==n?{pre:o.__assign({},n.pre)}:void 0,flags:{lock:e.flags.lock,mirror:e.flags.mirror,colorize:e.flags.colorize,rise:e.flags.rise,quiz:e.flags.quiz}}}},3891:(e,t,n)=>{var o,i,r,a,c,s,u,d,l,f,g,p;Object.defineProperty(t,"__esModule",{value:!0}),t.decideBackgroundColor=t.decideMarkPieceColor=t.decidePieceColor=t.Palette=void 0;var m=n(9774),h=n(2742);t.Palette=function(e){return{baseClass:function(){switch(e){case m.Screens.Editor:return"red";default:return"teal"}}(),baseCode:function(){switch(e){case m.Screens.Editor:return"#f44336";default:return"#009688"}}(),darkCode:function(){switch(e){case m.Screens.Editor:return"#d32f2f";default:return"#00796b"}}()}},t.decidePieceColor=function(e,t,n){return(n?v:y)[e][void 0!==t?t:h.HighlightType.Normal]},t.decideMarkPieceColor=function(e,t){return(t?v:y)[e][h.HighlightType.Darker]};var v=((o={}).inference=((i={})[h.HighlightType.Normal]="#ffffff",i[h.HighlightType.Highlight1]="#ffffff",i[h.HighlightType.Highlight2]="#ffffff",i[h.HighlightType.Lighter]="#ffffff",i[h.HighlightType.Darker]="#ffffff",i),o[m.Piece.Gray]=((r={})[h.HighlightType.Normal]="#999999",r[h.HighlightType.Highlight1]="#cccccc",r[h.HighlightType.Highlight2]="#ffffff",r[h.HighlightType.Lighter]="#333333",r[h.HighlightType.Darker]="#666666",r),o[m.Piece.I]=((a={})[h.HighlightType.Normal]="#009999",a[h.HighlightType.Highlight1]="#33cccc",a[h.HighlightType.Highlight2]="#00ffff",a[h.HighlightType.Lighter]="#003333",a[h.HighlightType.Darker]="#006666",a),o[m.Piece.T]=((c={})[h.HighlightType.Normal]="#990099",c[h.HighlightType.Highlight1]="#cc33cc",c[h.HighlightType.Highlight2]="#ff00ff",c[h.HighlightType.Lighter]="#4d004d",c[h.HighlightType.Darker]="#660066",c),o[m.Piece.S]=((s={})[h.HighlightType.Normal]="#009900",s[h.HighlightType.Highlight1]="#33cc33",s[h.HighlightType.Highlight2]="#00ff00",s[h.HighlightType.Lighter]="#003300",s[h.HighlightType.Darker]="#006600",s),o[m.Piece.Z]=((u={})[h.HighlightType.Normal]="#990000",u[h.HighlightType.Highlight1]="#cc3333",u[h.HighlightType.Highlight2]="#ff0000",u[h.HighlightType.Lighter]="#4d0000",u[h.HighlightType.Darker]="#660000",u),o[m.Piece.L]=((d={})[h.HighlightType.Normal]="#996600",d[h.HighlightType.Highlight1]="#cc9933",d[h.HighlightType.Highlight2]="#ff9900",d[h.HighlightType.Lighter]="#3b1d00",d[h.HighlightType.Darker]="#663300",d),o[m.Piece.J]=((l={})[h.HighlightType.Normal]="#0000BB",l[h.HighlightType.Highlight1]="#3333cc",l[h.HighlightType.Highlight2]="#0000ff",l[h.HighlightType.Lighter]="#000061",l[h.HighlightType.Darker]="#000099",l),o[m.Piece.O]=((f={})[h.HighlightType.Normal]="#999900",f[h.HighlightType.Highlight1]="#cccc33",f[h.HighlightType.Highlight2]="#ffff00",f[h.HighlightType.Lighter]="#333300",f[h.HighlightType.Darker]="#666600",f),o[m.Piece.Empty]=((g={})[h.HighlightType.Normal]="#000000",g[h.HighlightType.Highlight1]="#000000",g[h.HighlightType.Highlight2]="#000000",g[h.HighlightType.Lighter]="#000000",g[h.HighlightType.Darker]="#000000",g),o),y=((p={}).inference=v.inference,p[m.Piece.Gray]=v[m.Piece.Gray],p[m.Piece.I]=v[m.Piece.Z],p[m.Piece.T]=v[m.Piece.I],p[m.Piece.S]=v[m.Piece.T],p[m.Piece.Z]=v[m.Piece.S],p[m.Piece.L]=v[m.Piece.L],p[m.Piece.J]=v[m.Piece.J],p[m.Piece.O]=v[m.Piece.O],p[m.Piece.Empty]=v[m.Piece.Empty],p);t.decideBackgroundColor=function(e){return e<20?"#000000":"#333333"}},9774:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isInPlayField=t.parseRotationName=t.nextRotationToRight=t.nextRotationToLeft=t.toPositionIndex=t.isMinoPiece=t.parsePiece=t.parsePieceName=t.gradientPatternFrom=t.GradientPattern=t.Platforms=t.CommentType=t.TouchTypes=t.ModeTypes=t.Screens=t.FieldConstants=t.Action=t.Operation=t.AnimationState=t.Rotation=t.Piece=void 0;var o,i,r,a,c,s,u,d,l,f,g,p=n(8286);!function(e){e[e.Empty=0]="Empty",e[e.I=1]="I",e[e.L=2]="L",e[e.O=3]="O",e[e.Z=4]="Z",e[e.T=5]="T",e[e.J=6]="J",e[e.S=7]="S",e[e.Gray=8]="Gray"}(o=t.Piece||(t.Piece={})),function(e){e[e.Spawn=0]="Spawn",e[e.Right=1]="Right",e[e.Reverse=2]="Reverse",e[e.Left=3]="Left"}(i=t.Rotation||(t.Rotation={})),(g=t.AnimationState||(t.AnimationState={})).Pause="pause",g.Play="play",(f=t.Operation||(t.Operation={})).Direct="direct",f.Swap="swap",f.Stock="stock",(t.Action||(t.Action={})).Block="block",function(e){e[e.Width=10]="Width",e[e.Height=23]="Height",e[e.SentLine=1]="SentLine",e[e.PlayBlocks=230]="PlayBlocks",e[e.AllBlocks=240]="AllBlocks"}(r=t.FieldConstants||(t.FieldConstants={})),(l=t.Screens||(t.Screens={})).Reader="Reader",l.Editor="Editor",(d=t.ModeTypes||(t.ModeTypes={})).Drawing="Drawing",d.Piece="Piece",d.Fill="Fill",d.DrawingTool="DrawingTool",d.Flags="Flags",d.Utils="Utils",d.Slide="Slide",d.FillRow="FillRow",d.SelectPiece="SelectPiece",d.Comment="Comment",(u=t.TouchTypes||(t.TouchTypes={})).None="None",u.Drawing="Drawing",u.Piece="Piece",u.Fill="Fill",u.MovePiece="MovePiece",u.FillRow="FillRow",(s=t.CommentType||(t.CommentType={})).Writable="Writable",s.Readonly="Readonly",s.PageSlider="PageSlider",(c=t.Platforms||(t.Platforms={})).PC="PC",c.Mobile="Mobile",(a=t.GradientPattern||(t.GradientPattern={}))[a.None=0]="None",a[a.Line=1]="Line",a[a.Triangle=2]="Triangle",a[a.Circle=3]="Circle",t.gradientPatternFrom=function(e){switch(e){case"0":case"1":case"2":case"3":return parseInt(e,10)}},t.parsePieceName=function(e){switch(e){case o.I:return"I";case o.L:return"L";case o.O:return"O";case o.Z:return"Z";case o.T:return"T";case o.J:return"J";case o.S:return"S";case o.Gray:return"Gray";case o.Empty:return"Empty"}},t.parsePiece=function(e){switch(e.toUpperCase()){case"I":return o.I;case"L":return o.L;case"O":return o.O;case"Z":return o.Z;case"T":return o.T;case"J":return o.J;case"S":return o.S;case"X":return o.Gray;case" ":case"_":return o.Empty}throw new p.FumenError("Unexpected piece: ".concat(e))},t.isMinoPiece=function(e){return e!==o.Empty&&e!==o.Gray},t.toPositionIndex=function(e){return e[0]+10*e[1]},t.nextRotationToLeft=function(e){switch(e){case i.Spawn:return i.Left;case i.Left:return i.Reverse;case i.Reverse:return i.Right;case i.Right:return i.Spawn}},t.nextRotationToRight=function(e){switch(e){case i.Spawn:return i.Right;case i.Right:return i.Reverse;case i.Reverse:return i.Left;case i.Left:return i.Spawn}},t.parseRotationName=function(e){switch(e){case i.Spawn:return"Spawn";case i.Left:return"Left";case i.Right:return"Right";case i.Reverse:return"Reverse"}},t.isInPlayField=function(e,t){return 0<=e&&e<r.Width&&0<=t&&t<r.Height}},8286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ViewError=t.FumenError=void 0;var o=n(655),i=function(){function e(e){this.message=e,this.name=this.constructor.name,Object.setPrototypeOf(this,this.constructor.prototype)}return e.prototype.toString=function(){return"".concat(this.name,": ").concat(this.message)},e}(),r=function(e){function t(t){return e.call(this,t)||this}return o.__extends(t,e),t}(i);t.FumenError=r;var a=function(e){function t(t){return e.call(this,t)||this}return o.__extends(t,e),t}(i);t.ViewError=a},2534:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encodeAction=t.decodeAction=void 0;var o=n(8286),i=n(9774);function r(e){return 0!==e}function a(e){return e?1:0}t.decodeAction=function(e,t){var n=(t+i.FieldConstants.SentLine)*i.FieldConstants.Width,a=e,c=function(e){switch(e){case 0:return i.Piece.Empty;case 1:return i.Piece.I;case 2:return i.Piece.L;case 3:return i.Piece.O;case 4:return i.Piece.Z;case 5:return i.Piece.T;case 6:return i.Piece.J;case 7:return i.Piece.S;case 8:return i.Piece.Gray}throw new o.FumenError("Unexpected piece")}(a%8),s=function(e){switch(e){case 0:return i.Rotation.Reverse;case 1:return i.Rotation.Right;case 2:return i.Rotation.Spawn;case 3:return i.Rotation.Left}throw new o.FumenError("Unexpected rotation")}((a=Math.floor(a/8))%4),u=function(e,t,n,o){var r=e%i.FieldConstants.Width,a=o-Math.floor(e/10)-1;return t===i.Piece.O&&n===i.Rotation.Left?(r+=1,a-=1):t===i.Piece.O&&n===i.Rotation.Reverse?r+=1:t===i.Piece.O&&n===i.Rotation.Spawn?a-=1:t===i.Piece.I&&n===i.Rotation.Reverse?r+=1:t===i.Piece.I&&n===i.Rotation.Left||t===i.Piece.S&&n===i.Rotation.Spawn?a-=1:t===i.Piece.S&&n===i.Rotation.Right?r-=1:t===i.Piece.Z&&n===i.Rotation.Spawn?a-=1:t===i.Piece.Z&&n===i.Rotation.Left&&(r+=1),{x:r,y:a}}((a=Math.floor(a/4))%n,c,s,t);return{rise:r((a=Math.floor(a/n))%2),mirror:r((a=Math.floor(a/2))%2),colorize:r((a=Math.floor(a/2))%2),comment:r((a=Math.floor(a/2))%2),lock:!r((a=Math.floor(a/2))%2),piece:{type:c,rotation:s,coordinate:u}}},t.encodeAction=function(e){var t,n,o,r,c,s,u=e.lock,d=e.comment,l=e.colorize,f=e.mirror,g=e.rise,p=e.piece,m=a(!u);return m*=2,m+=a(d),m*=2,m+=a(l),m*=2,m+=a(f),m*=2,m+=a(g),m*=i.FieldConstants.AllBlocks,m+=(n=(t=p).coordinate,o=t.type,r=t.rotation,c=n.x,s=n.y,(0,i.isMinoPiece)(o)?o===i.Piece.O&&r===i.Rotation.Left?(c-=1,s+=1):o===i.Piece.O&&r===i.Rotation.Reverse?c-=1:o===i.Piece.O&&r===i.Rotation.Spawn?s+=1:o===i.Piece.I&&r===i.Rotation.Reverse?c-=1:o===i.Piece.I&&r===i.Rotation.Left||o===i.Piece.S&&r===i.Rotation.Spawn?s+=1:o===i.Piece.S&&r===i.Rotation.Right?c+=1:o===i.Piece.Z&&r===i.Rotation.Spawn?s+=1:o===i.Piece.Z&&r===i.Rotation.Left&&(c-=1):(c=0,s=22),(i.FieldConstants.Height-s-1)*i.FieldConstants.Width+c),m*=4,m+=function(e){var t=e.type,n=e.rotation;if(!(0,i.isMinoPiece)(t))return 0;switch(n){case i.Rotation.Reverse:return 0;case i.Rotation.Right:return 1;case i.Rotation.Spawn:return 2;case i.Rotation.Left:return 3}}(p),(m*=8)+p.type}},9782:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayField=t.Field=void 0;var o=n(9774),i=n(8286),r=n(8711),a=function(){function e(t){var n=t.field,i=void 0===n?e.create(o.FieldConstants.PlayBlocks):n,r=t.sentLine,a=void 0===r?e.create(o.FieldConstants.Width):r;this.playField=i,this.sentLine=a}return e.create=function(e){return new c({length:e})},e.prototype.add=function(e,t,n){0<=t?this.playField.add(e,t,n):this.sentLine.add(e,-(t+1),n)},e.prototype.put=function(e){this.playField.put(e)},e.prototype.setToPlayField=function(e,t){this.playField.setAt(e,t)},e.prototype.setToSentLine=function(e,t){this.sentLine.setAt(e,t)},e.prototype.clearLine=function(){this.playField.clearLine()},e.prototype.up=function(){this.playField.up(this.sentLine),this.sentLine.clearAll()},e.prototype.mirror=function(){this.playField.mirror()},e.prototype.shiftToLeft=function(){this.playField.shiftToLeft()},e.prototype.shiftToRight=function(){this.playField.shiftToRight()},e.prototype.shiftToUp=function(){this.playField.shiftToUp()},e.prototype.shiftToBottom=function(){this.playField.shiftToBottom()},e.prototype.get=function(e,t){return 0<=t?this.playField.get(e,t):this.sentLine.get(e,-(t+1))},e.prototype.getAtIndex=function(e,t){return t?this.get(e%10,Math.floor(e/10)):this.get(e%10,-(Math.floor(e/10)+1))},e.prototype.copy=function(){return new e({field:this.playField.copy(),sentLine:this.sentLine.copy()})},e.prototype.toPlayFieldPieces=function(){return this.playField.toArray()},e.prototype.toSentLintPieces=function(){return this.sentLine.toArray()},e.prototype.equals=function(e){return this.playField.equals(e.playField)&&this.sentLine.equals(e.sentLine)},e.prototype.canPut=function(e,t,n,i){var a=this;return(0,r.getBlockPositions)(e,t,n,i).every((function(e){var t=e[0],n=e[1];return 0<=t&&t<10&&0<=n&&a.get(t,n)===o.Piece.Empty}))},e.prototype.isOnGround=function(e,t,n,o){return!this.canPut(e,t,n,o-1)},e.prototype.convertToGray=function(){this.playField.convertToGray(),this.sentLine.convertToGray()},e}();t.Field=a;var c=function(){function e(e){var t=e.pieces,n=e.length,i=void 0===n?o.FieldConstants.PlayBlocks:n;this.pieces=void 0!==t?t:Array.from({length:i}).map((function(){return o.Piece.Empty})),this.length=i}return e.load=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.join("").trim();return e.loadInner(o)},e.loadMinify=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.join("").trim();return e.loadInner(o,o.length)},e.loadInner=function(t,n){var r=void 0!==n?n:t.length;if(r%10!=0)throw new i.FumenError("Num of block in field should be mod 10");for(var a=new e(void 0!==n?{length:n}:{}),c=0;c<r;c+=1){var s=t[c];a.set(c%10,Math.floor((r-c-1)/10),(0,o.parsePiece)(s))}return a},e.prototype.get=function(e,t){return this.pieces[e+t*o.FieldConstants.Width]},e.prototype.add=function(e,t,n){var i=e+t*o.FieldConstants.Width;this.pieces[i]=Math.max(this.pieces[i]+n,0)},e.prototype.set=function(e,t,n){this.setAt(e+t*o.FieldConstants.Width,n)},e.prototype.setAt=function(e,t){this.pieces[e]=t},e.prototype.put=function(e){for(var t=e.type,n=e.rotation,o=e.coordinate,i=0,a=(0,r.getBlocks)(t,n);i<a.length;i++){var c=a[i],s=[o.x+c[0],o.y+c[1]],u=s[0],d=s[1];this.set(u,d,t)}},e.prototype.clearLine=function(){for(var e=this.pieces.concat(),t=this.pieces.length/o.FieldConstants.Width-1;0<=t;t-=1)if(this.pieces.slice(t*o.FieldConstants.Width,(t+1)*o.FieldConstants.Width).every((function(e){return e!==o.Piece.Empty}))){var n=e.slice(0,t*o.FieldConstants.Width),i=e.slice((t+1)*o.FieldConstants.Width);e=n.concat(i,Array.from({length:o.FieldConstants.Width}).map((function(){return o.Piece.Empty})))}this.pieces=e},e.prototype.up=function(e){this.pieces=e.pieces.concat(this.pieces).slice(0,this.length)},e.prototype.mirror=function(){for(var e=[],t=0;t<this.pieces.length;t+=1){var n=this.pieces.slice(t*o.FieldConstants.Width,(t+1)*o.FieldConstants.Width);n.reverse();for(var i=0,r=n;i<r.length;i++){var a=r[i];e.push(a)}}this.pieces=e},e.prototype.shiftToLeft=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=0;n<o.FieldConstants.Width-1;n+=1)this.pieces[n+t*o.FieldConstants.Width]=this.pieces[n+1+t*o.FieldConstants.Width];this.pieces[9+t*o.FieldConstants.Width]=o.Piece.Empty}},e.prototype.shiftToRight=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=o.FieldConstants.Width-1;1<=n;n-=1)this.pieces[n+t*o.FieldConstants.Width]=this.pieces[n-1+t*o.FieldConstants.Width];this.pieces[t*o.FieldConstants.Width]=o.Piece.Empty}},e.prototype.shiftToUp=function(){var e=Array.from({length:10}).map((function(){return o.Piece.Empty}));this.pieces=e.concat(this.pieces).slice(0,this.length)},e.prototype.shiftToBottom=function(){var e=Array.from({length:10}).map((function(){return o.Piece.Empty}));this.pieces=this.pieces.slice(10,this.length).concat(e)},e.prototype.toArray=function(){return this.pieces.concat()},Object.defineProperty(e.prototype,"numOfBlocks",{get:function(){return this.pieces.length},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e({pieces:this.pieces.concat(),length:this.length})},e.prototype.toShallowArray=function(){return this.pieces},e.prototype.clearAll=function(){this.pieces=this.pieces.map((function(){return o.Piece.Empty}))},e.prototype.equals=function(e){if(this.pieces.length!==e.pieces.length)return!1;for(var t=0;t<this.pieces.length;t+=1)if(this.pieces[t]!==e.pieces[t])return!1;return!0},e.prototype.convertToGray=function(){this.pieces=this.pieces.map((function(e){return e!==o.Piece.Empty?o.Piece.Gray:o.Piece.Empty}))},e}();t.PlayField=c},2315:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.innerDecode=t.decode=t.extract=void 0;var o=n(655),i=n(9774),r=n(4826),a=n(9782),c=n(2534),s=n(2375),u=n(8286),d=n(1983),l=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",f=l.length+1;function g(e){for(var t=[],n=e,o=0;o<4;o+=1){var i=n%f;t.push(l[i]),n=Math.floor(n/f)}return t}var p=i.FieldConstants.Width;function m(e){var t,n=function(e,t){return{version:e,data:t.trim().replace(/[?\s]+/g,"")}},o=e,i=o.indexOf("&");if(0<=i&&(o=o.substring(0,i)),null!=(t=e.match(/[vmd]115@/))&&void 0!==t.index)return n("115",o.substr(t.index+5));if(null!=(t=e.match(/[vmd]110@/))&&void 0!==t.index)return n("110",o.substr(t.index+5));throw new u.FumenError("Fumen is not supported")}function h(e,t,n){return void 0===n&&(n=function(){}),o.__awaiter(this,void 0,void 0,(function(){var u,d,l,f,m,h,v,y,x,P,b,k,w,_,C,T,S,M,z,F,I,L,R,O,B,E,A,q,N;return o.__generator(this,(function(o){for(u=t+i.FieldConstants.SentLine,d=u*p,l=function(e){for(var n={changed:!0,field:e},o=0;o<d;){var i=m.poll(2),r=Math.floor(i/d),a=i%d;8===r&&a===d-1&&(n.changed=!1);for(var c=0;c<a+1;c+=1){var s=o%p,u=t-Math.floor(o/p)-1;n.field.add(s,u,r-8),o+=1}}return n},f=0,m=new s.Values(e),h=new a.Field({}),v={repeatCount:-1,refIndex:{comment:0,field:0},quiz:void 0,lastCommentText:""},y=[];!m.isEmpty();){if(x=void 0,0<v.repeatCount?(x={field:h,changed:!1},v.repeatCount-=1):(x=l(h.copy())).changed||(v.repeatCount=m.poll(1)),P=m.poll(3),b=(0,c.decodeAction)(P,t),k=void 0,b.comment){for(w=[],_=m.poll(2),C=0;C<Math.floor((_+3)/4);C+=1)T=m.poll(5),w.push(T);for(S=[],M=0,z=w;M<z.length;M++)F=z[M],I=g(F),S.push.apply(S,I);if(L=unescape(S.slice(0,_).join("")),v.lastCommentText=L,k={text:L},v.refIndex.comment=f,R=k.text,r.Quiz.isQuizComment(R))try{v.quiz=new r.Quiz(R)}catch(e){v.quiz=void 0}else v.quiz=void 0}else k=0===f?{text:""}:{ref:v.refIndex.comment};if(O=!1,void 0!==v.quiz&&(O=!0,v.quiz.canOperate()&&b.lock))if((0,i.isMinoPiece)(b.piece.type))try{B=v.quiz.nextIfEnd(),E=B.getOperation(b.piece.type),v.quiz=B.operate(E)}catch(e){console.error(e.message),v.quiz=v.quiz.format()}else v.quiz=v.quiz.format();A=void 0,b.piece.type!==i.Piece.Empty&&(A=b.piece),q=void 0,x.changed||0===f?(q={obj:x.field.copy()},v.refIndex.field=f):q={ref:v.refIndex.field},N={field:q,comment:k,index:f,piece:A,flags:{quiz:O,lock:b.lock,mirror:b.mirror,colorize:b.colorize,rise:b.rise}},y.push(N),n(x.field.copy(),A,void 0!==v.quiz?v.quiz.format().toString():v.lastCommentText),f+=1,b.lock&&((0,i.isMinoPiece)(b.piece.type)&&x.field.put(b.piece),x.field.clearLine(),b.rise&&x.field.up(),b.mirror&&x.field.mirror()),h=x.field}return[2,y]}))}))}t.extract=m,t.decode=function(e,t){return void 0===t&&(t=function(){}),o.__awaiter(this,void 0,void 0,(function(){var n,i,r;return o.__generator(this,(function(o){switch(n=m(e),i=n.version,r=n.data,i){case"115":return[2,h(r,23,t)];case"110":return[2,h(r,21,t)]}return[2]}))}))},t.innerDecode=h,t.encode=function(e,t){return void 0===t&&(t=!1),o.__awaiter(this,void 0,void 0,(function(){var n,r,u,g,m,h,v,y,x,P,b,k,w=this;return o.__generator(this,(function(_){switch(_.label){case 0:n=function(e,t){var n=function(e,t){for(var n=24*p,o=new s.Values,i=function(n,o){var i=23-o-1;return t.get(n,i)-e.get(n,i)+8},r=function(e,t){var i=e*n+t;o.push(i,2)},a=!0,c=i(0,0),u=-1,d=0;d<24;d+=1)for(var l=0;l<p;l+=1){var f=i(l,d);f!==c?(r(c,u),u=0,c=f):u+=1}return r(c,u),8===c&&u===n-1&&(a=!1),{values:o,changed:a}}(e,t),o=n.changed,i=n.values;if(o)u.merge(i),r=-1;else if(r<0||u.get(r)===s.ENCODE_TABLE_LENGTH-1)u.merge(i),u.push(0),r=u.length-1;else if(u.get(r)<s.ENCODE_TABLE_LENGTH-1){var a=u.get(r);u.set(r,a+1)}},r=-1,u=new s.Values,g=new a.Field({}),m=new d.Pages(e),h=function(t){var o=m.getField(t),r=e[t],a=void 0!==o?o.copy():g.copy(),s=r.commands;void 0!==s&&Object.keys(s.pre).map((function(e){return s.pre[e]})).forEach((function(e){switch(e.type){case"block":var t=e.x,n=e.y,o=e.piece;return void a.setToPlayField(t+10*n,o);case"sentBlock":t=e.x,n=e.y;var i=e.piece;return void a.setToSentLine(t+10*n,i)}})),n(g,a);var d,p=void 0!==r.comment.text&&(0!==t||""!==r.comment.text),h={piece:void 0!==r.piece?r.piece:{type:i.Piece.Empty,rotation:i.Rotation.Reverse,coordinate:{x:0,y:22}},rise:r.flags.rise,mirror:r.flags.mirror,colorize:r.flags.colorize,lock:r.flags.lock,comment:p},v=(0,c.encodeAction)(h);if(u.push(v,3),void 0!==r.comment.text&&p){var y=escape(r.comment.text),x=Math.min(y.length,4095);u.push(x,2);for(var P=0;P<x;P+=4){for(var b=0,k=0;k<4;k+=1){var w=P+k;if(x<=w)break;b+=(d=y.charAt(w),l.indexOf(d)*Math.pow(f,k))}u.push(b,5)}}h.lock&&((0,i.isMinoPiece)(h.piece.type)&&a.put(h.piece),a.clearLine(),h.rise&&a.up(),h.mirror&&a.mirror()),g=a},v=function(e){return o.__awaiter(w,void 0,void 0,(function(){return o.__generator(this,(function(t){return h(e),[2]}))}))},y=0,_.label=1;case 1:return y<e.length?t?[4,v(y)]:[3,3]:[3,5];case 2:return _.sent(),[3,4];case 3:h(y),_.label=4;case 4:return y+=1,[3,1];case 5:return(x=u.toString()).length<41?[2,x]:(P=[x.substr(0,42)],b=x.substring(42),k=b.match(/[\S]{1,47}/g)||[],[2,P.concat(k).join("?")])}}))}))}},4826:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Quiz=void 0;var o=n(8286),i=n(9774),r=function(){function e(t){this.quiz=e.verify(t)}return Object.defineProperty(e.prototype,"next",{get:function(){var e=this.quiz.indexOf(")")+1,t=this.quiz[e];return void 0===t||";"===t?"":t},enumerable:!1,configurable:!0}),e.isQuizComment=function(e){return e.startsWith("#Q=")},e.create=function(t,n){var o=function(t,n){var o=function(e){return e||""};return new e("#Q=[".concat(o(t),"](").concat(o(n[0]),")").concat(o(n.substring(1))))};return void 0!==n?o(t,n):o(void 0,t)},e.trim=function(e){return e.trim().replace(/\s+/g,"")},Object.defineProperty(e.prototype,"least",{get:function(){var e=this.quiz.indexOf(")");return this.quiz.substr(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){var e=this.quiz.indexOf("(")+1,t=this.quiz[e];return")"===t?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hold",{get:function(){var e=this.quiz.indexOf("[")+1,t=this.quiz[e];return"]"===t?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leastAfterNext2",{get:function(){var e=this.quiz.indexOf(")");return";"===this.quiz[e+1]?this.quiz.substr(e+1):this.quiz.substr(e+2)},enumerable:!1,configurable:!0}),e.prototype.getOperation=function(e){var t=(0,i.parsePieceName)(e),n=this.current;if(t===n)return i.Operation.Direct;var r=this.hold;if(t===r)return i.Operation.Swap;if(""===r){if(t===this.next)return i.Operation.Stock}else if(""===n&&t===this.next)return i.Operation.Direct;throw new o.FumenError("Unexpected hold piece in quiz: ".concat(this.quiz))},Object.defineProperty(e.prototype,"leastInActiveBag",{get:function(){var e=this.quiz.indexOf(";"),t=0<=e?this.quiz.substring(0,e):this.quiz,n=t.indexOf(")");return";"===t[n+1]?t.substr(n+1):t.substr(n+2)},enumerable:!1,configurable:!0}),e.verify=function(e){var t=this.trim(e);if(0===t.length||"#Q=[]()"===e||!e.startsWith("#Q="))return e;if(!t.match(/^#Q=\[[TIOSZJL]?]\([TIOSZJL]?\)[TIOSZJL]*(;.*)?$/i))throw new o.FumenError("Current piece doesn't exist, however next pieces exist: ".concat(e));return t},e.prototype.direct=function(){if(""===this.current){var t=this.leastAfterNext2;return new e("#Q=[".concat(this.hold,"](").concat(t[0],")").concat(t.substr(1)))}return new e("#Q=[".concat(this.hold,"](").concat(this.next,")").concat(this.leastAfterNext2))},e.prototype.swap=function(){if(""===this.hold)throw new o.FumenError("Cannot find hold piece: ".concat(this.quiz));var t=this.next;return new e("#Q=[".concat(this.current,"](").concat(t,")").concat(this.leastAfterNext2))},e.prototype.stock=function(){if(""!==this.hold||""===this.next)throw new o.FumenError("Cannot stock: ".concat(this.quiz));var t=this.leastAfterNext2,n=void 0!==t[0]?t[0]:"";return 1<t.length?new e("#Q=[".concat(this.current,"](").concat(n,")").concat(t.substr(1))):new e("#Q=[".concat(this.current,"](").concat(n,")"))},e.prototype.operate=function(e){switch(e){case i.Operation.Direct:return this.direct();case i.Operation.Swap:return this.swap();case i.Operation.Stock:return this.stock()}},e.prototype.format=function(){var t=this.nextIfEnd();if("#Q=[]()"===t.quiz)return new e("");var n=t.current,o=t.hold;if(""===n&&""!==o)return new e("#Q=[](".concat(o,")").concat(t.least));if(""===n){var i=t.least,r=i[0];return new e(void 0===r?"":";"===r?i.substr(1):"#Q=[](".concat(r,")").concat(i.substr(1)))}return t},e.prototype.getHoldPiece=function(){if(!this.canOperate())return i.Piece.Empty;var e=this.hold;return void 0===e||""===e||";"===e?i.Piece.Empty:(0,i.parsePiece)(e)},e.prototype.getNextPieces=function(e){if(!this.canOperate())return void 0!==e?Array.from({length:e}).map((function(){return i.Piece.Empty})):[];var t=(this.current+this.next+this.leastInActiveBag).substr(0,e);return void 0!==e&&t.length<e&&(t+=" ".repeat(e-t.length)),t.split("").map((function(e){return void 0===e||" "===e||";"===e?i.Piece.Empty:(0,i.parsePiece)(e)}))},e.prototype.toString=function(){return this.quiz},e.prototype.canOperate=function(){var e=this.quiz;return e.startsWith("#Q=[]();")&&(e=this.quiz.substr(8)),e.startsWith("#Q=")&&"#Q=[]()"!==e},e.prototype.nextIfEnd=function(){return this.quiz.startsWith("#Q=[]();")?new e(this.quiz.substr(8)):this},e}();t.Quiz=r},2375:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Values=t.ENCODE_TABLE_LENGTH=void 0;var o=n(8286),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t.ENCODE_TABLE_LENGTH=i.length;var r=function(){function e(e){void 0===e&&(e=""),this.values=e.split("").map(a)}return e.prototype.poll=function(e){for(var n=0,i=0;i<e;i+=1){var r=this.values.shift();if(void 0===r)throw new o.FumenError("Unexpected");n+=r*Math.pow(t.ENCODE_TABLE_LENGTH,i)}return n},e.prototype.push=function(e,n){void 0===n&&(n=1);for(var o=e,i=0;i<n;i+=1)this.values.push(o%t.ENCODE_TABLE_LENGTH),o=Math.floor(o/t.ENCODE_TABLE_LENGTH)},e.prototype.merge=function(e){for(var t=0,n=e.values;t<n.length;t++){var o=n[t];this.values.push(o)}},e.prototype.isEmpty=function(){return 0===this.values.length},Object.defineProperty(e.prototype,"length",{get:function(){return this.values.length},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.values[e]},e.prototype.set=function(e,t){this.values[e]=t},e.prototype.toString=function(){return this.values.map(c).join("")},e}();function a(e){return i.indexOf(e)}function c(e){return i[e]}t.Values=r},5584:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HyperStage=void 0;var o=n(655),i=n(6314),r=function(){function e(){}return e.prototype.addStage=function(e){this.stage=e},e.prototype.removeStage=function(){void 0!==this.stage&&(this.stage.removeChildren(),this.stage=void 0)},Object.defineProperty(e.prototype,"isReady",{get:function(){return void 0!==this.stage},enumerable:!1,configurable:!0}),e.prototype.resize=function(e){void 0!==this.stage&&this.stage.setSize(e)},e.prototype.batchDraw=function(){void 0!==this.stage&&this.stage.batchDraw()},e.prototype.reload=function(e){var t=this;if(void 0!==this.stage){var n=this.stage;setTimeout((function(){return o.__awaiter(t,void 0,void 0,(function(){var t,r,a,c=this;return o.__generator(this,(function(s){switch(s.label){case 0:return t=function(e){return o.__awaiter(c,void 0,void 0,(function(){return o.__generator(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},r=function(e){return o.__awaiter(c,void 0,void 0,(function(){return o.__generator(this,(function(o){switch(o.label){case 0:return e.hide(),n.batchDraw(),[4,t(4)];case 1:return o.sent(),[2]}}))}))},a=i.resources.konva.layers,[4,r(a.boxes)];case 1:return s.sent(),[4,r(a.field)];case 2:return s.sent(),[4,r(a.background)];case 3:return s.sent(),e((function(e){var i=function(e){return o.__awaiter(c,void 0,void 0,(function(){return o.__generator(this,(function(o){switch(o.label){case 0:return e.show(),n.batchDraw(),[4,t(6)];case 1:return o.sent(),[2]}}))}))},r=void 0!==e?e:30;setTimeout((function(){return o.__awaiter(c,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,t(r)];case 1:return e.sent(),[4,i(a.background)];case 2:return e.sent(),[4,i(a.field)];case 3:return e.sent(),[4,i(a.boxes)];case 4:return e.sent(),[2]}}))}))}),0)})),[2]}}))}))}),0)}},e.prototype.toDataURL=function(e){return void 0!==this.stage?this.stage.toDataURL(o.__assign(o.__assign({},e),{pixelRatio:4})):null},e}();t.HyperStage=r},3876:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.inferPiece=void 0;for(var o=n(9774),i=n(8711),r=[{positions:[0,1,10,11],result:{piece:o.Piece.O,rotate:o.Rotation.Spawn,offset:{x:0,y:0}}},{positions:[0,1,2,3],result:{piece:o.Piece.I,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,10,20,30],result:{piece:o.Piece.I,rotate:o.Rotation.Right,offset:{x:0,y:2}}},{positions:[0,1,2,11],result:{piece:o.Piece.T,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,9,10,11],result:{piece:o.Piece.T,rotate:o.Rotation.Reverse,offset:{x:0,y:1}}},{positions:[0,10,11,20],result:{piece:o.Piece.T,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,9,10,20],result:{piece:o.Piece.T,rotate:o.Rotation.Left,offset:{x:0,y:1}}},{positions:[0,1,11,12],result:{piece:o.Piece.S,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,9,10,19],result:{piece:o.Piece.S,rotate:o.Rotation.Right,offset:{x:-1,y:1}}},{positions:[0,1,9,10],result:{piece:o.Piece.Z,rotate:o.Rotation.Spawn,offset:{x:0,y:0}}},{positions:[0,10,11,21],result:{piece:o.Piece.Z,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,1,2,12],result:{piece:o.Piece.L,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,10,11,12],result:{piece:o.Piece.L,rotate:o.Rotation.Reverse,offset:{x:1,y:1}}},{positions:[0,1,10,20],result:{piece:o.Piece.L,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,10,19,20],result:{piece:o.Piece.L,rotate:o.Rotation.Left,offset:{x:0,y:1}}},{positions:[0,1,2,10],result:{piece:o.Piece.J,rotate:o.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,8,9,10],result:{piece:o.Piece.J,rotate:o.Rotation.Reverse,offset:{x:-1,y:1}}},{positions:[0,10,20,21],result:{piece:o.Piece.J,rotate:o.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,1,11,21],result:{piece:o.Piece.J,rotate:o.Rotation.Left,offset:{x:1,y:1}}}],a=function(e){for(var t=0,n="",o=0,i=e;o<i.length;o++){var r=i[o],a=Math.floor(r/10);if(t+1<a)return"";t=a,n+="".concat(r,",")}return n},c=new Map,s=0,u=r;s<u.length;s++){var d=u[s],l=a(d.positions);c.set(l,d.result)}var f=function(e,t){return e-t};t.inferPiece=function(e){if(4===e.length){var t=new Set;e.forEach((function(e){return t.add(Math.floor(e/10))}));var n=Array.from(t.keys()).map(Number).sort(f),r={};n.forEach((function(e,t){r["".concat(e)]=t}));for(var s=e.sort(f),u=s.map((function(e){var t=e%10,n=Math.floor(e/10);return 10*r["".concat(n)]+t})),d=!1,l=1;l<n.length;l+=1)if(1<n[l]-n[l-1]){d=!0;break}var g=u[0],p=u.map((function(e){return e-g})),m=c.get(a(p));if(m){var h=s[0],v=h%10+m.offset.x,y=Math.floor(h/10)+m.offset.y;if((0,i.getBlockPositions)(m.piece,m.rotate,v,y).every((function(e){var t=e[0],n=e[1];return(0,o.isInPlayField)(t,n)})))return{piece:m.piece,rotate:m.rotate,coordinate:d?void 0:{x:v,y}}}}}},1983:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseToCommands=t.PageFieldOperation=t.Pages=t.isQuizCommentResult=t.isTextCommentResult=void 0;var o=n(655),i=n(8286),r=n(9774),a=n(4826);function c(e){return void 0!==e.text}t.isTextCommentResult=c,t.isQuizCommentResult=function(e){return void 0!==e.quiz};var s,u=function(){function e(e){this.pages=e}return e.extractNext=function(e){for(var t=[],n=e[0],o=void 0!==n.piece?n.piece.type:r.Piece.Empty,i=0,a=e;i<a.length;i++){var c=a[i];if(void 0!==c.piece&&o!==c.piece.type){var s=c.piece.type;(0,r.isMinoPiece)(s)&&t.push(s),o=s}if(5<=t.length)break;(void 0===c.piece||c.flags.lock)&&(o=r.Piece.Empty)}return t},e.prototype.getComment=function(e){return this.pages[e].flags.quiz?this.restructureQuiz(e):this.getDescription(e)},e.prototype.setComment=function(e,t){var n=this.pages[e];void 0===n.comment.text&&this.freezeComment(e),void 0!==n.comment.text&&(n.comment.text=t)},e.prototype.getField=function(e,t){return void 0===t&&(t=s.None),this.restructureField(e,t)},e.prototype.insertRefPage=function(e){if(e<0)throw new i.FumenError("Illegal index: ".concat(e));var t=this.pages[e-1];if(void 0===t)throw new i.FumenError("Not found prev page: ".concat(e));var n={index:e,field:{ref:void 0},comment:{ref:void 0},flags:{lock:t.flags.lock,mirror:!t.flags.lock&&t.flags.mirror,colorize:t.flags.colorize,rise:!t.flags.lock&&t.flags.rise,quiz:t.flags.quiz},piece:t.flags.lock?void 0:t.piece};if(void 0!==t.field.ref)n.field.ref=t.field.ref;else{if(void 0===t.field.obj)throw new i.FumenError("Unexpected field: ".concat(t.field));n.field.ref=e-1}if(void 0!==t.comment.ref)n.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new i.FumenError("Unexpected comment: ".concat(t.comment));n.comment.ref=e-1}this.insertPage(e,[n])},e.prototype.insertKeyPage=function(e){if(e<0)throw new i.FumenError("Illegal index: ".concat(e));var t=this.pages[e-1];if(void 0===t)throw new i.FumenError("Not found prev page: ".concat(e));var n={index:e,field:{obj:this.restructureField(e-1,s.All)},comment:{ref:void 0},flags:{lock:t.flags.lock,mirror:!t.flags.lock&&t.flags.mirror,colorize:t.flags.colorize,rise:!t.flags.lock&&t.flags.rise,quiz:t.flags.quiz},piece:t.flags.lock?void 0:t.piece};if(void 0!==t.comment.ref)n.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new i.FumenError("Unexpected comment: ".concat(t.comment));n.comment.ref=e-1}this.insertPage(e,[n])},e.prototype.insertPage=function(e,t){if(void 0===t[0])throw new i.ViewError("No inserted pages");var n=t[0].index,o=t.map((function(t,o){if(t.index=e+o,void 0!==t.field.ref){var i=t.field.ref;t.field.ref=e+(i-n)}return void 0!==t.comment.ref&&(i=t.comment.ref,t.comment.ref=e+(i-n)),t})),r=o.length,a=o[r-1],c={field:void 0!==a.field.ref?a.field.ref:a.index,comment:void 0!==a.comment.ref?a.comment.ref:a.index};this.pages=this.pages.slice(0,e).concat(o).concat(this.pages.slice(e).map((function(t){var n;return t.index+=r,void 0!==t.field.ref&&((n=t.field.ref)<e?t.field.ref=c.field:e<=n&&(t.field.ref+=r)),void 0!==t.comment.ref&&((n=t.comment.ref)<e?t.comment.ref=c.comment:e<=n&&(t.comment.ref+=r)),t})))},e.prototype.duplicatePage=function(e){if(e<0)throw new i.FumenError("Illegal index: ".concat(e));var t=this.pages[e-1];if(void 0===t)throw new i.FumenError("Not found prev page: ".concat(e));var n={index:e,field:{obj:this.restructureField(e-1,s.Command)},comment:{ref:void 0},flags:o.__assign({},t.flags),piece:void 0!==t.piece?{type:t.piece.type,rotation:t.piece.rotation,coordinate:o.__assign({},t.piece.coordinate)}:void 0};if(void 0!==t.comment.ref)n.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new i.FumenError("Unexpected comment: ".concat(t.comment));n.comment.ref=e-1}this.insertPage(e,[n])},e.prototype.deletePage=function(e,t){var n=this.pages[t],o={field:0,comment:0},i=this.pages.slice(0,e).reverse();if(void 0!==n&&void 0!==n.field.obj)o.field=e;else{var r=i.findIndex((function(e){return void 0!==e.field.obj}));o.field=0<=r?e-r-1:0}void 0!==n&&void 0!==n.comment.text?o.comment=e:(r=i.findIndex((function(e){return void 0!==e.comment.text})),o.comment=0<=r?e-r-1:0);var a=t-e;this.pages=this.pages.slice(0,e).concat(this.pages.slice(t).map((function(t){var n;return t.index-=a,void 0!==t.field.ref&&((n=t.field.ref)<=e?t.field.ref=o.field:e<n&&(t.field.ref-=a)),void 0!==t.comment.ref&&((n=t.comment.ref)<=e?t.comment.ref=o.comment:e<n&&(t.comment.ref-=a)),t})))},e.prototype.toRefPage=function(e){var n=this.pages;if(e<=0||n.length<=e)throw new i.FumenError("Illegal index: ".concat(e));if(void 0===n[e].field.obj)throw new i.FumenError("Not found field obj: ".concat(e));var o=this.getField(e-1,s.All),r=this.getField(e,s.Command);n[e].commands=(0,t.parseToCommands)(o,r);for(var a=0,c=e-1;0<=c;c-=1)if(void 0!==n[c].field.obj){a=c;break}for(c=a+1;c<n.length;c+=1)n[c].field.ref===e&&(n[c].field.ref=a);n[e].field={ref:a}},e.prototype.toKeyPage=function(e){var t=this.pages;if(!(e<=0||t.length<=e)&&void 0!==t[e].field.ref){for(var n=this.getField(e,s.None),o=e+1;o<t.length;o+=1){var i=t[o].field.ref;void 0!==i&&i<e&&(t[o].field.ref=e)}t[e].field={obj:n}}},e.prototype.freezeComment=function(e){var t=this.pages;if(!(e<=0||t.length<=e)){var n=t[e];if(void 0===n)throw new i.FumenError("Not found page");if(void 0===n.comment.text&&void 0!==n.comment.ref){var o=this.getComment(e);c(o)?n.comment={text:o.text}:n.comment={text:o.quiz};for(var r=e+1;r<t.length;r+=1){var a=t[r].comment.ref;void 0!==a&&a<e&&(t[r].comment.ref=e)}}}},e.prototype.unfreezeComment=function(e){var t=this.pages;if(!(e<=0||t.length<=e)){var n=t[e];if(void 0===n)throw new i.FumenError("Not found page");if(void 0===n.comment.ref&&void 0!==n.comment.text){for(var o=0,r=e-1;0<=r;r-=1)if(void 0===t[r].comment.ref){o=r;break}for(r=e+1;r<t.length;r+=1){var a=t[r].comment.ref;void 0!==a&&a===e&&(t[r].comment.ref=o)}t[e].comment={ref:o}}}},e.prototype.restructureQuiz=function(t){var n=this,o=this.pages[t],c=function(e){if(a.Quiz.isQuizComment(e))try{return new a.Quiz(e)}catch(e){return}};return function(){var a=void 0;if(void 0!==o.comment.text)a={comment:u=o.comment.text,quiz:c(u),startIndex:t};else{var s=o.comment.ref;if(void 0===s)throw new i.ViewError("Cannot open reference for comment");var u,d=n.pages[s];if(void 0===d.comment.text)throw new i.ViewError("Not found quiz");a={comment:u=d.comment.text,quiz:c(u),startIndex:s}}if(!a.quiz)return n.getDescription(t);for(var l={quiz:a.quiz,comment:a.comment},f={quizAfterOperation:l.quiz,quiz:l.comment},g=a.startIndex;g<=t;g+=1){var p=n.pages[g];if(!p.flags.quiz)throw new i.ViewError("Unexpected quiz operation");var m=l.quiz;if(!m.canOperate())return{text:l.comment,next:e.extractNext(n.pages.slice(t))};if(p.flags.lock)if(void 0!==p.piece&&(0,r.isMinoPiece)(p.piece.type))try{var h=(y=m.nextIfEnd()).getOperation(p.piece.type),v=y.operate(h);f={quizAfterOperation:v,quiz:l.comment},l={quiz:v,comment:v.format().toString()}}catch(e){var y;console.error(e),f={quizAfterOperation:l.quiz,quiz:l.comment},l={quiz:y=m.format(),comment:y.toString()}}else f={quizAfterOperation:l.quiz,quiz:l.comment},l={quiz:y=m.format(),comment:y.toString()};else f={quizAfterOperation:l.quiz,quiz:l.comment}}return f}()},e.prototype.getDescription=function(t){var n=this,o=this.pages[t];return{next:e.extractNext(this.pages.slice(t)),text:function(){if(void 0!==o.comment.text)return o.comment.text;if(void 0!==o.comment.ref){var e=n.pages[o.comment.ref];if(void 0===e.comment.text)throw new i.ViewError("Unexpected comment");return e.comment.text}throw new i.ViewError("Not found comment")}()}},e.prototype.restructureField=function(e,t){var n=this,o=this.pages[e];return function(){var a=void 0;if(void 0!==o.field.obj)a={field:o.field.obj.copy(),startIndex:e,cache:!1};else{var c=o.field.ref;if(void 0===c)throw new i.ViewError("Cannot open reference for comment");var u=n.pages[c];if(void 0===u.field.obj)throw new i.ViewError("Not found quiz");a={field:u.field.obj.copy(),startIndex:c,cache:!1}}for(var d=a.field,l=function(o){var i=o===e;if(i&&t===s.None)return{value:d};d.copy();var a=n.pages[o],c=a.flags,u=a.piece,l=a.commands;if(void 0!==l&&Object.keys(l.pre).map((function(e){return l.pre[e]})).forEach((function(e){switch(e.type){case"block":var t=e.x,n=e.y,o=e.piece;return void d.setToPlayField(t+10*n,o);case"sentBlock":t=e.x,n=e.y;var i=e.piece;return void d.setToSentLine(t+10*n,i)}})),i&&t===s.Command)return{value:d};c.lock&&(void 0!==u&&(0,r.isMinoPiece)(u.type)&&d.put(u),d.clearLine(),c.rise&&d.up(),c.mirror&&d.mirror())},f=a.startIndex;f<=e;f+=1){var g=l(f);if("object"==typeof g)return g.value}return d}()},e.prototype.setQuizFlag=function(e){this.changeQuizFlag(e,!0)},e.prototype.unsetQuizFlag=function(e){this.changeQuizFlag(e,!1)},e.prototype.changeQuizFlag=function(e,t){var n=this.pages[e];if(void 0===n.comment.text)throw new i.FumenError("Comment does not exist in page: index=".concat(e,", flag=").concat(t));n.flags.quiz=t;for(var o=e+1;o<this.pages.length;o+=1){var r=this.pages[o];if(r.comment.ref!==e)break;r.flags.quiz=t}},e}();t.Pages=u,function(e){e.None="None",e.Command="Command",e.All="All"}(s=t.PageFieldOperation||(t.PageFieldOperation={})),t.parseToCommands=function(e,t){for(var n={pre:{}},o=-1;o<23;o+=1)for(var i=0;i<10;i+=1){var r=e.get(i,o),a=t.get(i,o),c=0<=o,s=c?i+10*o:i,u=c?"block":"sentBlock",d="".concat(u,"-").concat(s);r!==a&&(n.pre[d]={x:i,type:u,y:c?o:o+1,piece:a})}return n}},8711:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPieces=t.getBlocks=t.getBlockPositions=void 0;var o=n(8286),i=n(9774);function r(e,t){var n=a(e);switch(t){case i.Rotation.Spawn:return n;case i.Rotation.Left:return n.map((function(e){return[-e[1],e[0]]}));case i.Rotation.Reverse:return n.map((function(e){return[-e[0],-e[1]]}));case i.Rotation.Right:return function(e){return e.map((function(e){return[e[1],-e[0]]}))}(n)}}function a(e){switch(e){case i.Piece.I:return[[0,0],[-1,0],[1,0],[2,0]];case i.Piece.T:return[[0,0],[-1,0],[1,0],[0,1]];case i.Piece.O:return[[0,0],[1,0],[0,1],[1,1]];case i.Piece.L:return[[0,0],[-1,0],[1,0],[1,1]];case i.Piece.J:return[[0,0],[-1,0],[1,0],[-1,1]];case i.Piece.S:return[[0,0],[-1,0],[0,1],[1,1]];case i.Piece.Z:return[[0,0],[1,0],[0,1],[-1,1]]}throw new o.FumenError("Unsupported rotation")}t.getBlockPositions=function(e,t,n,o){return r(e,t).map((function(e){return e[0]+=n,e[1]+=o,e}))},t.getBlocks=r,t.getPieces=a},5187:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateKey=void 0;var n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";t.generateKey=function(e){void 0===e&&(e=8);var t=n.length;return Array.from({length:e}).map((function(){return n[Math.floor(Math.random()*t)]})).join("")}},7989:(e,t,n)=>{var o,i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.testRightRotation=t.testLeftRotation=void 0;var a=n(9774),c=((o={})[a.Rotation.Spawn]=[[0,0],[-1,0],[2,0],[-1,0],[2,0]],o[a.Rotation.Right]=[[-1,0],[0,0],[0,0],[0,1],[0,-2]],o[a.Rotation.Reverse]=[[-1,1],[1,1],[-2,1],[1,0],[-2,0]],o[a.Rotation.Left]=[[0,1],[0,1],[0,1],[0,-1],[0,2]],o),s=((i={})[a.Rotation.Spawn]=[[0,0]],i[a.Rotation.Right]=[[0,-1]],i[a.Rotation.Reverse]=[[-1,-1]],i[a.Rotation.Left]=[[-1,0]],i),u=((r={})[a.Rotation.Spawn]=[[0,0],[0,0],[0,0],[0,0],[0,0]],r[a.Rotation.Right]=[[0,0],[1,0],[1,-1],[0,2],[1,2]],r[a.Rotation.Reverse]=[[0,0],[0,0],[0,0],[0,0],[0,0]],r[a.Rotation.Left]=[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],r),d=function(e){switch(e){case a.Piece.I:return c;case a.Piece.O:return s;default:return u}};t.testLeftRotation=function(e,t){for(var n=d(e),o=n[t],i=(0,a.nextRotationToLeft)(t),r=n[i],c=[],s=0;s<o.length;s+=1)c.push([o[s][0]-r[s][0],o[s][1]-r[s][1]]);return{test:c,rotation:i}},t.testRightRotation=function(e,t){for(var n=d(e),o=n[t],i=(0,a.nextRotationToRight)(t),r=n[i],c=[],s=0;s<o.length;s+=1)c.push([o[s][0]-r[s][0],o[s][1]-r[s][1]]);return{test:c,rotation:i}}},4055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.px=t.style=void 0,t.style=function(e){return e},t.px=function(e){return"".concat(e,"px")}},7486:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=void 0,t.resources={Top:{RestoreFromStorage:"Restored to last state"},OpenFumen:{Title:"Open fumen",PlaceHolder:"URL or v115@~ / Support v115 or v110",Buttons:{Open:"Open",Cancel:"Cancel"},Errors:{FailedToLoad:"Failed to load",Unexpected:"Unexpected error: {{message}}"}},AppendFumen:{Title:"Append fumen",PlaceHolder:"URL or v115@~ / Support v115 or v110",Buttons:{Cancel:"Cancel"},Errors:{FailedToLoad:"Failed to load",Unexpected:"Unexpected error: {{message}}"}},UserSettings:{Title:"User Settings",Notice:"Clearing the browser cache will initialize the settings.",Ghost:{Title:"Show the ghost",Off:function(){return"Off"},On:function(){return"On"}},Loop:{Title:"Loop on page navigation [Reader]",Off:function(){return"Off"},On:function(){return"On"}},Gradient:{Title:"Adding a marker to the surface of the block"},Buttons:{Save:"Save",Cancel:"Cancel"}},Clipboard:{Title:"Copy to clipboard",Buttons:{Close:"Close"}},Menu:{Title:"Menu",Build:"build {{version}}",Buttons:{Readonly:"Readonly",Writable:"Edit",Clipboard:"Clipboard",FirstPage:"FirstPage",LastPage:"LastPage",New:"New",Open:"Open",Help:"Help",ShowComment:"ShowText",ReadonlyComment:"ReadText",WritableComment:"WriteText",PageSlider:"PageSlider",ClearToEnd:"Clear->",ClearPast:"<-Clear",Append:"Append",GhostOn:"GhostOn",GhostOff:"GhostOff",UserSettings:"Settings",SavePlayfieldToImage:"Image/field"},Messages:{NoAvailableCommentButton:"Available only when writable mode"}},Navigator:{OpenInPC:"Open in Hard Drop",ExternalFumenURL:"https://harddrop.com/fumen/?{{data}}"}}},1307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=void 0,t.resources={Top:{RestoreFromStorage:""},OpenFumen:{Title:"",Buttons:{Open:"",Cancel:""},Errors:{FailedToLoad:""}},AppendFumen:{Title:"",Buttons:{Cancel:""},Errors:{FailedToLoad:""}},UserSettings:{Title:"",Notice:"",Ghost:{Title:"",Off:function(){return""},On:function(){return""}},Loop:{Title:" [Reader]",Off:function(){return""},On:function(){return""}},Gradient:{Title:""},Buttons:{Save:"",Cancel:""}},Clipboard:{Title:""},Menu:{Messages:{NoAvailableCommentButton:"Writable"}},Navigator:{OpenInPC:"PC",ExternalFumenURL:"https://fumen.zui.jp/?{{data}}"}}},4257:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=void 0;var o=n(655).__importDefault(n(6073)),i=function(e,t){return o.default.t(e,t)};t.i18n={Top:{RestoreFromStorage:function(){return i("Top.RestoreFromStorage")}},OpenFumen:{Title:function(){return i("OpenFumen.Title")},PlaceHolder:function(){return i("OpenFumen.PlaceHolder")},Buttons:{Open:function(){return i("OpenFumen.Buttons.Open")},Cancel:function(){return i("OpenFumen.Buttons.Cancel")}},Errors:{FailedToLoad:function(){return i("OpenFumen.Errors.FailedToLoad")},Unexpected:function(e){return i("OpenFumen.Errors.Unexpected",{message:e})}}},AppendFumen:{Title:function(){return i("AppendFumen.Title")},PlaceHolder:function(){return i("AppendFumen.PlaceHolder")},Buttons:{Cancel:function(){return i("AppendFumen.Buttons.Cancel")}},Errors:{FailedToLoad:function(){return i("AppendFumen.Errors.FailedToLoad")},Unexpected:function(e){return i("AppendFumen.Errors.Unexpected",{message:e})}}},UserSettings:{Title:function(){return i("UserSettings.Title")},Notice:function(){return i("UserSettings.Notice")},Ghost:{Title:function(){return i("UserSettings.Ghost.Title")},Off:function(){return i("UserSettings.Ghost.Off")},On:function(){return i("UserSettings.Ghost.On")}},Loop:{Title:function(){return i("UserSettings.Loop.Title")},Off:function(){return i("UserSettings.Loop.Off")},On:function(){return i("UserSettings.Loop.On")}},Gradient:{Title:function(){return i("UserSettings.Gradient.Title")}},Buttons:{Save:function(){return i("UserSettings.Buttons.Save")},Cancel:function(){return i("UserSettings.Buttons.Cancel")}}},Clipboard:{Title:function(){return i("Clipboard.Title")},Buttons:{Close:function(){return i("Clipboard.Buttons.Close")}}},Menu:{Title:function(){return i("Menu.Title")},Build:function(e){return i("Menu.Build",{version:e})},Buttons:{Readonly:function(){return i("Menu.Buttons.Readonly")},Writable:function(){return i("Menu.Buttons.Writable")},Clipboard:function(){return i("Menu.Buttons.Clipboard")},FirstPage:function(){return i("Menu.Buttons.FirstPage")},LastPage:function(){return i("Menu.Buttons.LastPage")},New:function(){return i("Menu.Buttons.New")},Open:function(){return i("Menu.Buttons.Open")},ShowComment:function(){return i("Menu.Buttons.ShowComment")},ReadonlyComment:function(){return i("Menu.Buttons.ReadonlyComment")},WritableComment:function(){return i("Menu.Buttons.WritableComment")},PageSlider:function(){return i("Menu.Buttons.PageSlider")},Help:function(){return i("Menu.Buttons.Help")},ClearToEnd:function(){return i("Menu.Buttons.ClearToEnd")},ClearPast:function(){return i("Menu.Buttons.ClearPast")},Append:function(){return i("Menu.Buttons.Append")},GhostOn:function(){return i("Menu.Buttons.GhostOn")},GhostOff:function(){return i("Menu.Buttons.GhostOff")},UserSettings:function(){return i("Menu.Buttons.UserSettings")},SavePlayfieldToImage:function(){return i("Menu.Buttons.SavePlayfieldToImage")}},Messages:{NoAvailableCommentButton:function(){return i("Menu.Messages.NoAvailableCommentButton")}}},Navigator:{OpenInPC:function(){return i("Navigator.OpenInPC")},ExternalFumenURL:function(e){return i("Navigator.ExternalFumenURL",{data:e,interpolation:{escapeValue:!1}})}}}},6266:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.localStorageWrapper=t.memento=void 0;var o,i,r=n(655),a=n(2995),c=n(5187),s=n(2315),u=r.__importDefault(n(6486)),d={isWorking:!1,last:{key:(0,c.generateKey)(),saverObj:void 0}},l=function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return d.isWorking=!0,[4,(0,s.encode)(e,!0)];case 1:return t=n.sent(),d.isWorking=!1,[2,"v115@".concat(t)]}}))}))},f=function(e){var n=(0,c.generateKey)(),o=function(e,n){var o=e.saveKey,i=e.pages,a=!1;return{save:function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var n,c;return r.__generator(this,(function(r){switch(r.label){case 0:return a||e!==o?[2]:(a=!0,[4,l(i)]);case 1:return n=r.sent(),setTimeout((function(){return function(e){t.localStorageWrapper.saveFumen(e)}(n)}),0),void 0===(c=d.last).saverObj?[3,3]:[4,c.saverObj.save(c.key)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}}}({pages:e,saveKey:n});d.last={key:n,saverObj:o},setTimeout((function(){o.save(d.last.key).catch((function(e){return console.error(e)}))}),d.isWorking?3e3:0)};t.memento=(o=[],i=[],{save:function(e){f(e)},register:function(e,t){var n=o[o.length-1];return void 0!==n&&n.key===t&&(0,a.isOperationTask)(n)&&(0,a.isOperationTask)(e)?o[o.length-1]=(0,a.toDecoratorOperationTask)(n,e):(o.length<200||o.shift(),o.push(e)),i=[],o.length-1},undo:function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t,n,a;return r.__generator(this,(function(r){switch(r.label){case 0:return void 0===(t=o.pop())?[2,void 0]:(i.push(t),t.fixed?[4,t.revert()]:[3,2]);case 1:return a=r.sent(),[3,3];case 2:a=t.revert(e),r.label=3;case 3:return[2,{pages:(n=a).pages,index:n.index,undoCount:o.length-1,redoCount:i.length}]}}))}))},redo:function(e){return r.__awaiter(void 0,void 0,void 0,(function(){var t,n,a;return r.__generator(this,(function(r){switch(r.label){case 0:return void 0===(t=i.pop())?[2,void 0]:(o.push(t),t.fixed?[4,t.replay()]:[3,2]);case 1:return a=r.sent(),[3,3];case 2:a=t.replay(e),r.label=3;case 3:return[2,{pages:(n=a).pages,index:n.index,undoCount:o.length-1,redoCount:i.length}]}}))}))},lastKey:function(){var e=o[o.length-1];return void 0!==e?e.key:void 0}});var g={fumenV115:function(e){var t=g.string(e);return t&&/^v115@[a-zA-Z0-9+/?]+$/.test(t)?t:void 0},string:function(e){return u.default.isString(e)?e:void 0},boolean:function(e){return u.default.isBoolean(e)?e:void 0}};t.localStorageWrapper={saveFumen:function(e){localStorage.setItem("data@1",e)},loadFumen:function(){var e=localStorage.getItem("data@1");return g.fumenV115(e)},saveUserSettings:function(e){localStorage.setItem("user-settings@1",JSON.stringify(e))},loadUserSettings:function(){var e=localStorage.getItem("user-settings@1");if(!e)return{};var t=JSON.parse(e);return{ghostVisible:g.boolean(t.ghostVisible),loop:g.boolean(t.loop),gradient:g.string(t.gradient)}}}},4848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getURLQuery=void 0,t.getURLQuery=function(){var e="";if(""!==location.search)e=location.search.substr(1);else{var t=location.hash,n=t.indexOf("?");-1!==n&&(e=t.substr(n+1))}var o=decodeURIComponent(e).split("&");return{get:function(e){var t=o.find((function(t){return t.startsWith("".concat(e,"="))}));if(t)return t.substr(e.length+1)}}}},2742:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightType=void 0,(n=t.HighlightType||(t.HighlightType={}))[n.Normal=0]="Normal",n[n.Lighter=1]="Lighter",n[n.Highlight1=10]="Highlight1",n[n.Highlight2=11]="Highlight2",n[n.Darker=20]="Darker"},6314:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=t.initState=void 0;var o,i=n(655),r=n(9774),a=n(5584),c=n(7210),s=n(5187),u=i.__importDefault(n(4920)),d=n(9782),l=n(4848),f=c.PageEnv.Version;t.initState={field:Array.from({length:230}).map((function(e){return{piece:r.Piece.Empty}})),sentLine:Array.from({length:10}).map((function(e){return{piece:r.Piece.Empty}})),comment:{text:"",isChanged:!1,changeKey:(0,s.generateKey)()},display:{width:window.document.body.clientWidth,height:window.document.body.clientHeight},hold:void 0,nexts:void 0,play:{status:r.AnimationState.Pause,intervalTime:1500},fumen:{currentIndex:0,maxPage:1,pages:[{index:0,comment:{text:""},field:{obj:new d.Field({})},flags:{colorize:!0,lock:!0,mirror:!1,quiz:!1,rise:!1}}],value:void 0,errorMessage:void 0,guideLineColor:!0},cache:{currentInitField:new d.Field({}),taskKey:void 0},modal:{fumen:!1,menu:!1,append:!1,clipboard:!1,userSettings:!1},temporary:{userSettings:{ghostVisible:!0,loop:!1,gradient:"0000000"}},handlers:{animation:void 0},events:{piece:void 0,drawing:!1,inferences:[],prevPage:void 0,updated:!1},mode:{screen:window.location.hash.includes("#/edit")?r.Screens.Editor:r.Screens.Reader,type:r.ModeTypes.DrawingTool,touch:r.TouchTypes.Drawing,piece:void 0,comment:r.CommentType.Writable,ghostVisible:!0,loop:!1,gradient:{}},history:{undoCount:0,redoCount:0},version:f,platform:(o=(0,l.getURLQuery)().get("mobile"),o&&Number(o)||navigator.userAgent.match(/iPhone|iPad|Android/)?r.Platforms.Mobile:r.Platforms.PC)},t.resources={modals:{menu:void 0,fumen:void 0,append:void 0,clipboard:void 0,userSettings:void 0},konva:function(){var e={stage:new a.HyperStage,event:{},background:{},fieldMarginLine:{},fieldBlocks:[],sentBlocks:[],hold:{},nexts:[],layers:{background:new u.default.Layer({name:"background"}),field:new u.default.Layer({name:"field"}),boxes:new u.default.Layer({name:"boxes"}),overlay:new u.default.Layer({name:"overlay"})}},t=e.layers,n=new u.default.Rect({strokeWidth:0,opacity:1});e.background=n,t.background.add(n);var o=new u.default.Line({points:[]});e.fieldMarginLine=o,t.background.add(o);var i=Array.from({length:230}).map((function(){return new u.default.Rect({strokeWidth:0,opacity:1})}));e.fieldBlocks=i;for(var r=0,c=i;r<c.length;r++)n=c[r],t.field.add(n);i=Array.from({length:10}).map((function(){return new u.default.Rect({strokeWidth:0,opacity:.75})})),e.sentBlocks=i;for(var s=0,d=i;s<d.length;s++)n=d[s],t.field.add(n);var l=new u.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1}),f=Array.from({length:4}).map((function(){return new u.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1})}));e.hold={background:l,pieces:f};for(var g=0,p=[l].concat(f);g<p.length;g++)n=p[g],t.boxes.add(n);var m=Array.from({length:5}).map((function(){return{background:new u.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1}),pieces:Array.from({length:4}).map((function(){return new u.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1})}))}}));e.nexts=m;for(var h=0,v=m;h<v.length;h++)for(var y=v[h],x=(l=y.background,f=y.pieces,0),P=[l].concat(f);x<P.length;x++)n=P[x],t.boxes.add(n);return n=new u.default.Rect({fill:"#333",opacity:0,strokeEnabled:!1,listening:!0}),e.event=n,t.overlay.add(n),e}(),comment:void 0,focussedElement:void 0}},6085:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=void 0;var o=n(4361),i=n(9774),r=n(3288),a=n(6453),c=n(6691),s=n(5874),u=n(1336),d=n(1699),l=n(3175);t.view=function(e,t){return(0,o.div)([function(){switch(e.mode.screen){case i.Screens.Reader:return(0,r.view)(e,t);case i.Screens.Editor:return(0,a.view)(e,t);default:return(0,o.div)(["Unexpected mode"])}}(),e.modal.fumen?(0,c.OpenFumenModal)({actions:t,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:""}):void 0,e.modal.menu?(0,s.MenuModal)({actions:t,version:e.version,screen:e.mode.screen,currentIndex:e.fumen.currentIndex,maxPageIndex:e.fumen.maxPage,comment:e.mode.comment,display:e.display,platform:e.platform}):void 0,e.modal.append?(0,u.AppendFumenModal)({actions:t,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:""}):void 0,e.modal.clipboard?(0,d.ClipboardModal)({actions:t,pages:e.fumen.pages}):void 0,e.modal.userSettings?(0,l.UserSettingsModal)({actions:t,ghostVisible:e.temporary.userSettings.ghostVisible,loop:e.temporary.userSettings.loop,gradient:e.temporary.userSettings.gradient}):void 0,(0,o.div)({key:"view-end"})])}},7559:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNavigatorHeight=void 0;var o=n(9774);t.getNavigatorHeight=function(e){return e===o.Platforms.PC?30:0}},4028:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.blockMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.blockMode=function(e){var t=e.layout,n=e.modePiece,c=e.colorize,s=e.actions,u=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S,o.Piece.Empty,o.Piece.Gray];return(0,i.div)({style:(0,a.toolStyle)(t)},[(0,r.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(u.map((function(e){return(0,r.colorButton)({layout:t,piece:e,colorize:c,onclick:s.selectPieceColor,highlight:n===e})}))).concat([(0,r.inferenceButton)({layout:t,actions:s,highlight:void 0===n})]))}},46:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commentMode=void 0;var o=n(4361),i=n(7975),r=n(6453);t.commentMode=function(e){var t=e.layout,n=e.currentIndex,a=e.actions;return(0,o.div)({style:(0,r.toolStyle)(t)},[(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-comment-blank",key:"btn-comment-blank",onclick:function(){a.setCommentText({text:"",pageIndex:n})}},(0,i.iconContents)({description:"blank",iconSize:22,iconName:"format_strikethrough"})),(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-comment-inherit",key:"btn-comment-inherit",enable:0<n,onclick:function(){a.resetCommentText({pageIndex:n})}},(0,i.iconContents)({description:"inherit",iconSize:22,iconName:"forward"}))])}},6453:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.getComment=t.toolStyle=t.getFieldLayout=void 0;var o=n(655),i=n(9774),r=n(7559),a=n(6314),c=n(1809),s=n(3891),u=n(8174),d=n(4245),l=n(6100),f=n(4361),g=n(4055),p=n(4264),m=n(37),h=n(8722),v=n(4028),y=n(4932),x=n(5224),P=n(2908),b=n(2308),k=n(9135),w=n(6769),_=n(4961),C=n(474),T=n(46);t.getFieldLayout=function(e){var t=e.topLeftY,n=e.width,o=e.height-(85+t),i=Math.min((o-2.4-2)/24,(n-90)/10.5)-1,r={width:10*(i+1)+1,height:23.5*(i+1)+1+2.4};return{topLeft:{x:0,y:(o-r.height)/2},size:{width:r.width,height:r.height}}},t.toolStyle=function(e){var t=(e.canvas.size.height-e.field.size.height)/2;return(0,g.style)({marginTop:"0px",marginBottom:"0px",marginLeft:"10px",marginRight:"0px",padding:"".concat((0,g.px)(t)," 0px"),display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"center",height:(0,g.px)(e.canvas.size.height),width:(0,g.px)(e.buttons.size.width)})};var S=function(e,t,n){var o=e.fumen.pages[e.fumen.currentIndex],r=void 0===o||void 0!==o.field.obj,c=void 0===e.fumen.pages[0]||e.fumen.pages[0].flags.colorize;return(0,f.div)({key:"field-top",id:"field-top",style:(0,g.style)({display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",userSelect:"none"})},[(0,d.KonvaCanvas)({actions:t,canvas:n.canvas.size,hyperStage:a.resources.konva.stage}),(0,u.Field)({getGradientPattern:function(t){return"inference"===t?i.GradientPattern.None:e.mode.gradient[t]||i.GradientPattern.None},fieldMarginWidth:n.field.bottomBorderWidth,topLeft:n.field.topLeft,blockSize:n.field.blockSize,field:e.field,sentLine:e.sentLine,guideLineColor:e.fumen.guideLineColor}),function(){switch(e.mode.type){case i.ModeTypes.Drawing:return(0,v.blockMode)({layout:n,actions:t,colorize:c,modePiece:e.mode.piece});case i.ModeTypes.DrawingTool:return(0,h.toolMode)({layout:n,actions:t,keyPage:r,touchType:e.mode.touch,currentIndex:e.fumen.currentIndex});case i.ModeTypes.Piece:var a=e.fumen.pages[e.fumen.currentIndex];return(0,y.pieceMode)({layout:n,actions:t,move:void 0!==a?a.piece:void 0,existInferences:0<e.events.inferences.length,pages:e.fumen.pages,flags:a.flags,touchType:e.mode.touch,currentIndex:e.fumen.currentIndex});case i.ModeTypes.Flags:return(0,P.flagsMode)({layout:n,actions:t,keyPage:r,flags:o.flags,currentIndex:e.fumen.currentIndex});case i.ModeTypes.Utils:return(0,b.utilsMode)({layout:n,actions:t,touchType:e.mode.touch});case i.ModeTypes.Comment:return(0,T.commentMode)({layout:n,actions:t,currentIndex:e.fumen.currentIndex});case i.ModeTypes.Slide:return(0,k.slideMode)({layout:n,actions:t});case i.ModeTypes.Fill:return(0,x.fillMode)({layout:n,actions:t,colorize:c,modePiece:e.mode.piece});case i.ModeTypes.FillRow:return(0,w.fillRowMode)({layout:n,actions:t,colorize:c,modePiece:e.mode.piece});case i.ModeTypes.SelectPiece:return(0,_.pieceSelectMode)({layout:n,actions:t,currentIndex:e.fumen.currentIndex,colorize:c})}}()])},M=function(e,t){if(void 0!==e.mode)return(0,l.DrawingEventCanvas)({actions:t,fieldBlocks:a.resources.konva.fieldBlocks,sentBlocks:a.resources.konva.sentBlocks,fieldLayer:a.resources.konva.layers.field})},z=function(e,t,n,o){return(0,c.EditorTools)({actions:t,height:n,palette:o,currentPage:e.fumen.currentIndex+1,maxPage:e.fumen.maxPage,modeType:e.mode.type,undoCount:e.history.undoCount,redoCount:e.history.redoCount,inferenceCount:e.events.inferences.length})};t.getComment=function(e,t,n){var o=e.fumen.currentIndex,r=e.fumen.pages[o];switch(e.mode.comment){case i.CommentType.Writable:var c=void 0!==a.resources.comment||void 0!==r&&void 0!==r.comment.text;return(0,p.comment)({currentIndex:o,actions:t,key:"text-comment-editor-".concat(e.comment.changeKey),dataTest:"text-comment",id:"text-comment",textColor:c?"#333":"#757575",backgroundColorClass:"white",height:n.comment.size.height,text:void 0!==a.resources.comment?a.resources.comment.text:e.comment.text,placeholder:"comment",readonly:!1});case i.CommentType.Readonly:var s=e.fumen.currentIndex,u=e.fumen.pages[s];return c=void 0!==a.resources.comment||void 0!==u&&void 0!==u.comment.text,(0,p.comment)({currentIndex:s,actions:t,key:"text-comment-editor-readonly-".concat(e.comment.changeKey),dataTest:"text-comment",id:"text-comment",textColor:c?"#333":"#757575",backgroundColorClass:"white",height:n.comment.size.height,text:void 0!==a.resources.comment?a.resources.comment.text:e.comment.text,readonly:!0});case i.CommentType.PageSlider:return(0,m.page_slider)({currentIndex:o,actions:t,datatest:"range-page-slider",size:{width:.8*n.comment.size.width,height:n.comment.size.height},maxPage:e.fumen.maxPage})}},t.view=function(e,n){var c,u,d,l,g,p,m,h,v=(0,r.getNavigatorHeight)(e.platform),y=(u=(c=o.__assign(o.__assign({},e.display),{topLeftY:v})).topLeftY,g={width:d=c.width,height:(l=c.height)-(85+u)},m={width:10*((p=Math.min((g.height-2.4-2)/24,(g.width-90)/10.5)-1)+1)+1,height:23.5*(p+1)+1+2.4+1},h={width:Math.min(.6*(g.width-m.width),80),height:Math.min(m.height/11.5,40)},{canvas:{topLeft:{x:0,y:u},size:{width:m.width,height:g.height}},field:{blockSize:p,bottomBorderWidth:2.4,topLeft:{x:0,y:(g.height-m.height)/2},size:{width:m.width,height:m.height}},buttons:{size:h},comment:{topLeft:{x:0,y:l-35-50},size:{width:d,height:35}},tools:{topLeft:{x:0,y:l-50},size:{width:d,height:50}}}),x=(0,s.Palette)(i.Screens.Editor),P=function(){return a.resources.konva.stage.batchDraw()};return(0,f.div)({oncreate:P,onupdate:P,key:"view"},[a.resources.konva.stage.isReady?M(e,n):void 0,(0,C.navigatorElement)({palette:x,actions:n,height:v}),S(e,n,y),(0,f.div)({key:"menu-top"},[(0,t.getComment)(e,n,y),z(e,n,y.tools.size.height,x)])])}},5224:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.fillMode=function(e){var t=e.layout,n=e.modePiece,c=e.colorize,s=e.actions,u=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S,o.Piece.Empty,o.Piece.Gray];return(0,i.div)({style:(0,a.toolStyle)(t)},[(0,r.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(u.map((function(e){return(0,r.colorButton)({layout:t,piece:e,colorize:c,onclick:s.selectPieceColor,highlight:n===e})}))))}},6769:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillRowMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.fillRowMode=function(e){var t=e.layout,n=e.modePiece,c=e.colorize,s=e.actions,u=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S,o.Piece.Empty,o.Piece.Gray];return(0,i.div)({style:(0,a.toolStyle)(t)},[(0,r.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(u.map((function(e){return(0,r.colorButton)({layout:t,piece:e,colorize:c,onclick:s.selectPieceColor,highlight:n===e})}))).concat([(0,r.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return s.changeToUtilsMode()}},(0,r.iconContents)({description:"Back",iconSize:25,iconName:"chevron_left"}))]))}},2908:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flagsMode=void 0;var o=n(4361),i=n(7975),r=n(6453);t.flagsMode=function(e){var t=e.layout,n=e.currentIndex,a=(e.keyPage,e.flags),c=e.actions;return(0,o.div)({style:(0,r.toolStyle)(t)},[(0,i.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),(0,i.switchButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-lock-flag",key:"btn-lock-flag",onclick:function(){return c.changeLockFlag({index:n,enable:!a.lock})},enable:a.lock},(0,i.switchIconContents)({description:"lock",iconSize:22,enable:a.lock})),(0,i.switchButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-rise-flag",key:"btn-rise-flag",onclick:function(){return c.changeRiseFlag({index:n,enable:!a.rise})},enable:a.rise},(0,i.switchIconContents)({description:"rise",iconSize:22,enable:a.rise})),(0,i.switchButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-mirror-flag",key:"btn-mirror-flag",onclick:function(){return c.changeMirrorFlag({index:n,enable:!a.mirror})},enable:a.mirror},(0,i.switchIconContents)({description:"mirror",iconSize:22,enable:a.mirror}))])}},4932:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pieceMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453),c=n(1983);t.pieceMode=function(e){var t=e.layout,n=e.currentIndex,s=e.touchType,u=e.move,d=e.pages,l=e.existInferences,f=e.flags,g=e.actions,p=void 0!==u,m=void 0!==u?u.rotation:void 0;return(0,i.div)({style:(0,a.toolStyle)(t)},[(0,r.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),(0,r.rotationButton)({layout:t,rotation:m,highlight:!1}),(0,r.switchButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-lock-flag",key:"btn-lock-flag",onclick:function(){return g.changeLockFlag({index:n,enable:!f.lock})},enable:f.lock},(0,r.switchIconContents)({description:"lock",iconSize:22,enable:f.lock})),(0,r.dualButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-move-to-left-end",key:"btn-move-to-left-end",enable:p,onclick:function(){return g.moveToLeftEnd()},contents:(0,r.iconContents)({description:"",iconSize:24,iconName:"skip_previous"})},{datatest:"btn-move-to-right-end",key:"btn-move-to-right-end",enable:p,onclick:function(){return g.moveToRightEnd()},contents:(0,r.iconContents)({description:"",iconSize:24,iconName:"skip_next"})}),(0,r.dualButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-move-to-left",key:"btn-move-to-left",enable:p,onclick:function(){return g.moveToLeft()},contents:(0,r.iconContents)({description:"",iconSize:24,iconName:"keyboard_arrow_left"})},{datatest:"btn-move-to-right",key:"btn-move-to-right",enable:p,onclick:function(){return g.moveToRight()},contents:(0,r.iconContents)({description:"",iconSize:24,iconName:"keyboard_arrow_right"})}),(0,r.dualButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-rotate-to-left",key:"btn-rotate-to-left",enable:p,onclick:function(){return g.rotateToLeft()},contents:(0,r.iconContents)({description:"",iconSize:23,iconName:"rotate_left"})},{datatest:"btn-rotate-to-right",key:"btn-rotate-to-right",enable:p,onclick:function(){return g.rotateToRight()},contents:(0,r.iconContents)({description:"",iconSize:23,iconName:"rotate_right"})}),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-harddrop",key:"btn-harddrop",enable:p,onclick:function(){return g.harddrop()}},(0,r.iconContents)({description:"drop",iconSize:22,iconName:"vertical_align_bottom"})),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-reset-piece",enable:l||void 0!==u,key:"btn-reset-piece",onclick:function(){g.clearPiece()}},(0,r.iconContents)({description:"reset",iconSize:23,iconName:"clear"})),(0,r.dualSwitchButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336"},{datatest:"btn-move-piece",key:"btn-move-piece",enable:s===o.TouchTypes.MovePiece,onclick:function(){return g.changeToMovePieceMode()},contents:(0,r.iconContents)({description:"",iconSize:18,iconName:"pan_tool"})},{datatest:"btn-draw-piece",key:"btn-draw-piece",enable:s===o.TouchTypes.Piece,onclick:function(){return g.changeToDrawPieceMode()},contents:(0,r.iconContents)({description:"",iconSize:21,iconName:"edit"})}),(0,r.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-select-mode",key:"btn-piece-select-mode",onclick:function(){var e=new c.Pages(d).getField(n,c.PageFieldOperation.Command);f.lock&&void 0!==u&&e.isOnGround(u.type,u.rotation,u.coordinate.x,u.coordinate.y)&&(g.insertPage({index:n+1}),g.openPage({index:n+1})),g.changeToSelectPieceMode()}},(0,r.iconContents)({description:"spawn",iconSize:22,iconName:"add"}))])}},4961:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pieceSelectMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.pieceSelectMode=function(e){var t=e.layout,n=(e.currentIndex,e.colorize),c=e.actions,s=[o.Piece.I,o.Piece.L,o.Piece.O,o.Piece.Z,o.Piece.T,o.Piece.J,o.Piece.S];return(0,i.div)({style:(0,a.toolStyle)(t)},[(0,r.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"})].concat(s.map((function(e){return(0,r.colorButton)({layout:t,piece:e,colorize:n,onclick:function(e){var t=e.piece;c.spawnPiece({piece:t,guideline:n}),c.changeToMovePieceMode(),c.changeToPieceMode()},highlight:!1})}))).concat([(0,r.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return c.changeToPieceMode()}},(0,r.iconContents)({description:"Back",iconSize:25,iconName:"chevron_left"}))]))}},9135:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.slideMode=void 0;var o=n(4361),i=n(7975),r=n(6453);t.slideMode=function(e){var t=e.layout,n=e.actions;return(0,o.div)({style:(0,r.toolStyle)(t)},[(0,i.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-slide-to-up",key:"btn-slide-to-up",onclick:function(){return n.shiftToUp()}},(0,i.iconContents)({description:"",iconSize:22,iconName:"keyboard_arrow_up"})),(0,i.dualButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-slide-to-left",key:"btn-slide-to-left",onclick:function(){return n.shiftToLeft()},contents:(0,i.iconContents)({description:"",iconSize:23,iconName:"keyboard_arrow_left"})},{datatest:"btn-slide-to-right",key:"btn-slide-to-right",onclick:function(){return n.shiftToRight()},contents:(0,i.iconContents)({description:"",iconSize:23,iconName:"keyboard_arrow_right"})}),(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-slide-to-down",key:"btn-slide-to-down",onclick:function(){return n.shiftToBottom()}},(0,i.iconContents)({description:"",iconSize:22,iconName:"keyboard_arrow_down"})),(0,i.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return n.changeToUtilsMode()}},(0,i.iconContents)({description:"Back",iconSize:25,iconName:"chevron_left"}))])}},8722:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toolMode=void 0;var o=n(9774),i=n(4361),r=n(7975),a=n(6453);t.toolMode=function(e){var t=e.layout,n=e.currentIndex,c=e.keyPage,s=e.touchType,u=e.actions;return(0,i.div)({style:(0,a.toolStyle)(t)},[(0,r.keyButton)({toolButtonMargin:5,keyPage:c,currentIndex:n,actions:u,width:t.buttons.size.width}),(0,r.toolSpace)({flexGrow:100,width:t.buttons.size.width,margin:5,key:"div-space"}),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-insert-new-page",key:"btn-insert-new-page",onclick:function(){u.insertNewPage({index:n+1})}},(0,r.iconContents)({description:"add",iconSize:22,iconName:"note_add"})),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-duplicate-page",key:"btn-duplicate-page",onclick:function(){var e=n+1;u.duplicatePage({index:e}),u.openPage({index:e})}},(0,r.iconContents)({description:"copy",iconSize:22,iconName:"content_copy"})),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-remove-page",key:"btn-remove-page",onclick:function(){return u.removePage({index:n})}},(0,r.iconContents)({description:"remove",iconSize:22,iconName:"remove_circle_outline"})),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-utils-mode",key:"btn-utils-mode",onclick:function(){return u.changeToUtilsMode()}},(0,r.iconContents)({description:"utils",iconSize:24,iconName:"widgets"})),(0,r.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-flags-mode",key:"btn-flags-mode",onclick:function(){return u.changeToFlagsMode()}},(0,r.iconContents)({description:"flags",iconSize:24,iconName:"flag"})),(0,r.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:s===o.TouchTypes.Piece?"#fff":"#f44336",borderType:s===o.TouchTypes.Piece?"double":void 0,datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:function(){return u.changeToDrawPieceMode()}},(0,r.iconContents)({description:"piece",iconSize:20,iconName:"extension"})),(0,r.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:s===o.TouchTypes.Drawing?"#fff":"#f44336",borderType:s===o.TouchTypes.Drawing?"double":void 0,datatest:"btn-block-mode",key:"btn-block-mode",onclick:function(){return u.changeToDrawingMode()}},(0,r.iconContents)({description:"block",iconSize:22,iconName:"edit"}))])}},2308:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utilsMode=void 0;var o=n(4361),i=n(7975),r=n(6453),a=n(9774);t.utilsMode=function(e){var t=e.layout,n=e.touchType,c=e.actions;return(0,o.div)({style:(0,r.toolStyle)(t)},[(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-mirror",key:"btn-mirror",onclick:function(){c.convertToMirror()}},(0,i.iconContents)({description:"mirror",iconSize:22,iconName:"compare_arrows"})),(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-convert-to-gray",key:"btn-convert-to-gray",onclick:function(){c.convertToGray()}},(0,i.iconContents)({description:"to gray",iconSize:19,iconName:"color_lens"})),(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-clear-field",key:"btn-clear-field",onclick:function(){c.clearField()}},(0,i.iconContents)({description:"clear",iconSize:22,iconName:"clear"})),(0,i.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:n===a.TouchTypes.Fill?"#fff":"#f44336",borderType:n===a.TouchTypes.Fill?"double":void 0,datatest:"btn-comment-mode",key:"btn-comment-mode",onclick:function(){return c.changeToCommentMode()}},(0,i.iconContents)({marginRight:0,description:"comment",descriptionSize:9,iconSize:19,iconName:"title"})),(0,i.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:n===a.TouchTypes.Fill?"#fff":"#f44336",borderType:n===a.TouchTypes.Fill?"double":void 0,datatest:"btn-fill-mode",key:"btn-fill-mode",onclick:function(){return c.changeToFillMode()}},(0,i.iconContents)({description:"fill",iconSize:20,iconName:"brush"})),(0,i.toolButton)({borderWidth:3,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:n===a.TouchTypes.FillRow?"#fff":"#f44336",borderType:n===a.TouchTypes.FillRow?"double":void 0,datatest:"btn-fill-row-mode",key:"btn-fill-row-mode",onclick:function(){return c.changeToFillRowMode()}},(0,i.iconContents)({description:"row",iconSize:24,iconName:"power_input"})),(0,i.toolButton)({borderWidth:1,width:t.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-slide-mode",key:"btn-slide-mode",onclick:function(){return c.changeToShiftMode()}},(0,i.iconContents)({description:"slide",iconSize:24,iconName:"swap_vert"}))])}},7975:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toolSpace=t.dualSwitchButton=t.switchButton=t.dualButton=t.toolButton=t.keyButton=t.switchIconContents=t.iconContents=t.inferenceButton=t.svgButton=t.rotationButton=t.colorButton=void 0;var o=n(655),i=n(4055),r=n(4361),a=n(9774),c=n(4272);t.colorButton=function(e){var n=e.layout,o=e.piece,i=e.highlight,r=e.colorize,c=e.onclick,s=i?3:1,u=(0,a.parsePieceName)(o),d="img/".concat(u,r?".svg":"_classic.svg");return(0,t.svgButton)({src:d,layout:n,highlight:i,borderWidth:s,height:.55*n.buttons.size.height,datatest:"btn-piece-".concat(u.toLowerCase()),key:"btn-piece-".concat(u.toLowerCase()),onclick:function(){return c({piece:o})}})},t.rotationButton=function(e){var n=e.layout,o=e.rotation,i=e.highlight,r=void 0!==o?(0,a.parseRotationName)(o):"Empty",c="img/rotation_".concat(r,".svg");return(0,t.svgButton)({src:c,layout:n,highlight:i,height:.85*n.buttons.size.height,borderWidth:0,datatest:"img-rotation-".concat(r.toLowerCase()),key:"img-rotation-".concat(r.toLowerCase())})},t.svgButton=function(e){var n=e.src,o=e.datatest,a=e.key,c=e.layout,s=e.highlight,u=e.height,d=e.borderWidth,l=e.onclick,f=[(0,r.img)({src:n,height:"".concat(u),style:(0,i.style)({margin:"auto"})})];return(0,t.toolButton)({borderWidth:d,datatest:o,key:a,onclick:l,width:c.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:s?"#ff5252":"#333"},f)},t.inferenceButton=function(e){var n=e.layout,o=e.highlight,i=e.actions,r=(0,t.iconContents)({description:"comp",iconSize:22,iconName:"image_aspect_ratio"}),a=o?3:1;return(0,t.toolButton)({borderWidth:a,width:n.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:o?"#ff5252":"#333",datatest:"btn-piece-inference",key:"btn-piece-inference",onclick:function(){return i.selectInferencePieceColor()}},r)},t.iconContents=function(e){var t=e.marginRight,n=void 0===t?2:t,o=e.description,a=e.descriptionSize,s=void 0===a?11:a,u=e.iconSize,d=e.iconName;return[(0,r.div)({style:(0,i.style)({marginRight:(0,i.px)(n)})},[(0,c.BlockIcon)({iconSize:u,key:"icon"},d)])," ",(0,r.span)({style:(0,i.style)({fontSize:(0,i.px)(s),whiteSpace:"nowrap"})},o)]},t.switchIconContents=function(e){var t=e.description,n=e.iconSize,o=e.enable;return[(0,r.div)({style:(0,i.style)({marginRight:(0,i.px)(2)})},[(0,c.BlockIcon)({iconSize:n,key:"icon"},o?"check_box":"check_box_outline_blank")])," ",(0,r.span)({style:(0,i.style)({fontSize:(0,i.px)(11)})},t)]},t.keyButton=function(e){var n=e.width,o=e.toolButtonMargin,i=e.keyPage,r=e.currentIndex,a=e.actions,c=i?function(){return a.changeToRef({index:r})}:function(){return a.changeToKey({index:r})};return(0,t.switchButton)({width:n,borderWidth:1,margin:o,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-key-page",key:"btn-key-ref-page",onclick:c,enable:i},(0,t.switchIconContents)({description:"key",iconSize:18,enable:i}))},t.toolButton=function(e,t){var n=e.width,o=e.backgroundColorClass,a=e.textColor,c=e.borderColor,s=e.borderWidth,u=void 0===s?1:s,d=e.borderType,l=void 0===d?"solid":d,f=e.datatest,g=e.key,p=e.onclick,m=e.flexGrow,h=e.margin,v=e.enable,y=void 0===v||v;return(0,r.a)({datatest:f,key:g,href:"#",class:"".concat(void 0!==p?"waves-effect ":"")+"z-depth-0 btn ".concat(o," ").concat(y?"":"disabled"),style:(0,i.style)({flexGrow:m,color:y?a:"#9e9e9e",border:y?"".concat(l," ").concat(u,"px ").concat(c):"solid 1px #9e9e9e",margin:"".concat((0,i.px)(h)," 0px"),padding:(0,i.px)(0),width:(0,i.px)(n),maxWidth:(0,i.px)(n),textAlign:"center",cursor:"pointer"}),onclick:void 0!==p?function(e){p(e),e.stopPropagation(),e.preventDefault()}:void 0},[(0,r.div)({style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},t)])},t.dualButton=function(e,t,n){var a=e.width,c=e.backgroundColorClass,s=e.textColor,u=e.borderColor,d=e.borderWidth,l=void 0===d?1:d,f=e.borderType,g=void 0===f?"solid":f,p=e.flexGrow,m=e.margin,h=function(e){var t=e.datatest,n=e.key,o=e.contents,a=e.onclick,d=e.enable,f=void 0===d||d,p=e.margin;return(0,r.a)({datatest:t,key:n,href:"#",class:"waves-effect waves-light z-depth-0 btn ".concat(c," ").concat(f?"":"disabled"),style:(0,i.style)({margin:p,color:f?s:"#9e9e9e",border:f?"".concat(g," ").concat(l,"px ").concat(u):"solid 1px #9e9e9e",padding:(0,i.px)(0),width:"50%",maxWidth:"50%",textAlign:"center"}),onclick:function(e){a(e),e.stopPropagation(),e.preventDefault()}},[(0,r.div)({style:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},o)])};return(0,r.div)({style:(0,i.style)({flexGrow:p,width:(0,i.px)(a),maxWidth:(0,i.px)(a),display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",margin:"".concat((0,i.px)(m)," 0px"),padding:(0,i.px)(0)})},[h(o.__assign(o.__assign({},t),{margin:"0px 2px 0px 0px"})),h(o.__assign(o.__assign({},n),{margin:"0px 0px 0px 2px"}))])},t.switchButton=function(e,t){var n=e.width,o=e.backgroundColorClass,a=e.textColor,c=e.borderColor,s=e.borderWidth,u=void 0===s?1:s,d=e.datatest,l=e.key,f=e.onclick,g=e.flexGrow,p=e.margin,m=e.enable;return(0,r.a)({key:l,href:"#",class:"waves-effect waves-light z-depth-0 btn ".concat(m?o:"white"),datatest:"".concat(d,"-").concat(m?"on":"off"),style:(0,i.style)({flexGrow:g,color:m?"#fff":a,border:m?"solid ".concat(u,"px ").concat(c):"dashed 1px #333",margin:"".concat((0,i.px)(p)," 0px"),padding:(0,i.px)(0),width:(0,i.px)(n),maxWidth:(0,i.px)(n),textAlign:"center"}),onclick:function(e){f(e),e.stopPropagation(),e.preventDefault()}},[(0,r.div)({style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},t)])},t.dualSwitchButton=function(e,t,n){var a=e.width,c=e.backgroundColorClass,s=e.textColor,u=e.borderColor,d=e.borderWidth,l=void 0===d?1:d,f=(e.borderType,e.flexGrow),g=e.margin,p=function(e){var t=e.datatest,n=e.key,o=e.contents,a=e.onclick,d=e.enable,f=void 0===d||d,g=e.margin;return(0,r.a)({datatest:t,key:n,href:"#",class:"waves-effect waves-light z-depth-0 btn ".concat(f?c:"white"),style:(0,i.style)({margin:g,color:f?"#fff":s,border:f?"solid ".concat(l,"px ").concat(u):"dashed 1px #333",padding:(0,i.px)(0),width:"50%",maxWidth:"50%",textAlign:"center"}),onclick:function(e){a(e),e.stopPropagation(),e.preventDefault()}},[(0,r.div)({style:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},o)])};return(0,r.div)({style:(0,i.style)({flexGrow:f,width:(0,i.px)(a),maxWidth:(0,i.px)(a),display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",margin:"".concat((0,i.px)(g)," 0px"),padding:(0,i.px)(0)})},[p(o.__assign(o.__assign({},t),{margin:"0px 2px 0px 0px"})),p(o.__assign(o.__assign({},n),{margin:"0px 0px 0px 2px"}))])},t.toolSpace=function(e){var t=e.width,n=e.key,o=e.flexGrow,a=e.margin;return(0,r.div)({key:n,class:"white",style:(0,i.style)({flexGrow:o,color:"#fff",borderWidth:(0,i.px)(0),margin:"".concat((0,i.px)(a)," 0px"),padding:(0,i.px)(0),width:(0,i.px)(t),maxWidth:(0,i.px)(t),boxSizing:"border-box",textAlign:"center"})},[])}},474:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.navigatorElement=void 0;var o=n(4361),i=n(4055),r=n(4257);t.navigatorElement=function(e){var t=e.height,n=e.palette,a=e.actions;if(t)return(0,o.div)({className:"".concat(n.baseClass," lighten-5"),onclick:function(){a.openInPC()},style:(0,i.style)({height:(0,i.px)(t),display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",fontSize:"16px"})},[(0,o.a)({href:"#"},r.i18n.Navigator.OpenInPC())])}},3288:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.getComment=t.getLayout=t.getFieldLayout=void 0;var o=n(655),i=n(7559),r=n(6314),a=n(4361),c=n(4245),s=n(4264),u=n(9774),d=n(5154),l=n(3149),f=n(3891),g=n(8174),p=n(6136),m=n(2742),h=n(37),v=n(474);t.getFieldLayout=function(e){var t=e.topLeftY,n=e.width,o=e.height-(85+t),i=Math.min(Math.floor(Math.min(o/23.5,n/10))-2,n/16),r={width:10*(i+1)+1,height:23.5*(i+1)+1+2.4};return{topLeft:{x:(n-r.width)/2,y:(o-r.height)/2},size:r}},t.getLayout=function(e){var t=e.topLeftY,n=e.width,o=e.height,i={width:n,height:o-(85+t)},r=Math.min(Math.floor(Math.min(i.height/23.5,i.width/10))-2,i.width/16),a={width:10*(r+1)+1,height:23.5*(r+1)+1+2.4+1},c=Math.max(Math.min(a.width/5*1.15,(i.width-a.width)/2-15),5),s=c/4,u={x:(i.width-a.width)/2,y:(i.height-a.height)/2};return{canvas:{topLeft:{x:0,y:t},size:i},field:{blockSize:r,bottomBorderWidth:2.4,topLeft:u,size:a},hold:{boxSize:c,size:{width:c,height:c},topLeft:{x:u.x-(c+s/2),y:u.y}},nexts:{boxSize:c,size:{width:c,height:c},topLeft:function(e){return{x:u.x+a.width+s/2,y:u.y+e*(c+s)}}},comment:{topLeft:{x:0,y:o-85},size:{width:n,height:35}},tools:{topLeft:{x:0,y:o-50},size:{width:n,height:50}}}};var y=function(e,t,n){return(0,d.EventCanvas)({actions:t,canvas:n.canvas.size,rect:r.resources.konva.event})},x=function(e,t,n){var i=function(t){return"inference"===t?u.GradientPattern.None:e.mode.gradient[t]||u.GradientPattern.None};return(0,a.div)({key:"field-top",id:"field-top"},o.__spreadArray([(0,c.KonvaCanvas)({actions:t,canvas:n.canvas.size,hyperStage:r.resources.konva.stage}),(0,g.Field)({getGradientPattern:i,fieldMarginWidth:n.field.bottomBorderWidth,topLeft:n.field.topLeft,blockSize:n.field.blockSize,field:e.field,sentLine:e.sentLine,guideLineColor:e.fumen.guideLineColor}),void 0!==e.hold?(0,l.Box)({size:n.hold.size,key:"box-hold",rects:r.resources.konva.hold,topLeft:n.hold.topLeft,piece:(0,u.isMinoPiece)(e.hold)?{type:e.hold,color:(0,f.decidePieceColor)(e.hold,m.HighlightType.Highlight2,e.fumen.guideLineColor),size:n.hold.boxSize/4-1}:void 0,mark:(0,u.isMinoPiece)(e.hold)?{type:i(e.hold),color:(0,f.decideMarkPieceColor)(e.hold,e.fumen.guideLineColor)}:void 0}):void 0],(void 0!==e.nexts?e.nexts:[]).map((function(t,o){return(0,l.Box)({size:n.hold.size,key:"box-next-".concat(o),rects:r.resources.konva.nexts[o],topLeft:n.nexts.topLeft(o),piece:(0,u.isMinoPiece)(t)?{type:t,color:(0,f.decidePieceColor)(t,m.HighlightType.Highlight2,e.fumen.guideLineColor),size:n.nexts.boxSize/4-1}:void 0,mark:(0,u.isMinoPiece)(t)?{type:i(t),color:(0,f.decideMarkPieceColor)(t,e.fumen.guideLineColor)}:void 0})})),!0))},P=function(e,t,n,o){return(0,p.ReaderTools)({actions:t,height:n,palette:o,currentPage:e.fumen.currentIndex+1,maxPage:e.fumen.maxPage,animationState:e.play.status,pages:"".concat(e.fumen.currentIndex+1," / ").concat(e.fumen.maxPage),loop:e.mode.loop})};t.getComment=function(e,t,n){switch(e.mode.comment){case u.CommentType.PageSlider:return(0,h.page_slider)({actions:t,datatest:"range-page-slider",size:{width:.8*n.comment.size.width,height:n.comment.size.height},currentIndex:e.fumen.currentIndex,maxPage:e.fumen.maxPage});default:var o=e.fumen.currentIndex;return(0,s.comment)({currentIndex:o,actions:t,key:"text-comment-reader-".concat(e.comment.changeKey),dataTest:"text-comment",id:"text-comment",textColor:e.comment.isChanged?"#fff":"#333",backgroundColorClass:""!==e.comment.text&&e.comment.isChanged?"green darken-1":"white",height:n.comment.size.height,text:e.comment.text,readonly:!0})}},t.view=function(e,n){var c=(0,i.getNavigatorHeight)(e.platform),s=(0,t.getLayout)(o.__assign(o.__assign({},e.display),{topLeftY:c})),d=(0,f.Palette)(u.Screens.Reader),l=function(){return r.resources.konva.stage.batchDraw()};return(0,a.div)({oncreate:l,onupdate:l,key:"view"},[r.resources.konva.stage.isReady?y(0,n,s):void 0,(0,v.navigatorElement)({palette:d,actions:n,height:c}),x(e,n,s),(0,a.div)({key:"menu-top"},[(0,t.getComment)(e,n,s),P(e,n,s.tools.size.height,d)])])}}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.loaded=!0,r.exports}o.m=t,e=[],o.O=(t,n,i,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,i,r]=e[d],c=!0,s=0;s<n.length;s++)(!1&r||a>=r)&&Object.keys(o.O).every((e=>o.O[e](n[s])))?n.splice(s--,1):(c=!1,r<a&&(a=r));if(c){e.splice(d--,1);var u=i();void 0!==u&&(t=u)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,i,r]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,r,[a,c,s]=n,u=0;if(a.some((t=>0!==e[t]))){for(i in c)o.o(c,i)&&(o.m[i]=c[i]);if(s)var d=s(o)}for(t&&t(n);u<a.length;u++)r=a[u],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},n=self.webpackChunktetfu_sp=self.webpackChunktetfu_sp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=o.O(void 0,[736],(()=>o(5917)));i=o.O(i)})();